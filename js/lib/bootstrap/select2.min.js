/*
Copyright 2012 Igor Vaynberg
 
Version: 3.2 Timestamp: Mon Sep 10 10:38:04 PDT 2012

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this work except in
compliance with the License. You may obtain a copy of the License in the LICENSE file, or at:

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is
distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.
*/

!function(e){void 0===e.fn.each2&&e.fn.extend({each2:function(t){for(var s=e([0]),i=-1,n=this.length;++i<n&&(s.context=s[0]=this[i])&&!1!==t.call(s[0],i,s););return this}})}(jQuery),function(e,t){function s(e,t){var s,i=0,n=t.length;if(void 0===e)return-1;if(e.constructor===String){for(;i<n;i+=1)if(0===e.localeCompare(t[i]))return i}else for(;i<n;i+=1)if(s=t[i],s.constructor===String){if(0===s.localeCompare(e))return i}else if(s===e)return i;return-1}function i(e,s){return e===s||e!==t&&s!==t&&null!==e&&null!==s&&(e.constructor===String?0===e.localeCompare(s):s.constructor===String&&0===s.localeCompare(e))}function n(t,s){var i,n,o;if(null===t||1>t.length)return[];for(i=t.split(s),n=0,o=i.length;n<o;n+=1)i[n]=e.trim(i[n]);return i}function o(e,s,i){var n,i=i||t;return function(){var t=arguments;window.clearTimeout(n),n=window.setTimeout(function(){s.apply(i,t)},e)}}function l(e){e.preventDefault(),e.stopPropagation()}function c(e,t,s){var i=e.toUpperCase().indexOf(t.toUpperCase()),t=t.length;0>i?s.push(e):(s.push(e.substring(0,i)),s.push("<span class='select2-match'>"),s.push(e.substring(i,i+t)),s.push("</span>"),s.push(e.substring(i+t,e.length)))}function a(t){var s,i=0,n=null,o=t.quietMillis||100;return function(l){window.clearTimeout(s),s=window.setTimeout(function(){var s=i+=1,o=t.data,c=t.transport||e.ajax,a=t.traditional||!1,r=t.type||"GET",o=o.call(this,l.term,l.page,l.context);null!==n&&n.abort(),n=c.call(null,{url:t.url,dataType:t.dataType,data:o,type:r,traditional:a,success:function(e){s<i||(e=t.results(e,l.page),l.callback(e))}})},o)}}function r(t){var s,i=t,n=function(e){return""+e.text};return e.isArray(i)||(n=i.text,e.isFunction(n)||(s=i.text,n=function(e){return e[s]}),i=i.results),function(t){var s,o=t.term,l={results:[]};""===o?t.callback({results:i}):(s=function(i,l){var c,a,i=i[0];if(i.children){c={};for(a in i)i.hasOwnProperty(a)&&(c[a]=i[a]);c.children=[],e(i.children).each2(function(e,t){s(t,c.children)}),c.children.length&&l.push(c)}else t.matcher(o,n(i))&&l.push(i)},e(i).each2(function(e,t){s(t,l.results)}),t.callback(l))}}function h(s){return e.isFunction(s)?s:function(i){var n=i.term,o={results:[]};e(s).each(function(){var e=this.text!==t,s=e?this.text:this;(""===n||i.matcher(n,s))&&o.results.push(e?this:{id:this,text:this})}),i.callback(o)}}function d(t){if(e.isFunction(t))return!0;if(!t)return!1;throw Error("formatterName must be a function or a falsy value")}function u(t){return e.isFunction(t)?t():t}function p(t){var s=0;return e.each(t,function(e,t){t.children?s+=p(t.children):s++}),s}function f(e,s,n,o){var l,c,a,r,h=e,d=!1;if(!o.createSearchChoice||!o.tokenSeparators||1>o.tokenSeparators.length)return t;for(;;){for(d=-1,c=0,a=o.tokenSeparators.length;c<a&&(r=o.tokenSeparators[c],!(0<=(d=e.indexOf(r))));c++);if(0>d)break;if(l=e.substring(0,d),e=e.substring(d+r.length),0<l.length&&(l=o.createSearchChoice(l,s))!==t&&null!==l&&o.id(l)!==t&&null!==o.id(l)){for(d=!1,c=0,a=s.length;c<a;c++)if(i(o.id(l),o.id(s[c]))){d=!0;break}d||n(l)}}return 0!=h.localeCompare(e)?e:void 0}function g(t,s){var i=function(){};return i.prototype=new t,i.prototype.constructor=i,i.prototype.parent=t.prototype,i.prototype=e.extend(i.prototype,s),i}if(window.Select2===t){var m,v,b,w,C,S;m={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case m.LEFT:case m.RIGHT:case m.UP:case m.DOWN:return!0}return!1},isControl:function(e){switch(e.which){case m.SHIFT:case m.CTRL:case m.ALT:return!0}return!!e.metaKey},isFunctionKey:function(e){return 112<=(e=e.which?e.which:e)&&123>=e}};var y=1;C=function(){return y++},e(document).delegate("body","mousemove",function(t){e.data(document,"select2-lastpos",{x:t.pageX,y:t.pageY})}),e(document).ready(function(){e(document).delegate("body","mousedown touchend",function(s){var i,n=e(s.target).closest("div.select2-container").get(0);n?e(document).find("div.select2-container-active").each(function(){this!==n&&e(this).data("select2").blur()}):(n=e(s.target).closest("div.select2-drop").get(0),e(document).find("div.select2-drop-active").each(function(){this!==n&&e(this).data("select2").blur()})),n=e(s.target),i=n.attr("for"),"LABEL"===s.target.tagName&&i&&0<i.length&&(n=e("#"+i),(n=n.data("select2"))!==t&&(n.focus(),s.preventDefault()))})}),v=g(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(i){var n,c;this.opts=i=this.prepareOpts(i),this.id=i.id,i.element.data("select2")!==t&&null!==i.element.data("select2")&&this.destroy(),this.enabled=!0,this.container=this.createContainer(),this.containerId="s2id_"+(i.element.attr("id")||"autogen"+C()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId);var a,r=!1;this.body=function(){return!1===r&&(a=i.element.closest("body"),r=!0),a},i.element.attr("class")!==t&&this.container.addClass(i.element.attr("class").replace(/validate\[[\S ]+] ?/,"")),this.container.css(u(i.containerCss)),this.container.addClass(u(i.containerCssClass)),this.opts.element.data("select2",this).hide().before(this.container),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),this.dropdown.addClass(u(i.dropdownCssClass)),this.dropdown.data("select2",this),this.results=n=this.container.find(".select2-results"),this.search=c=this.container.find("input.select2-input"),c.attr("tabIndex",this.opts.element.attr("tabIndex")),this.resultsPage=0,this.context=null,this.initContainer(),this.initContainerWidth(),this.results.bind("mousemove",function(s){var i=e.data(document,"select2-lastpos");(i===t||i.x!==s.pageX||i.y!==s.pageY)&&e(s.target).trigger("mousemove-filtered",s)}),this.dropdown.delegate(".select2-results","mousemove-filtered",this.bind(this.highlightUnderEvent));var h=this.results,d=o(80,function(e){h.trigger("scroll-debounced",e)});h.bind("scroll",function(e){0<=s(e.target,h.get())&&d(e)}),this.dropdown.delegate(".select2-results","scroll-debounced",this.bind(this.loadMoreIfNeeded)),e.fn.mousewheel&&n.mousewheel(function(e,t,s,i){t=n.scrollTop(),0<i&&0>=t-i?(n.scrollTop(0),l(e)):0>i&&n.get(0).scrollHeight-n.scrollTop()+i<=n.height()&&(n.scrollTop(n.get(0).scrollHeight-n.height()),l(e))}),c.bind("keydown",function(){e.data(c,"keyup-change-value")===t&&e.data(c,"keyup-change-value",c.val())}),c.bind("keyup",function(){var s=e.data(c,"keyup-change-value");s!==t&&c.val()!==s&&(e.removeData(c,"keyup-change-value"),c.trigger("keyup-change"))}),c.bind("keyup-change",this.bind(this.updateResults)),c.bind("focus",function(){c.addClass("select2-focused")," "===c.val()&&c.val("")}),c.bind("blur",function(){c.removeClass("select2-focused")}),this.dropdown.delegate(".select2-results","mouseup",this.bind(function(t){0<e(t.target).closest(".select2-result-selectable:not(.select2-disabled)").length?(this.highlightUnderEvent(t),this.selectHighlighted(t)):this.focusSearch(),l(t)})),this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation()}),e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),(i.element.is(":disabled")||i.element.is("[readonly='readonly']"))&&this.disable()},destroy:function(){var e=this.opts.element.data("select2");e!==t&&(e.container.remove(),e.dropdown.remove(),e.opts.element.removeData("select2").unbind(".select2").show())},prepareOpts:function(s){var o,l,c;if(o=s.element,"select"===o.get(0).tagName.toLowerCase()&&(this.select=l=s.element),l&&e.each("id multiple ajax query createSearchChoice initSelection data tags".split(" "),function(){if(this in s)throw Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),s=e.extend({},{populateResults:function(i,n,o){var l,c=this.opts.id,a=this;(l=function(i,n,r){var h,d,u,p,f,g,m;for(h=0,d=i.length;h<d;h+=1)u=i[h],p=c(u)!==t,f=u.children&&u.children.length>0,g=e("<li></li>"),g.addClass("select2-results-dept-"+r),g.addClass("select2-result"),g.addClass(p?"select2-result-selectable":"select2-result-unselectable"),f&&g.addClass("select2-result-with-children"),g.addClass(a.opts.formatResultCssClass(u)),p=e("<div></div>"),p.addClass("select2-result-label"),m=s.formatResult(u,p,o),m!==t&&p.html(a.opts.escapeMarkup(m)),g.append(p),f&&(f=e("<ul></ul>"),f.addClass("select2-result-sub"),l(u.children,f,r+1),g.append(f)),g.data("select2-data",u),n.append(g)})(n,i,0)}},e.fn.select2.defaults,s),"function"!=typeof s.id&&(c=s.id,s.id=function(e){return e[c]}),l?(s.query=this.bind(function(s){var i,n,l,c={results:[],more:!1},a=s.term;l=function(e,t){var i;e.is("option")?s.matcher(a,e.text(),e)&&t.push({id:e.attr("value"),text:e.text(),element:e.get(),css:e.attr("class")}):e.is("optgroup")&&(i={text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")},e.children().each2(function(e,t){l(t,i.children)}),i.children.length>0&&t.push(i))},i=o.children(),this.getPlaceholder()!==t&&i.length>0&&(n=i[0],""===e(n).text()&&(i=i.not(n))),i.each2(function(e,t){l(t,c.results)}),s.callback(c)}),s.id=function(e){return e.id},s.formatResultCssClass=function(e){return e.css}):"query"in s||("ajax"in s?((l=s.element.data("ajax-url"))&&0<l.length&&(s.ajax.url=l),s.query=a(s.ajax)):"data"in s?s.query=r(s.data):"tags"in s&&(s.query=h(s.tags),s.createSearchChoice=function(e){return{id:e,text:e}},s.initSelection=function(t,o){var l=[];e(n(t.val(),s.separator)).each(function(){var t=this,n=this,o=s.tags;e.isFunction(o)&&(o=o()),e(o).each(function(){if(i(this.id,t))return n=this.text,!1}),l.push({id:t,text:n})}),o(l)})),"function"!=typeof s.query)throw"query function not defined for Select2 "+s.element.attr("id");return s},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(){!0!==this.opts.element.data("select2-change-triggered")&&this.initSelection()}))},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},enable:function(){this.enabled||(this.enabled=!0,this.container.removeClass("select2-container-disabled"))},disable:function(){this.enabled&&(this.close(),this.enabled=!1,this.container.addClass("select2-container-disabled"))},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t,s=this.container.offset(),i=this.container.outerHeight(),n=this.container.outerWidth(),o=this.dropdown.outerHeight(),l=e(window).scrollTop()+document.documentElement.clientHeight,i=s.top+i,c=s.left,l=i+o<=l,a=s.top-o>=this.body().scrollTop(),r=this.dropdown.hasClass("select2-drop-above");"static"!==this.body().css("position")&&(t=this.body().offset(),i-=t.top,c-=t.left),r?(r=!0,!a&&l&&(r=!1)):(r=!1,!l&&a&&(r=!0)),r?(i=s.top-o,this.container.addClass("select2-drop-above"),this.dropdown.addClass("select2-drop-above")):(this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")),s=e.extend({top:i,left:c,width:n},u(this.opts.dropdownCss)),this.dropdown.css(s)},shouldOpen:function(){var t;return!this.opened()&&(t=e.Event("open"),this.opts.element.trigger(t),!t.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return!!this.shouldOpen()&&(window.setTimeout(this.bind(this.opening),1),!0)},opening:function(){var t=this.containerId,s=this.containerSelector,i="scroll."+t,n="resize."+t;this.container.parents().each(function(){e(this).bind(i,function(){var t=e(s);0==t.length&&e(this).unbind(i),t.select2("close")})}),e(window).bind(n,function(){var t=e(s);0==t.length&&e(window).unbind(n),t.select2("close")}),this.clearDropdownAlignmentPreference()," "===this.search.val()&&this.search.val(""),this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.updateResults(!0),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active"),this.ensureHighlightVisible(),this.focusSearch()},close:function(){if(this.opened()){var t=this;this.container.parents().each(function(){e(this).unbind("scroll."+t.containerId)}),e(window).unbind("resize."+this.containerId),this.clearDropdownAlignmentPreference(),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),this.clearSearch(),this.opts.element.trigger(e.Event("close"))}},clearSearch:function(){},ensureHighlightVisible:function(){var t,s,i,n,o=this.results;0>(s=this.highlight())||(0==s?o.scrollTop(0):(t=o.find(".select2-result-selectable"),i=e(t[s]),n=i.offset().top+i.outerHeight(),s===t.length-1&&(t=o.find("li.select2-more-results"),0<t.length&&(n=t.offset().top+t.outerHeight())),t=o.offset().top+o.outerHeight(),n>t&&o.scrollTop(o.scrollTop()+(n-t)),0>(i=i.offset().top-o.offset().top)&&o.scrollTop(o.scrollTop()+i)))},moveHighlight:function(t){for(var s=this.results.find(".select2-result-selectable"),i=this.highlight();-1<i&&i<s.length;){var i=i+t,n=e(s[i]);if(n.hasClass("select2-result-selectable")&&!n.hasClass("select2-disabled")){this.highlight(i);break}}},highlight:function(t){var i=this.results.find(".select2-result-selectable").not(".select2-disabled");if(0===arguments.length)return s(i.filter(".select2-highlighted")[0],i.get());t>=i.length&&(t=i.length-1),0>t&&(t=0),i.removeClass("select2-highlighted"),e(i[t]).addClass("select2-highlighted"),this.ensureHighlightVisible()},countSelectableResults:function(){return this.results.find(".select2-result-selectable").not(".select2-disabled").length},highlightUnderEvent:function(t){if(t=e(t.target).closest(".select2-result-selectable"),0<t.length&&!t.is(".select2-highlighted")){var s=this.results.find(".select2-result-selectable");this.highlight(s.index(t))}else 0==t.length&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var e=this.results,t=e.find("li.select2-more-results"),s=this.resultsPage+1,i=this,n=this.search.val(),o=this.context;0!==t.length&&0>=t.offset().top-e.offset().top-e.height()&&(t.addClass("select2-active"),this.opts.query({term:n,page:s,context:o,matcher:this.opts.matcher,callback:this.bind(function(l){i.opened()&&(i.opts.populateResults.call(this,e,l.results,{term:n,page:s,context:o}),!0===l.more?(t.detach().appendTo(e).text(i.opts.formatLoadMore(s+1)),window.setTimeout(function(){i.loadMoreIfNeeded()},10)):t.remove(),i.positionDropdown(),i.resultsPage=s)})}))},tokenize:function(){},updateResults:function(s){function n(){a.scrollTop(0),c.removeClass("select2-active"),h.positionDropdown()}function o(e){a.html(h.opts.escapeMarkup(e)),n()}var l,c=this.search,a=this.results,r=this.opts,h=this;if(!0===s||!1!==this.showSearchInput&&this.opened()){if(c.addClass("select2-active"),1<=r.maximumSelectionSize&&(l=this.data(),e.isArray(l)&&l.length>=r.maximumSelectionSize&&d(r.formatSelectionTooBig)))return void o("<li class='select2-selection-limit'>"+r.formatSelectionTooBig(r.maximumSelectionSize)+"</li>");c.val().length<r.minimumInputLength&&d(r.formatInputTooShort)?o("<li class='select2-no-results'>"+r.formatInputTooShort(c.val(),r.minimumInputLength)+"</li>"):(o("<li class='select2-searching'>"+r.formatSearching()+"</li>"),l=this.tokenize(),l!=t&&null!=l&&c.val(l),this.resultsPage=1,r.query({term:c.val(),page:this.resultsPage,context:null,matcher:r.matcher,callback:this.bind(function(l){var u;this.opened()&&(this.context=l.context===t?null:l.context,this.opts.createSearchChoice&&""!==c.val()&&(u=this.opts.createSearchChoice.call(null,c.val(),l.results))!==t&&null!==u&&h.id(u)!==t&&null!==h.id(u)&&0===e(l.results).filter(function(){return i(h.id(this),h.id(u))}).length&&l.results.unshift(u),0===l.results.length&&d(r.formatNoMatches)?o("<li class='select2-no-results'>"+r.formatNoMatches(c.val())+"</li>"):(a.empty(),h.opts.populateResults.call(this,a,l.results,{term:c.val(),page:this.resultsPage,context:null}),!0===l.more&&d(r.formatLoadMore)&&(a.append("<li class='select2-more-results'>"+h.opts.escapeMarkup(r.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){h.loadMoreIfNeeded()},10)),this.postprocessResults(l,s),n()))})}))}},cancel:function(){this.close()},blur:function(){this.close(),this.container.removeClass("select2-container-active"),this.dropdown.removeClass("select2-drop-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){this.search.show(),this.search.focus(),window.setTimeout(this.bind(function(){this.search.show(),this.search.focus(),this.search.val(this.search.val())}),10)},selectHighlighted:function(){var e=this.highlight(),t=this.results.find(".select2-highlighted").not(".select2-disabled"),s=t.closest(".select2-result-selectable").data("select2-data");s&&(t.addClass("select2-disabled"),this.highlight(e),this.onSelect(s))},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},initContainerWidth:function(){var s=function(){var s,i,n,o;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth()?"auto":this.opts.element.outerWidth()+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if((s=this.opts.element.attr("style"))!==t)for(s=s.split(";"),n=0,o=s.length;n<o;n+=1)if(null!==(i=s[n].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/))&&1<=i.length)return i[1];return"resolve"===this.opts.width?(s=this.opts.element.css("width"),0<s.indexOf("%")?s:0===this.opts.element.outerWidth()?"auto":this.opts.element.outerWidth()+"px"):null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}.call(this);null!==s&&this.container.attr("style","width: "+s)}}),b=g(v,{createContainer:function(){return e("<div></div>",{class:"select2-container"}).html("    <a href='#' onclick='return false;' class='select2-choice'>   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>   <div><b></b></div></a>    <div class='select2-drop select2-offscreen'>   <div class='select2-search'>       <input type='text' autocomplete='off' class='select2-input'/>   </div>   <ul class='select2-results'>   </ul></div>")},opening:function(){this.search.show(),this.parent.opening.apply(this,arguments),this.dropdown.removeClass("select2-offscreen")},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.dropdown.removeAttr("style").addClass("select2-offscreen").insertAfter(this.selection).show())},focus:function(){this.close(),this.selection.focus()},isFocused:function(){return this.selection[0]===document.activeElement},cancel:function(){this.parent.cancel.apply(this,arguments),this.selection.focus()},initContainer:function(){var e,t=this.dropdown;this.selection=e=this.container.find(".select2-choice"),this.search.bind("keydown",this.bind(function(e){if(this.enabled)if(e.which===m.PAGE_UP||e.which===m.PAGE_DOWN)l(e);else if(this.opened())switch(e.which){case m.UP:case m.DOWN:this.moveHighlight(e.which===m.UP?-1:1),l(e);break;case m.TAB:case m.ENTER:this.selectHighlighted(),l(e);break;case m.ESC:this.cancel(e),l(e)}else e.which===m.TAB||m.isControl(e)||m.isFunctionKey(e)||e.which===m.ESC||!1===this.opts.openOnEnter&&e.which===m.ENTER||this.open()})),this.search.bind("focus",this.bind(function(){this.selection.attr("tabIndex","-1")})),this.search.bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active"),window.setTimeout(this.bind(function(){this.selection.attr("tabIndex",this.opts.element.attr("tabIndex"))}),10)})),e.bind("mousedown",this.bind(function(){this.opened()?(this.close(),this.selection.focus()):this.enabled&&this.open()})),t.bind("mousedown",this.bind(function(){this.search.focus()})),e.bind("focus",this.bind(function(){this.container.addClass("select2-container-active"),this.search.attr("tabIndex","-1")})),e.bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active"),window.setTimeout(this.bind(function(){this.search.attr("tabIndex",this.opts.element.attr("tabIndex"))}),10)})),e.bind("keydown",this.bind(function(e){if(this.enabled)if(e.which===m.PAGE_UP||e.which===m.PAGE_DOWN)l(e);else if(!(e.which===m.TAB||m.isControl(e)||m.isFunctionKey(e)||e.which===m.ESC||!1===this.opts.openOnEnter&&e.which===m.ENTER))if(e.which==m.DELETE)this.opts.allowClear&&this.clear();else{if(this.open(),e.which!==m.ENTER&&!(48>e.which)){var t=String.fromCharCode(e.which).toLowerCase();e.shiftKey&&(t=t.toUpperCase()),this.search.focus(),this.search.val(t)}l(e)}})),e.delegate("abbr","mousedown",this.bind(function(e){this.enabled&&(this.clear(),l(e),this.close(),this.triggerChange(),this.selection.focus())})),this.setPlaceholder(),this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")}))},clear:function(){this.opts.element.val(""),this.selection.find("span").empty(),this.selection.removeData("select2-data"),this.setPlaceholder()},initSelection:function(){if(""===this.opts.element.val())this.close(),this.setPlaceholder();else{var e=this;this.opts.initSelection.call(null,this.opts.element,function(s){s!==t&&null!==s&&(e.updateSelection(s),e.close(),e.setPlaceholder())})}},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return"select"===t.element.get(0).tagName.toLowerCase()&&(t.initSelection=function(t,s){var i=t.find(":selected");e.isFunction(s)&&s({id:i.attr("value"),text:i.text()})}),t},setPlaceholder:function(){var e=this.getPlaceholder();""===this.opts.element.val()&&e!==t&&!(this.select&&""!==this.select.find("option:first").text())&&(this.selection.find("span").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.selection.find("abbr").hide())},postprocessResults:function(t,s){var n=0,o=this,l=!0;this.results.find(".select2-result-selectable").each2(function(e,t){if(i(o.id(t.data("select2-data")),o.opts.element.val()))return n=e,!1}),this.highlight(n),!0===s&&(l=this.showSearchInput=p(t.results)>=this.opts.minimumResultsForSearch,this.dropdown.find(".select2-search")[l?"removeClass":"addClass"]("select2-search-hidden"),e(this.dropdown,this.container)[l?"addClass":"removeClass"]("select2-with-searchbox"))},onSelect:function(e){var t=this.opts.element.val();this.opts.element.val(this.id(e)),this.updateSelection(e),this.close(),this.selection.focus(),i(t,this.id(e))||this.triggerChange()},updateSelection:function(e){var s=this.selection.find("span");this.selection.data("select2-data",e),s.empty(),e=this.opts.formatSelection(e,s),e!==t&&s.append(this.opts.escapeMarkup(e)),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.selection.find("abbr").show()},val:function(){var e,s=null,i=this;if(0===arguments.length)return this.opts.element.val();if(e=arguments[0],this.select)this.select.val(e).find(":selected").each2(function(e,t){return s={id:t.attr("value"),text:t.text()},!1}),this.updateSelection(s),this.setPlaceholder();else{if(this.opts.initSelection===t)throw Error("cannot call val() if initSelection() is not defined");e?(this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){i.opts.element.val(e?i.id(e):""),i.updateSelection(e),i.setPlaceholder()})):this.clear()}},clearSearch:function(){this.search.val("")},data:function(e){var s;if(0===arguments.length)return s=this.selection.data("select2-data"),s==t&&(s=null),s;e&&""!==e?(this.opts.element.val(e?this.id(e):""),this.updateSelection(e)):this.clear()}}),w=g(v,{createContainer:function(){return e("<div></div>",{class:"select2-container select2-container-multi"}).html("    <ul class='select2-choices'>  <li class='select2-search-field'>    <input type='text' autocomplete='off' class='select2-input'>  </li></ul><div class='select2-drop select2-drop-multi' style='display:none;'>   <ul class='select2-results'>   </ul></div>")},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return"select"===t.element.get(0).tagName.toLowerCase()&&(t.initSelection=function(t,s){var i=[];t.find(":selected").each2(function(e,t){i.push({id:t.attr("value"),text:t.text()})}),e.isFunction(s)&&s(i)}),t},initContainer:function(){var t;this.searchContainer=this.container.find(".select2-search-field"),this.selection=t=this.container.find(".select2-choices"),this.search.bind("keydown",this.bind(function(e){if(this.enabled){if(e.which===m.BACKSPACE&&""===this.search.val()){this.close();var s;if(s=t.find(".select2-search-choice-focus"),0<s.length)return this.unselect(s.first()),this.search.width(10),void l(e);s=t.find(".select2-search-choice"),0<s.length&&s.last().addClass("select2-search-choice-focus")}else t.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");if(this.opened())switch(e.which){case m.UP:case m.DOWN:return this.moveHighlight(e.which===m.UP?-1:1),void l(e);case m.ENTER:case m.TAB:return this.selectHighlighted(),void l(e);case m.ESC:return this.cancel(e),void l(e)}e.which===m.TAB||m.isControl(e)||m.isFunctionKey(e)||e.which===m.BACKSPACE||e.which===m.ESC||!1===this.opts.openOnEnter&&e.which===m.ENTER||(this.open(),(e.which===m.PAGE_UP||e.which===m.PAGE_DOWN)&&l(e))}})),this.search.bind("keyup",this.bind(this.resizeSearch)),this.search.bind("blur",this.bind(function(e){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.clearSearch(),e.stopImmediatePropagation()})),this.container.delegate(".select2-choices","mousedown",this.bind(function(t){this.enabled&&!(0<e(t.target).closest(".select2-search-choice").length)&&(this.clearPlaceholder(),this.open(),this.focusSearch(),t.preventDefault())})),this.container.delegate(".select2-choices","focus",this.bind(function(){this.enabled&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.clearSearch()},enable:function(){this.enabled||(this.parent.enable.apply(this,arguments),this.search.removeAttr("disabled"))},disable:function(){this.enabled&&(this.parent.disable.apply(this,arguments),this.search.attr("disabled",!0))},initSelection:function(){if(""===this.opts.element.val()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var e=this;this.opts.initSelection.call(null,this.opts.element,function(s){s!==t&&null!==s&&(e.updateSelection(s),e.close(),e.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder();e!==t&&0===this.getVal().length&&!1===this.search.hasClass("select2-focused")?(this.search.val(e).addClass("select2-default"),this.resizeSearch()):this.search.val(" ").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")?this.search.val("").removeClass("select2-default"):" "===this.search.val()&&this.search.val("")},opening:function(){this.parent.opening.apply(this,arguments),this.clearPlaceholder(),this.resizeSearch(),this.focusSearch()},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var i=[],n=[],o=this;e(t).each(function(){0>s(o.id(this),i)&&(i.push(o.id(this)),n.push(this))}),t=n,this.selection.find(".select2-search-choice").remove(),e(t).each(function(){o.addSelectedChoice(this)}),o.postprocessResults()},tokenize:function(){var e=this.search.val(),e=this.opts.tokenizer(e,this.data(),this.bind(this.onSelect),this.opts);null!=e&&e!=t&&(this.search.val(e),0<e.length&&this.open())},onSelect:function(e){this.addSelectedChoice(e),this.select&&this.postprocessResults(),this.opts.closeOnSelect?(this.close(),this.search.width(10)):0<this.countSelectableResults()?(this.search.width(10),this.resizeSearch(),this.positionDropdown()):this.close(),this.triggerChange({added:e}),this.focusSearch()},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(t){var s,i=e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),n=this.id(t),o=this.getVal();s=this.opts.formatSelection(t,i),i.find("div").replaceWith("<div>"+this.opts.escapeMarkup(s)+"</div>"),i.find(".select2-search-choice-close").bind("mousedown",l).bind("click dblclick",this.bind(function(t){this.enabled&&(e(t.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),l(t))})).bind("focus",this.bind(function(){this.enabled&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),i.data("select2-data",t),i.insertBefore(this.searchContainer),o.push(n),this.setVal(o)},unselect:function(e){var t,i,n=this.getVal(),e=e.closest(".select2-search-choice");if(0===e.length)throw"Invalid argument: "+e+". Must be .select2-search-choice";t=e.data("select2-data"),i=s(this.id(t),n),0<=i&&(n.splice(i,1),this.setVal(n),this.select&&this.postprocessResults()),e.remove(),this.triggerChange({removed:t})},postprocessResults:function(){var e=this.getVal(),t=this.results.find(".select2-result-selectable"),i=this.results.find(".select2-result-with-children"),n=this;t.each2(function(t,i){0<=s(n.id(i.data("select2-data")),e)?i.addClass("select2-disabled").removeClass("select2-result-selectable"):i.removeClass("select2-disabled").addClass("select2-result-selectable")}),i.each2(function(e,t){0==t.find(".select2-result-selectable").length?t.addClass("select2-disabled"):t.removeClass("select2-disabled")}),t.each2(function(e,t){if(!t.hasClass("select2-disabled")&&t.hasClass("select2-result-selectable"))return n.highlight(0),!1})},resizeSearch:function(){var t,s,i,n,o=this.search.outerWidth()-this.search.width();t=this.search,S||(i=t[0].currentStyle||window.getComputedStyle(t[0],null),S=e("<div></div>").css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:i.fontSize,fontFamily:i.fontFamily,fontStyle:i.fontStyle,fontWeight:i.fontWeight,letterSpacing:i.letterSpacing,textTransform:i.textTransform,whiteSpace:"nowrap"}),e("body").append(S)),S.text(t.val()),t=S.width()+10,s=this.search.offset().left,i=this.selection.width(),n=this.selection.offset().left,s=i-(s-n)-o,s<t&&(s=i-o),40>s&&(s=i-o),this.search.width(s)},getVal:function(){var e;return this.select?(e=this.select.val(),null===e?[]:e):(e=this.opts.element.val(),n(e,this.opts.separator))},setVal:function(t){var i;this.select?this.select.val(t):(i=[],e(t).each(function(){0>s(this,i)&&i.push(this)}),this.opts.element.val(0===i.length?"":i.join(this.opts.separator)))},val:function(){var s,i=[],n=this;if(0===arguments.length)return this.getVal();if(s=arguments[0])if(this.setVal(s),this.select)this.select.find(":selected").each(function(){i.push({id:e(this).attr("value"),text:e(this).text()})}),this.updateSelection(i);else{if(this.opts.initSelection===t)throw Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(t){var s=e(t).map(n.id);n.setVal(s),n.updateSelection(t),n.clearSearch()})}else this.opts.element.val(""),this.updateSelection([]);this.clearSearch()},onSortStart:function(){
if(this.select)throw Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],s=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){t.push(s.opts.id(e(this).data("select2-data")))}),this.setVal(t),this.triggerChange()},data:function(t){var s,i=this;if(0===arguments.length)return this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get();t||(t=[]),s=e.map(t,function(e){return i.opts.id(e)}),this.setVal(s),this.updateSelection(t),this.clearSearch()}}),e.fn.select2=function(){var i,n,o,l,c=Array.prototype.slice.call(arguments,0),a="val destroy opened open close focus isFocused container onSortStart onSortEnd enable disable positionDropdown data".split(" ");return this.each(function(){if(0===c.length||"object"==typeof c[0])i=0===c.length?{}:e.extend({},c[0]),i.element=e(this),"select"===i.element.get(0).tagName.toLowerCase()?l=i.element.attr("multiple"):(l=i.multiple||!1,"tags"in i&&(i.multiple=l=!0)),n=l?new w:new b,n.init(i);else{if("string"!=typeof c[0])throw"Invalid arguments to select2 plugin: "+c;if(0>s(c[0],a))throw"Unknown method: "+c[0];if(o=t,(n=e(this).data("select2"))!==t&&(o="container"===c[0]?n.container:n[c[0]].apply(n,c.slice(1)))!==t)return!1}}),o===t?this:o},e.fn.select2.defaults={width:"copy",closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,s){return t=[],c(e.text,s.term,t),t.join("")},formatSelection:function(e){return e?e.text:t},formatResultCssClass:function(){return t},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){return"Please enter "+(t-e.length)+" more characters"},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(1==e?"":"s")},formatLoadMore:function(){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(e,t){return 0<=t.toUpperCase().indexOf(e.toUpperCase())},separator:",",tokenSeparators:[],tokenizer:f,escapeMarkup:function(e){return e&&"string"==typeof e?e.replace(/&/g,"&amp;"):e},blurOnChange:!1},window.Select2={query:{ajax:a,local:r,tags:h},util:{debounce:o,markMatch:c},class:{abstract:v,single:b,multi:w}}}}(jQuery);