!function(i){var t=i.ligerui;i(".l-dialog-btn").live("mouseover",function(){i(this).addClass("l-dialog-btn-over")}).live("mouseout",function(){i(this).removeClass("l-dialog-btn-over")}),i(".l-dialog-tc .l-dialog-close").live("mouseover",function(){i(this).addClass("l-dialog-close-over")}).live("mouseout",function(){i(this).removeClass("l-dialog-close-over")}),i.ligerDialog=function(){return t.run.call(null,"ligerDialog",arguments,{isStatic:!0})},i.ligerui.DialogImagePath="../../lib/ligerUI/skins/Aqua/images/win/",i.ligerDefaults.Dialog={cls:null,contentCls:null,id:null,buttons:null,isDrag:!0,width:280,height:null,content:"",target:null,url:null,urlParms:null,load:!1,type:"none",left:null,top:null,modal:!0,data:null,name:null,isResize:!1,allowClose:!0,opener:null,timeParmName:null,closeWhenEnter:null,isHidden:!0,show:!0,title:"提示",showMax:!1,showToggle:!1,showMin:!1,slide:!i.browser.msie,fixedType:null,showType:null,layoutMode:1,onLoaded:null,onExtend:null,onExtended:null,onCollapse:null,onCollapseed:null,onContentHeightChange:null,onClose:null,onClosed:null,onStopResize:null,minIsHide:!1},i.ligerDefaults.DialogString={titleMessage:"提示",ok:"确定",yes:"是",no:"否",cancel:"取消",waittingMessage:"正在等待中,请稍候..."},i.ligerMethos.Dialog=i.ligerMethos.Dialog||{},t.controls.Dialog=function(i){t.controls.Dialog.base.constructor.call(this,null,i)},t.controls.Dialog.ligerExtend(t.core.Win,{__getType:function(){return"Dialog"},__idPrev:function(){return"Dialog"},_extendMethods:function(){return i.ligerMethos.Dialog},_render:function(){function e(){var t=0,e=0,a=l.width||o.dialog.width();1==l.slide&&(l.slide="fast"),null!=l.left?t=l.left:l.left=t=.5*(i(window).width()-a),null!=l.top?e=l.top:l.top=e=.5*(i(window).height()-o.dialog.height())+i(window).scrollTop()-10,t<0&&(l.left=t=0),e<0&&(l.top=e=0),o.dialog.css({left:t,top:e})}var o=this,l=this.options,a="";o.set(l,!0);var n=i('<div class="l-dialog"><table class="l-dialog-table" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="l-dialog-tl"></td><td class="l-dialog-tc"><div class="l-dialog-tc-inner"><div class="l-dialog-icon"></div><div class="l-dialog-title"></div><div class="l-dialog-winbtns"><div class="l-dialog-winbtn l-dialog-close"></div></div></div></td><td class="l-dialog-tr"></td></tr><tr><td class="l-dialog-cl"></td><td class="l-dialog-cc"><div class="l-dialog-body"><div class="l-dialog-image"></div> <div class="l-dialog-content"></div><div class="l-dialog-buttons"><div class="l-dialog-buttons-inner"></div></td><td class="l-dialog-cr"></td></tr><tr><td class="l-dialog-bl"></td><td class="l-dialog-bc"></td><td class="l-dialog-br"></td></tr></tbody></table></div>');if(i("body").append(n),o.dialog=n,2==l.layoutMode&&n.find("td.l-dialog-tl,td.l-dialog-cl,td.l-dialog-bl,td.l-dialog-tr,td.l-dialog-cr,td.l-dialog-br").remove(),o.element=n[0],o.dialog.body=i(".l-dialog-body:first",o.dialog),o.dialog.header=i(".l-dialog-tc-inner:first",o.dialog),o.dialog.winbtns=i(".l-dialog-winbtns:first",o.dialog.header),o.dialog.buttons=i(".l-dialog-buttons:first",o.dialog),o.dialog.content=i(".l-dialog-content:first",o.dialog),o.set(l,!1),0==l.allowClose&&i(".l-dialog-close",o.dialog).remove(),(l.target||l.url||"none"==l.type)&&(l.type=null,o.dialog.addClass("l-dialog-win")),l.cls&&o.dialog.addClass(l.cls),l.id&&o.dialog.attr("id",l.id),o.mask(),l.isDrag&&o._applyDrag(),l.isResize&&o._applyResize(),l.type?o._setImage():(i(".l-dialog-image",o.dialog).remove(),o.dialog.content.addClass("l-dialog-content-noimage")),l.contentCls&&o.dialog.content.addClass(l.contentCls),l.show||(o.unmask(),o.dialog.hide()),l.target)o.dialog.content.prepend(l.target),i(l.target).show();else if(l.url){var s=i.isFunction(l.url)?l.url.call(o):l.url,d=i.isFunction(l.urlParms)?l.urlParms.call(o):l.urlParms;if(l.timeParmName&&(d=d||{},d[l.timeParmName]=(new Date).getTime()),d)for(var g in d)s+=-1==s.indexOf("?")?"?":"&",s+=g+"="+d[g];if(l.load)o.dialog.body.load(s,function(){o._saveStatus(),o.trigger("loaded")});else{o.jiframe=i("<iframe frameborder='0'></iframe>");var r=l.name?l.name:"ligerwindow"+(new Date).getTime();o.jiframe.attr("name",r),o.jiframe.attr("id",r),o.dialog.content.prepend(o.jiframe),o.dialog.content.addClass("l-dialog-content-nopadding l-dialog-content-frame"),setTimeout(function(){0==o.dialog.body.find(".l-dialog-loading:first").length&&o.dialog.body.append("<div class='l-dialog-loading' style='display:block;'></div>");var t=i(".l-dialog-loading:first",o.dialog.body);o.jiframe[0].dialog=o,o.jiframe.attr("src",s).bind("load.dialog",function(){t.hide(),o.trigger("loaded")}),o.frame=window.frames[o.jiframe.attr("name")]},0),a="jquery_ligerui_"+(new Date).getTime(),o.tmpInput=i("<input></input>"),o.tmpInput.attr("id",a),o.dialog.content.prepend(o.tmpInput)}}l.opener&&(o.dialog.opener=l.opener),l.buttons?i(l.buttons).each(function(t,e){var l=i('<div class="l-dialog-btn"><div class="l-dialog-btn-l"></div><div class="l-dialog-btn-r"></div><div class="l-dialog-btn-inner"></div></div>');i(".l-dialog-btn-inner",l).html(e.text),i(".l-dialog-buttons-inner",o.dialog.buttons).prepend(l),e.width&&l.width(e.width),e.onclick&&l.click(function(){e.onclick(e,o,t)}),e.cls&&l.addClass(e.cls)}):o.dialog.buttons.remove(),i(".l-dialog-buttons-inner",o.dialog.buttons).append("<div class='l-clear'></div>"),i(".l-dialog-title",o.dialog).bind("selectstart",function(){return!1}),o.dialog.click(function(){t.win.setFront(o)}),i(".l-dialog-tc .l-dialog-close",o.dialog).click(function(){l.isHidden?o.hide():o.close()}),l.fixedType||("auto"==l.width?setTimeout(function(){e()},100):e()),o.show(),i("body").bind("keydown.dialog",function(i){var t=i.which;13==t?o.enter():27==t&&o.esc()}),o._updateBtnsWidth(),o._saveStatus(),o._onReisze(),""!=a&&(i("#"+a).focus(),i("#"+a).remove())},_borderX:12,_borderY:32,doMax:function(e){var o=this,l=this.options,a=i(window).width(),n=i(window).height(),s=0;t.win.taskbar&&(n-=t.win.taskbar.outerHeight(),t.win.top&&(s+=t.win.taskbar.outerHeight())),e?(o.dialog.body.animate({width:a-o._borderX},l.slide),o.dialog.animate({left:0,top:s},l.slide),o.dialog.content.animate({height:n-o._borderY-o.dialog.buttons.outerHeight()},l.slide,function(){o._onReisze()})):(o.set({width:a,height:n,left:0,top:s}),o._onReisze())},max:function(){var t=this,e=this.options;t.winmax&&(t.winmax.addClass("l-dialog-recover"),t.doMax(e.slide),t.wintoggle&&(t.wintoggle.hasClass("l-dialog-extend")?t.wintoggle.addClass("l-dialog-toggle-disabled l-dialog-extend-disabled"):t.wintoggle.addClass("l-dialog-toggle-disabled l-dialog-collapse-disabled")),t.resizable&&t.resizable.set({disabled:!0}),t.draggable&&t.draggable.set({disabled:!0}),t.maximum=!0,i(window).bind("resize.dialogmax",function(){t.doMax(!1)}))},recover:function(){var t=this,e=this.options;t.winmax&&(t.winmax.removeClass("l-dialog-recover"),e.slide?(t.dialog.body.animate({width:t._width-t._borderX},e.slide),t.dialog.animate({left:t._left,top:t._top},e.slide),t.dialog.content.animate({height:t._height-t._borderY-t.dialog.buttons.outerHeight()},e.slide,function(){t._onReisze()})):(t.set({width:t._width,height:t._height,left:t._left,top:t._top}),t._onReisze()),t.wintoggle&&t.wintoggle.removeClass("l-dialog-toggle-disabled l-dialog-extend-disabled l-dialog-collapse-disabled"),i(window).unbind("resize.dialogmax")),this.resizable&&this.resizable.set({disabled:!1}),t.draggable&&t.draggable.set({disabled:!1}),t.maximum=!1},min:function(){var i=this,e=this.options;if(e.minIsHide)i.dialog.hide();else{var o=t.win.getTask(this);e.slide?(i.dialog.body.animate({width:1},e.slide),o.y=o.offset().top+o.height(),o.x=o.offset().left+o.width()/2,i.dialog.animate({left:o.x,top:o.y},e.slide,function(){i.dialog.hide()})):i.dialog.hide()}i.unmask(),i.minimize=!0,i.actived=!1},active:function(){var e=this,o=this.options;if(e.minimize){var l=e._width,a=e._height,n=e._left,s=e._top;e.maximum&&(l=i(window).width(),a=i(window).height(),n=s=0,t.win.taskbar&&(a-=t.win.taskbar.outerHeight(),t.win.top&&(s+=t.win.taskbar.outerHeight()))),o.slide?(e.dialog.body.animate({width:l-e._borderX},o.slide),e.dialog.animate({left:n,top:s},o.slide)):e.set({width:l,height:a,left:n,top:s})}e.actived=!0,e.minimize=!1,t.win.setFront(e),e.show()},toggle:function(){var i=this;this.options;i.wintoggle&&(i.wintoggle.hasClass("l-dialog-extend")?i.extend():i.collapse())},collapse:function(i){var t=this,e=this.options;t.wintoggle&&(e.slide&&0!=i?t.dialog.content.animate({height:1},e.slide):t.dialog.content.height(1),this.resizable&&this.resizable.set({disabled:!0}),t.wintoggle.addClass("l-dialog-extend"))},extend:function(){var i=this,t=this.options;if(i.wintoggle){var e=i._height-i._borderY-i.dialog.buttons.outerHeight();t.slide?i.dialog.content.animate({height:e},t.slide):i.dialog.content.height(e),this.resizable&&this.resizable.set({disabled:!1}),i.wintoggle.removeClass("l-dialog-extend")}},_updateBtnsWidth:function(){var t=this,e=i(">div",t.dialog.winbtns).length;t.dialog.winbtns.width(22*e)},_setLeft:function(i){this.dialog&&null!=i&&this.dialog.css({left:i})},_setTop:function(i){this.dialog&&null!=i&&this.dialog.css({top:i})},_setWidth:function(i){this.dialog&&i>=this._borderX&&this.dialog.body.width(i-this._borderX)},_setHeight:function(i){var t=this,e=this.options;if(this.dialog)if("auto"==i)t.dialog.content.height("auto");else if(i>=this._borderY){var o=i-this._borderY-t.dialog.buttons.outerHeight();if(0==t.trigger("ContentHeightChange",[o]))return;e.load?t.dialog.body.height(o):t.dialog.content.height(o),t.trigger("ContentHeightChanged",[o])}},_setShowMax:function(t){var e=this;this.options;t?e.winmax||(e.winmax=i('<div class="l-dialog-winbtn l-dialog-max"></div>').appendTo(e.dialog.winbtns).hover(function(){i(this).hasClass("l-dialog-recover")?i(this).addClass("l-dialog-recover-over"):i(this).addClass("l-dialog-max-over")},function(){i(this).removeClass("l-dialog-max-over l-dialog-recover-over")}).click(function(){i(this).hasClass("l-dialog-recover")?e.recover():e.max()})):e.winmax&&(e.winmax.remove(),e.winmax=null),e._updateBtnsWidth()},_setShowMin:function(e){var o=this,l=this.options;e?o.winmin||(o.winmin=i('<div class="l-dialog-winbtn l-dialog-min"></div>').appendTo(o.dialog.winbtns).hover(function(){i(this).addClass("l-dialog-min-over")},function(){i(this).removeClass("l-dialog-min-over")}).click(function(){o.min()}),l.minIsHide||t.win.addTask(o)):o.winmin&&(o.winmin.remove(),o.winmin=null),o._updateBtnsWidth()},_setShowToggle:function(t){var e=this;this.options;t?e.wintoggle||(e.wintoggle=i('<div class="l-dialog-winbtn l-dialog-collapse"></div>').appendTo(e.dialog.winbtns).hover(function(){i(this).hasClass("l-dialog-toggle-disabled")||(i(this).hasClass("l-dialog-extend")?i(this).addClass("l-dialog-extend-over"):i(this).addClass("l-dialog-collapse-over"))},function(){i(this).removeClass("l-dialog-extend-over l-dialog-collapse-over")}).click(function(){if(!i(this).hasClass("l-dialog-toggle-disabled"))if(e.wintoggle.hasClass("l-dialog-extend")){if(0==e.trigger("extend"))return;e.wintoggle.removeClass("l-dialog-extend"),e.extend(),e.trigger("extended")}else{if(0==e.trigger("collapse"))return;e.wintoggle.addClass("l-dialog-extend"),e.collapse(),e.trigger("collapseed")}})):e.wintoggle&&(e.wintoggle.remove(),e.wintoggle=null)},enter:function(){var i,t=this,e=this.options;void 0!=e.closeWhenEnter?i=e.closeWhenEnter:"warn"!=e.type&&"error"!=e.type&&"success"!=e.type&&"question"!=e.type||(i=!0),i&&t.close()},esc:function(){},_removeDialog:function(){function t(){var t=i("iframe",e.dialog);if(t.length){var o=t[0];if(o.src="about:blank",o.contentWindow&&o.contentWindow.document)try{o.contentWindow.document.write("")}catch(i){}i.browser.msie&&CollectGarbage(),t.remove()}e.dialog.remove()}var e=this,o=this.options;o.showType&&o.fixedType?e.dialog.animate({bottom:-1*o.height},function(){t()}):t()},close:function(){var i=this;this.options;0!=i.trigger("Close")&&(i.doClose(),i.trigger("Closed"))},doClose:function(){var e=this;t.win.removeTask(this),i.ligerui.remove(this),e.unmask(),e._removeDialog(),i("body").unbind("keydown.dialog")},_getVisible:function(){return this.dialog.is(":visible")},_setUrl:function(i){var t=this,e=this.options;e.url=i,e.load?t.dialog.body.html("").load(e.url,function(){t.trigger("loaded")}):t.jiframe&&t.jiframe.attr("src",e.url)},_setContent:function(i){this.dialog.content.html(i)},_setTitle:function(t){var e=this;this.options;t&&i(".l-dialog-title",e.dialog).html(t)},_hideDialog:function(){var i=this,t=this.options;t.showType&&t.fixedType?i.dialog.animate({bottom:-1*t.height},function(){i.dialog.hide()}):i.dialog.hide()},hidden:function(){var i=this;t.win.removeTask(i),i.dialog.hide(),i.unmask()},show:function(){var t=this,e=this.options;t.mask(),e.fixedType?e.showType?(t.dialog.css({bottom:-1*e.height}).addClass("l-dialog-fixed"),t.dialog.show().animate({bottom:0})):t.dialog.show().css({bottom:0}).addClass("l-dialog-fixed"):t.dialog.show(),i.ligerui.win.setFront.ligerDefer(i.ligerui.win,100,[t])},setUrl:function(i){this._setUrl(i)},_saveStatus:function(){var i=this;i._width=i.dialog.body.width(),i._height=i.dialog.body.height();var t=0,e=0;isNaN(parseInt(i.dialog.css("top")))||(t=parseInt(i.dialog.css("top"))),isNaN(parseInt(i.dialog.css("left")))||(e=parseInt(i.dialog.css("left"))),i._top=t,i._left=e},_applyDrag:function(){var e=this,o=this.options;i.fn.ligerDrag&&(e.draggable=e.dialog.ligerDrag({handler:".l-dialog-title",animate:!1,onStartDrag:function(){t.win.setFront(e);var o=i("<div class='l-dragging-mask' style='display:block'></div>").height(e.dialog.height());e.dialog.append(o),e.dialog.content.addClass("l-dialog-content-dragging")},onDrag:function(i,t){if((t.pageY||t.screenY)<0)return!1},onStopDrag:function(){if(e.dialog.find("div.l-dragging-mask:first").remove(),e.dialog.content.removeClass("l-dialog-content-dragging"),o.target){var l=t.find(i.ligerui.controls.DateEditor),a=t.find(i.ligerui.controls.ComboBox);i(i.merge(l,a)).each(function(){this.updateSelectBoxPosition&&this.updateSelectBoxPosition()})}e._saveStatus()}}))},_onReisze:function(){var t=this,e=this.options;if(e.target||e.url){var o=i(e.target).liger();if(o||(o=i(e.target).find(":first").liger()),!o)return;var l=t.dialog.content.height(),a=t.dialog.content.width();o.trigger("resize",[{width:a,height:l}])}},_applyResize:function(){var t=this;this.options;i.fn.ligerResizable&&(t.resizable=t.dialog.ligerResizable({onStopResize:function(i,e){var o=0,l=0;return isNaN(parseInt(t.dialog.css("top")))||(o=parseInt(t.dialog.css("top"))),isNaN(parseInt(t.dialog.css("left")))||(l=parseInt(t.dialog.css("left"))),i.diffLeft&&t.set({left:l+i.diffLeft}),i.diffTop&&t.set({top:o+i.diffTop}),i.newWidth&&(t.set({width:i.newWidth}),t.dialog.body.css({width:i.newWidth-t._borderX})),i.newHeight&&t.set({height:i.newHeight}),t._onReisze(),t._saveStatus(),t.trigger("stopResize"),!1},animate:!1}))},_setImage:function(){var t=this,e=this.options;if(e.type){var o={paddingLeft:74,paddingRight:15,paddingBottom:30};"success"==e.type||"donne"==e.type||"ok"==e.type?(i(".l-dialog-image",t.dialog).addClass("l-dialog-image-donne").show(),t.dialog.content.css(o)):"error"==e.type?(i(".l-dialog-image",t.dialog).addClass("l-dialog-image-error").show(),t.dialog.content.css(o)):"warn"==e.type?(i(".l-dialog-image",t.dialog).addClass("l-dialog-image-warn").show(),t.dialog.content.css(o)):"question"==e.type&&(i(".l-dialog-image",t.dialog).addClass("l-dialog-image-question").show(),t.dialog.content.css(o))}}}),t.controls.Dialog.prototype.hide=t.controls.Dialog.prototype.hidden,i.ligerDialog.open=function(t){return i.ligerDialog(t)},i.ligerDialog.close=function(){var i=t.find(t.controls.Dialog.prototype.__getType());for(var e in i){var o=i[e];o.destroy.ligerDefer(o,5)}t.win.unmask()},i.ligerDialog.show=function(e){var o=t.find(t.controls.Dialog.prototype.__getType());if(o.length)for(var l in o)return void o[l].show();return i.ligerDialog(e)},i.ligerDialog.hide=function(){var i=t.find(t.controls.Dialog.prototype.__getType());for(var e in i){i[e].hide()}},i.ligerDialog.tip=function(t){return t=i.extend({showType:"slide",width:240,modal:!1,height:100},t||{}),i.extend(t,{fixedType:"se",type:"none",isDrag:!1,isResize:!1,showMax:!1,showToggle:!1,showMin:!1}),i.ligerDialog.open(t)},i.ligerDialog.alert=function(t,e,o,l,a){t=t||"","function"==typeof e?(l=e,o=null):"function"==typeof o&&(l=o);var n=function(i,t,e){t.close(),l&&l(i,t,e)};return p={content:t,buttons:[{text:i.ligerDefaults.DialogString.ok,onclick:n}]},"string"==typeof e&&""!=e&&(p.title=e),"string"==typeof o&&""!=o&&(p.type=o),i.extend(p,{showMax:!1,showToggle:!1,showMin:!1},a||{}),i.ligerDialog(p)},i.ligerDialog.confirm=function(t,e,o){"function"==typeof e&&(o=e,type=null);var l=function(i,t){t.close(),o&&o("ok"==i.type)};return p={type:"question",content:t,buttons:[{text:i.ligerDefaults.DialogString.yes,onclick:l,type:"ok",cls:"l-dialog-btn-ok"},{text:i.ligerDefaults.DialogString.no,onclick:l,type:"no",cls:"l-dialog-btn-no"}]},"string"==typeof e&&""!=e&&(p.title=e),i.extend(p,{showMax:!1,showToggle:!1,showMin:!1}),i.ligerDialog(p)},i.ligerDialog.warning=function(t,e,o,l){"function"==typeof e&&(o=e,type=null);var a=function(i,t){t.close(),o&&o(i.type)};return p={type:"question",content:t,buttons:[{text:i.ligerDefaults.DialogString.yes,onclick:a,type:"yes"},{text:i.ligerDefaults.DialogString.no,onclick:a,type:"no"},{text:i.ligerDefaults.DialogString.cancel,onclick:a,type:"cancel"}]},"string"==typeof e&&""!=e&&(p.title=e),i.extend(p,{showMax:!1,showToggle:!1,showMin:!1},l||{}),i.ligerDialog(p)},i.ligerDialog.waitting=function(t){return t=t||i.ligerDefaults.Dialog.waittingMessage,i.ligerDialog.open({cls:"l-dialog-waittingdialog",type:"none",content:'<div style="padding:4px">'+t+"</div>",allowClose:!1})},i.ligerDialog.closeWaitting=function(){var i=t.find(t.controls.Dialog);for(var e in i){var o=i[e];o.dialog.hasClass("l-dialog-waittingdialog")&&o.close()}},i.ligerDialog.success=function(t,e,o,l){return i.ligerDialog.alert(t,e,"success",o,l)},i.ligerDialog.error=function(t,e,o,l){return i.ligerDialog.alert(t,e,"error",o,l)},i.ligerDialog.warn=function(t,e,o,l){return i.ligerDialog.alert(t,e,"warn",o,l)},i.ligerDialog.question=function(t,e,o){return i.ligerDialog.alert(t,e,"question",null,o)},i.ligerDialog.prompt=function(t,e,o,l){var a=i('<input type="text" class="l-dialog-inputtext"/>');"function"==typeof o&&(l=o),"function"==typeof e?l=e:"boolean"==typeof e&&(o=e),"boolean"==typeof o&&o&&(a=i('<textarea class="l-dialog-textarea"></textarea>')),"string"!=typeof e&&"int"!=typeof e||a.val(e);var n=function(i,t,e){t.close(),l&&l("yes"==i.type,a.val())};return p={title:t,target:a,width:320,buttons:[{text:i.ligerDefaults.DialogString.ok,onclick:n,type:"yes"},{text:i.ligerDefaults.DialogString.cancel,onclick:n,type:"cancel"}]},i.ligerDialog(p)}}(jQuery);