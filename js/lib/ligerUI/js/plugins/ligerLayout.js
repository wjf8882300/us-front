!function(t){t.fn.ligerLayout=function(e){return t.ligerui.run.call(this,"ligerLayout",arguments)},t.fn.ligerGetLayoutManager=function(){return t.ligerui.run.call(this,"ligerGetLayoutManager",arguments)},t.ligerDefaults.Layout={topHeight:50,bottomHeight:50,leftWidth:110,centerWidth:300,rightWidth:170,centerBottomHeight:100,allowCenterBottomResize:!0,inWindow:!0,heightDiff:0,height:"100%",onHeightChanged:null,isLeftCollapse:!1,isRightCollapse:!1,allowLeftCollapse:!0,allowRightCollapse:!0,allowLeftResize:!0,allowRightResize:!0,allowTopResize:!0,allowBottomResize:!0,space:3,onEndResize:null,minLeftWidth:80,minRightWidth:80,onLeftToggle:null,onRightToggle:null},t.ligerMethos.Layout={},t.ligerui.controls.Layout=function(e,o){t.ligerui.controls.Layout.base.constructor.call(this,e,o)},t.ligerui.controls.Layout.ligerExtend(t.ligerui.core.UIComponent,{__getType:function(){return"Layout"},__idPrev:function(){return"Layout"},_extendMethods:function(){return t.ligerMethos.Layout},_init:function(){t.ligerui.controls.Layout.base._init.call(this);var e=this.options;null!=e.InWindow&&null==e.inWindow&&(e.inWindow=e.InWindow)},_render:function(){var e=this,o=this.options;if(e.layout=t(this.element),e.layout.addClass("l-layout"),e.width=e.layout.width(),t("> div[position=top]",e.layout).length>0&&(e.top=t("> div[position=top]",e.layout).wrap('<div class="l-layout-top" style="top:0px;"></div>').parent(),e.top.content=t("> div[position=top]",e.top),e.top.content.hasClass("l-layout-content")||e.top.content.addClass("l-layout-content"),e.topHeight=o.topHeight,e.topHeight&&e.top.height(e.topHeight)),t("> div[position=bottom]",e.layout).length>0){e.bottom=t("> div[position=bottom]",e.layout).wrap('<div class="l-layout-bottom"></div>').parent(),e.bottom.content=t("> div[position=bottom]",e.bottom),e.bottom.content.hasClass("l-layout-content")||e.bottom.content.addClass("l-layout-content"),e.bottomHeight=o.bottomHeight,e.bottomHeight&&e.bottom.height(e.bottomHeight);var i=e.bottom.content.attr("title");i&&(e.bottom.header=t('<div class="l-layout-header"></div>'),e.bottom.prepend(e.bottom.header),e.bottom.header.html(i),e.bottom.content.attr("title",""))}if(t("> div[position=left]",e.layout).length>0){e.left=t("> div[position=left]",e.layout).wrap('<div class="l-layout-left" style="left:0px;"></div>').parent(),e.left.header=t('<div class="l-layout-header"><div class="l-layout-header-toggle"></div><div class="l-layout-header-inner"></div></div>'),e.left.prepend(e.left.header),e.left.header.toggle=t(".l-layout-header-toggle",e.left.header),e.left.content=t("> div[position=left]",e.left),e.left.content.hasClass("l-layout-content")||e.left.content.addClass("l-layout-content"),o.allowLeftCollapse||t(".l-layout-header-toggle",e.left.header).remove();var l=e.left.content.attr("title");l&&(e.left.content.attr("title",""),t(".l-layout-header-inner",e.left.header).html(l)),e.left.content.attr("hidetitle")&&(e.left.content.attr("title",""),e.left.header.remove()),e.leftWidth=o.leftWidth,e.leftWidth&&e.left.width(e.leftWidth)}if(t("> div[position=center]",e.layout).length>0){e.center=t("> div[position=center]",e.layout).wrap('<div class="l-layout-center" ></div>').parent(),e.center.content=t("> div[position=center]",e.center),e.center.content.addClass("l-layout-content");var r=e.center.content.attr("title");if(r&&(e.center.content.attr("title",""),e.center.header=t('<div class="l-layout-header"></div>'),e.center.prepend(e.center.header),e.center.header.html(r)),e.center.content.attr("hidetitle")&&(e.center.content.attr("title",""),e.center.header.remove()),e.centerWidth=o.centerWidth,e.centerWidth&&e.center.width(e.centerWidth),t("> div[position=centerbottom]",e.layout).length>0){e.centerBottom=t("> div[position=centerbottom]",e.layout).wrap('<div class="l-layout-centerbottom" ></div>').parent(),e.centerBottom.content=t("> div[position=centerbottom]",e.centerBottom),e.centerBottom.content.addClass("l-layout-content");var r=e.centerBottom.content.attr("title");r&&(e.centerBottom.content.attr("title",""),e.centerBottom.header=t('<div class="l-layout-header"></div>'),e.centerBottom.prepend(e.centerBottom.header),e.centerBottom.header.html(r)),e.centerBottom.content.attr("hidetitle")&&(e.centerBottom.content.attr("title",""),e.centerBottom.header&&e.centerBottom.header.remove()),e.centerWidth&&e.centerBottom.width(e.centerWidth)}}if(t("> div[position=right]",e.layout).length>0){e.right=t("> div[position=right]",e.layout).wrap('<div class="l-layout-right"></div>').parent(),e.right.header=t('<div class="l-layout-header"><div class="l-layout-header-toggle"></div><div class="l-layout-header-inner"></div></div>'),e.right.prepend(e.right.header),e.right.header.toggle=t(".l-layout-header-toggle",e.right.header),o.allowRightCollapse||t(".l-layout-header-toggle",e.right.header).remove(),e.right.content=t("> div[position=right]",e.right),e.right.content.hasClass("l-layout-content")||e.right.content.addClass("l-layout-content");var s=e.right.content.attr("title");s&&(e.right.content.attr("title",""),t(".l-layout-header-inner",e.right.header).html(s)),e.right.content.attr("hidetitle")&&(e.right.content.attr("title",""),e.right.header.remove()),e.rightWidth=o.rightWidth,e.rightWidth&&e.right.width(e.rightWidth)}e.layout.lock=t("<div class='l-layout-lock'></div>"),e.layout.append(e.layout.lock),e._addDropHandle(),e.isLeftCollapse=o.isLeftCollapse,e.isRightCollapse=o.isRightCollapse,e.leftCollapse=t('<div class="l-layout-collapse-left" style="display: none; "><div class="l-layout-collapse-left-toggle"></div></div>'),e.rightCollapse=t('<div class="l-layout-collapse-right" style="display: none; "><div class="l-layout-collapse-right-toggle"></div></div>'),e.layout.append(e.leftCollapse).append(e.rightCollapse),e.leftCollapse.toggle=t("> .l-layout-collapse-left-toggle",e.leftCollapse),e.rightCollapse.toggle=t("> .l-layout-collapse-right-toggle",e.rightCollapse),e._setCollapse(),e._bulid(),t(window).resize(function(){e._onResize()}),e.set(o),e.mask.height(e.layout.height())},setLeftCollapse:function(t){var e=this;this.options;if(!e.left)return!1;e.isLeftCollapse=t,e.isLeftCollapse?(e.leftCollapse.show(),e.leftDropHandle&&e.leftDropHandle.hide(),e.left.hide()):(e.leftCollapse.hide(),e.leftDropHandle&&e.leftDropHandle.show(),e.left.show()),e._onResize(),e.trigger("leftToggle",[t])},setRightCollapse:function(t){var e=this;this.options;if(!e.right)return!1;e.isRightCollapse=t,e._onResize(),e.isRightCollapse?(e.rightCollapse.show(),e.rightDropHandle&&e.rightDropHandle.hide(),e.right.hide()):(e.rightCollapse.hide(),e.rightDropHandle&&e.rightDropHandle.show(),e.right.show()),e._onResize(),e.trigger("rightToggle",[t])},_bulid:function(){var e=this,o=this.options;t("> .l-layout-left .l-layout-header,> .l-layout-right .l-layout-header",e.layout).hover(function(){t(this).addClass("l-layout-header-over")},function(){t(this).removeClass("l-layout-header-over")}),t(".l-layout-header-toggle",e.layout).hover(function(){t(this).addClass("l-layout-header-toggle-over")},function(){t(this).removeClass("l-layout-header-toggle-over")}),t(".l-layout-header-toggle",e.left).click(function(){e.setLeftCollapse(!0)}),t(".l-layout-header-toggle",e.right).click(function(){e.setRightCollapse(!0)}),e.middleTop=0,e.top&&(e.middleTop+=e.top.height(),e.middleTop+=parseInt(e.top.css("borderTopWidth")),e.middleTop+=parseInt(e.top.css("borderBottomWidth")),e.middleTop+=o.space),e.left&&(e.left.css({top:e.middleTop}),e.leftCollapse.css({top:e.middleTop})),e.center&&e.center.css({top:e.middleTop}),e.right&&(e.right.css({top:e.middleTop}),e.rightCollapse.css({top:e.middleTop})),e.left&&e.left.css({left:0}),e._onResize(),e._onResize()},_setCollapse:function(){var e=this;this.options;e.leftCollapse.hover(function(){t(this).addClass("l-layout-collapse-left-over")},function(){t(this).removeClass("l-layout-collapse-left-over")}),e.leftCollapse.toggle.hover(function(){t(this).addClass("l-layout-collapse-left-toggle-over")},function(){t(this).removeClass("l-layout-collapse-left-toggle-over")}),e.rightCollapse.hover(function(){t(this).addClass("l-layout-collapse-right-over")},function(){t(this).removeClass("l-layout-collapse-right-over")}),e.rightCollapse.toggle.hover(function(){t(this).addClass("l-layout-collapse-right-toggle-over")},function(){t(this).removeClass("l-layout-collapse-right-toggle-over")}),e.leftCollapse.toggle.click(function(){e.setLeftCollapse(!1)}),e.rightCollapse.toggle.click(function(){e.setRightCollapse(!1)}),e.left&&e.isLeftCollapse&&(e.leftCollapse.show(),e.leftDropHandle&&e.leftDropHandle.hide(),e.left.hide()),e.right&&e.isRightCollapse&&(e.rightCollapse.show(),e.rightDropHandle&&e.rightDropHandle.hide(),e.right.hide())},_addDropHandle:function(){var e=this,o=this.options;e.left&&o.allowLeftResize&&(e.leftDropHandle=t("<div class='l-layout-drophandle-left'></div>"),e.layout.append(e.leftDropHandle),e.leftDropHandle&&e.leftDropHandle.show(),e.leftDropHandle.mousedown(function(t){e._start("leftresize",t)})),e.right&&o.allowRightResize&&(e.rightDropHandle=t("<div class='l-layout-drophandle-right'></div>"),e.layout.append(e.rightDropHandle),e.rightDropHandle&&e.rightDropHandle.show(),e.rightDropHandle.mousedown(function(t){e._start("rightresize",t)})),e.top&&o.allowTopResize&&(e.topDropHandle=t("<div class='l-layout-drophandle-top'></div>"),e.layout.append(e.topDropHandle),e.topDropHandle.show(),e.topDropHandle.mousedown(function(t){e._start("topresize",t)})),e.bottom&&o.allowBottomResize&&(e.bottomDropHandle=t("<div class='l-layout-drophandle-bottom'></div>"),e.layout.append(e.bottomDropHandle),e.bottomDropHandle.show(),e.bottomDropHandle.mousedown(function(t){e._start("bottomresize",t)})),e.centerBottom&&o.allowCenterBottomResize&&(e.centerBottomDropHandle=t("<div class='l-layout-drophandle-centerbottom'></div>"),e.layout.append(e.centerBottomDropHandle),e.centerBottomDropHandle.show(),e.centerBottomDropHandle.mousedown(function(t){e._start("centerbottomresize",t)})),e.draggingxline=t("<div class='l-layout-dragging-xline'></div>"),e.draggingyline=t("<div class='l-layout-dragging-yline'></div>"),e.mask=t("<div class='l-dragging-mask'></div>"),e.layout.append(e.draggingxline).append(e.draggingyline).append(e.mask)},_setDropHandlePosition:function(){var t=this,e=this.options;t.leftDropHandle&&t.leftDropHandle.css({left:t.left.width()+parseInt(t.left.css("left")),height:t.middleHeight,top:t.middleTop}),t.rightDropHandle&&t.rightDropHandle.css({left:parseInt(t.right.css("left"))-e.space,height:t.middleHeight,top:t.middleTop}),t.topDropHandle&&t.topDropHandle.css({top:t.top.height()+parseInt(t.top.css("top")),width:t.top.width()}),t.bottomDropHandle&&t.bottomDropHandle.css({top:parseInt(t.bottom.css("top"))-e.space,width:t.bottom.width()}),t.centerBottomDropHandle&&t.centerBottomDropHandle.css({top:parseInt(t.centerBottom.css("top"))-e.space,left:parseInt(t.center.css("left")),width:t.center.width()})},_onResize:function(){var e=this,o=this.options,i=e.layout.height(),l=0,r=t(window).height(),s=null;if("string"==typeof o.height&&o.height.indexOf("%")>0){var a=e.layout.parent();o.inWindow||"body"==a[0].tagName.toLowerCase()?(s=r,s-=parseInt(t("body").css("paddingTop")),s-=parseInt(t("body").css("paddingBottom"))):s=a.height(),l=s*parseFloat(o.height)*.01,(o.inWindow||"body"==a[0].tagName.toLowerCase())&&(l-=e.layout.offset().top-parseInt(t("body").css("paddingTop")))}else l=parseInt(o.height);if(l+=o.heightDiff,e.layout.height(l),e.layoutHeight=e.layout.height(),e.middleWidth=e.layout.width(),e.middleHeight=e.layout.height(),e.top&&(e.middleHeight-=e.top.height(),e.middleHeight-=parseInt(e.top.css("borderTopWidth")),e.middleHeight-=parseInt(e.top.css("borderBottomWidth")),e.middleHeight-=o.space),e.bottom&&(e.middleHeight-=e.bottom.height(),e.middleHeight-=parseInt(e.bottom.css("borderTopWidth")),e.middleHeight-=parseInt(e.bottom.css("borderBottomWidth")),e.middleHeight-=o.space),e.middleHeight-=2,e.hasBind("heightChanged")&&e.layoutHeight!=i&&e.trigger("heightChanged",[{layoutHeight:e.layoutHeight,diff:e.layoutHeight-i,middleHeight:e.middleHeight}]),e.center){e.centerWidth=e.middleWidth,e.left&&(e.isLeftCollapse?(e.centerWidth-=e.leftCollapse.width(),e.centerWidth-=parseInt(e.leftCollapse.css("borderLeftWidth")),e.centerWidth-=parseInt(e.leftCollapse.css("borderRightWidth")),e.centerWidth-=parseInt(e.leftCollapse.css("left")),e.centerWidth-=o.space):(e.centerWidth-=e.leftWidth,e.centerWidth-=parseInt(e.left.css("borderLeftWidth")),e.centerWidth-=parseInt(e.left.css("borderRightWidth")),e.centerWidth-=parseInt(e.left.css("left")),e.centerWidth-=o.space)),e.right&&(e.isRightCollapse?(e.centerWidth-=e.rightCollapse.width(),e.centerWidth-=parseInt(e.rightCollapse.css("borderLeftWidth")),e.centerWidth-=parseInt(e.rightCollapse.css("borderRightWidth")),e.centerWidth-=parseInt(e.rightCollapse.css("right")),e.centerWidth-=o.space):(e.centerWidth-=e.rightWidth,e.centerWidth-=parseInt(e.right.css("borderLeftWidth")),e.centerWidth-=parseInt(e.right.css("borderRightWidth")),e.centerWidth-=o.space)),e.centerLeft=0,e.left&&(e.isLeftCollapse?(e.centerLeft+=e.leftCollapse.width(),e.centerLeft+=parseInt(e.leftCollapse.css("borderLeftWidth")),e.centerLeft+=parseInt(e.leftCollapse.css("borderRightWidth")),e.centerLeft+=parseInt(e.leftCollapse.css("left")),e.centerLeft+=o.space):(e.centerLeft+=e.left.width(),e.centerLeft+=parseInt(e.left.css("borderLeftWidth")),e.centerLeft+=parseInt(e.left.css("borderRightWidth")),e.centerLeft+=o.space)),e.center.css({left:e.centerLeft}),e.centerWidth>=0&&e.center.width(e.centerWidth),e.middleHeight>=0&&e.center.height(e.middleHeight);var d=e.middleHeight;e.center.header&&(d-=e.center.header.height()),d>=0&&e.center.content.height(d),e._updateCenterBottom(!0)}e.left&&(e.leftCollapse.height(e.middleHeight),e.left.height(e.middleHeight)),e.right&&(e.rightCollapse.height(e.middleHeight),e.right.height(e.middleHeight),e.rightLeft=0,e.left&&(e.isLeftCollapse?(e.rightLeft+=e.leftCollapse.width(),e.rightLeft+=parseInt(e.leftCollapse.css("borderLeftWidth")),e.rightLeft+=parseInt(e.leftCollapse.css("borderRightWidth")),e.rightLeft+=o.space):(e.rightLeft+=e.left.width(),e.rightLeft+=parseInt(e.left.css("borderLeftWidth")),e.rightLeft+=parseInt(e.left.css("borderRightWidth")),e.rightLeft+=parseInt(e.left.css("left")),e.rightLeft+=o.space)),e.center&&(e.rightLeft+=e.center.width(),e.rightLeft+=parseInt(e.center.css("borderLeftWidth")),e.rightLeft+=parseInt(e.center.css("borderRightWidth")),e.rightLeft+=o.space),e.right.css({left:e.rightLeft})),e.bottom&&(e.bottomTop=e.layoutHeight-e.bottom.height()-2,e.bottom.css({top:e.bottomTop})),e._setDropHandlePosition()},_updateCenterBottom:function(t){var e=this,o=this.options;if(e.centerBottom){if(t){var i=e.centerBottomHeight||o.centerBottomHeight;e.centerBottom.css({left:e.centerLeft}),e.centerWidth>=0&&e.centerBottom.width(e.centerWidth);var l=e.center.height(),r=parseInt(e.center.css("top"));e.centerBottom.height(i),e.centerBottom.css({top:r+l-i+2}),e.center.height(l-i-2)}var s=parseInt(e.center.css("left"));e.centerBottom.width(e.center.width()).css({left:s})}},_start:function(e,o){var i=this;this.options;if(i.dragtype=e,"leftresize"==e||"rightresize"==e)i.xresize={startX:o.pageX},i.draggingyline.css({left:o.pageX-i.layout.offset().left,height:i.middleHeight,top:i.middleTop}).show(),t("body").css("cursor","col-resize"),i.mask.height(i.layout.height()).removeClass("l-layout-ymask").addClass("l-layout-xmask").show();else if("topresize"==e||"bottomresize"==e)i.yresize={startY:o.pageY},i.draggingxline.css({top:o.pageY-i.layout.offset().top,width:i.layout.width()}).show(),t("body").css("cursor","row-resize"),i.mask.height(i.layout.height()).removeClass("l-layout-xmask").addClass("l-layout-ymask").show();else{if("centerbottomresize"!=e)return;i.yresize={startY:o.pageY},i.draggingxline.css({top:o.pageY-i.layout.offset().top,width:i.layout.width()}).show(),t("body").css("cursor","row-resize"),i.mask.height(i.layout.height()).removeClass("l-layout-xmask").addClass("l-layout-ymask").show()}i.layout.lock.width(i.layout.width()),i.layout.lock.height(i.layout.height()),i.layout.lock.show(),(t.browser.msie||t.browser.safari)&&t("body").bind("selectstart",function(){return!1}),t(document).bind("mouseup",function(){i._stop.apply(i,arguments)}),t(document).bind("mousemove",function(){i._drag.apply(i,arguments)})},_drag:function(e){var o=this;this.options;o.xresize?(o.xresize.diff=e.pageX-o.xresize.startX,o.draggingyline.css({left:e.pageX-o.layout.offset().left}),t("body").css("cursor","col-resize")):o.yresize&&(o.yresize.diff=e.pageY-o.yresize.startY,o.draggingxline.css({top:e.pageY-o.layout.offset().top}),t("body").css("cursor","row-resize"))},_stop:function(e){var o,i=this,l=this.options;if(i.xresize&&void 0!=i.xresize.diff){if(o=i.xresize.diff,"leftresize"==i.dragtype){if(l.minLeftWidth&&i.leftWidth+i.xresize.diff<l.minLeftWidth)return;i.leftWidth+=i.xresize.diff,i.left.width(i.leftWidth),i.center?i.center.width(i.center.width()-i.xresize.diff).css({left:parseInt(i.center.css("left"))+i.xresize.diff}):i.right&&i.right.width(i.left.width()-i.xresize.diff).css({left:parseInt(i.right.css("left"))+i.xresize.diff})}else if("rightresize"==i.dragtype){if(l.minRightWidth&&i.rightWidth-i.xresize.diff<l.minRightWidth)return;i.rightWidth-=i.xresize.diff,i.right.width(i.rightWidth).css({left:parseInt(i.right.css("left"))+i.xresize.diff}),i.center?i.center.width(i.center.width()+i.xresize.diff):i.left&&i.left.width(i.left.width()+i.xresize.diff)}i._updateCenterBottom()}else if(i.yresize&&void 0!=i.yresize.diff)if(o=i.yresize.diff,"topresize"==i.dragtype)i.top.height(i.top.height()+i.yresize.diff),i.middleTop+=i.yresize.diff,i.middleHeight-=i.yresize.diff,i.left&&(i.left.css({top:i.middleTop}).height(i.middleHeight),i.leftCollapse.css({top:i.middleTop}).height(i.middleHeight)),i.center&&i.center.css({top:i.middleTop}).height(i.middleHeight),i.right&&(i.right.css({top:i.middleTop}).height(i.middleHeight),i.rightCollapse.css({top:i.middleTop}).height(i.middleHeight)),i._updateCenterBottom(!0);else if("bottomresize"==i.dragtype)i.bottom.height(i.bottom.height()-i.yresize.diff),i.middleHeight+=i.yresize.diff,i.bottomTop+=i.yresize.diff,i.bottom.css({top:i.bottomTop}),i.left&&(i.left.height(i.middleHeight),i.leftCollapse.height(i.middleHeight)),i.center&&i.center.height(i.middleHeight),i.right&&(i.right.height(i.middleHeight),i.rightCollapse.height(i.middleHeight)),i._updateCenterBottom(!0);else if("centerbottomresize"==i.dragtype){i.centerBottomHeight=i.centerBottomHeight||l.centerBottomHeight,i.centerBottomHeight-=i.yresize.diff;var r=parseInt(i.centerBottom.css("top"));i.centerBottom.css("top",r+i.yresize.diff),i.centerBottom.height(i.centerBottom.height()-i.yresize.diff),i.center.height(i.center.height()+i.yresize.diff)}i.trigger("endResize",[{direction:i.dragtype?i.dragtype.replace(/resize/,""):"",diff:o},e]),i._setDropHandlePosition(),i.draggingxline.hide(),i.draggingyline.hide(),i.mask.hide(),i.xresize=i.yresize=i.dragtype=!1,i.layout.lock.hide(),(t.browser.msie||t.browser.safari)&&t("body").unbind("selectstart"),t(document).unbind("mousemove",i._drag),t(document).unbind("mouseup",i._stop),t("body").css("cursor","")}})}(jQuery);