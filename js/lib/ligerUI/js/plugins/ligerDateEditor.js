!function($){$.fn.ligerDateEditor=function(){return $.ligerui.run.call(this,"ligerDateEditor",arguments)},$.fn.ligerGetDateEditorManager=function(){return $.ligerui.run.call(this,"ligerGetDateEditorManager",arguments)},$.ligerDefaults.DateEditor={format:"yyyy-MM-dd hh:mm",width:null,showTime:!1,onChangeDate:!1,absolute:!0,cancelable:!0,readonly:!1},$.ligerDefaults.DateEditorString={dayMessage:["日","一","二","三","四","五","六"],monthMessage:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],todayMessage:"今天",closeMessage:"关闭"},$.ligerMethos.DateEditor={},$.ligerui.controls.DateEditor=function(t,e){$.ligerui.controls.DateEditor.base.constructor.call(this,t,e)},$.ligerui.controls.DateEditor.ligerExtend($.ligerui.controls.Input,{__getType:function(){return"DateEditor"},__idPrev:function(){return"DateEditor"},_extendMethods:function(){return $.ligerMethos.DateEditor},_render:function(){var t=this,e=this.options;if(!e.showTime&&e.format.indexOf(" hh:mm")>-1&&(e.format=e.format.replace(" hh:mm","")),"input"==this.element.tagName.toLowerCase()&&"text"==this.element.type){t.inputText=$(this.element),t.inputText.hasClass("l-text-field")||t.inputText.addClass("l-text-field"),t.link=$('<div class="l-trigger"><div class="l-trigger-icon"></div></div>'),t.text=t.inputText.wrap('<div class="l-text l-text-date"></div>').parent(),t.text.append('<div class="l-text-l"></div><div class="l-text-r"></div>'),t.text.append(t.link),t.textwrapper=t.text.wrap('<div class="l-text-wrapper"></div>').parent();var i="";i+="<div class='l-box-dateeditor' style='display:none'>",i+="    <div class='l-box-dateeditor-header'>",i+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-prevyear'><span></span></div>",i+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-prevmonth'><span></span></div>",i+="        <div class='l-box-dateeditor-header-text'><a class='l-box-dateeditor-header-month'></a> , <a  class='l-box-dateeditor-header-year'></a></div>",i+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-nextmonth'><span></span></div>",i+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-nextyear'><span></span></div>",i+="    </div>",i+="    <div class='l-box-dateeditor-body'>",i+="        <table cellpadding='0' cellspacing='0' border='0' class='l-box-dateeditor-calendar'>",i+="            <thead>",i+="                <tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr>",i+="            </thead>",i+="            <tbody>",i+="                <tr class='l-first'><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr>",i+="            </tbody>",i+="        </table>",i+="        <ul class='l-box-dateeditor-monthselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>",i+="        <ul class='l-box-dateeditor-yearselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>",i+="        <ul class='l-box-dateeditor-hourselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>",i+="        <ul class='l-box-dateeditor-minuteselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>",i+="    </div>",i+="    <div class='l-box-dateeditor-toolbar'>",i+="        <div class='l-box-dateeditor-time'></div>",i+="        <div class='l-button l-button-today'></div>",i+="        <div class='l-button l-button-close'></div>",i+="        <div class='l-clear'></div>",i+="    </div>",i+="</div>",t.dateeditor=$(i),e.absolute?t.dateeditor.appendTo("body").addClass("l-box-dateeditor-absolute"):t.textwrapper.append(t.dateeditor),t.header=$(".l-box-dateeditor-header",t.dateeditor),t.body=$(".l-box-dateeditor-body",t.dateeditor),t.toolbar=$(".l-box-dateeditor-toolbar",t.dateeditor),t.body.thead=$("thead",t.body),t.body.tbody=$("tbody",t.body),t.body.monthselector=$(".l-box-dateeditor-monthselector",t.body),t.body.yearselector=$(".l-box-dateeditor-yearselector",t.body),t.body.hourselector=$(".l-box-dateeditor-hourselector",t.body),t.body.minuteselector=$(".l-box-dateeditor-minuteselector",t.body),t.toolbar.time=$(".l-box-dateeditor-time",t.toolbar),t.toolbar.time.hour=$("<a></a>"),t.toolbar.time.minute=$("<a></a>"),t.buttons={btnPrevYear:$(".l-box-dateeditor-header-prevyear",t.header),btnNextYear:$(".l-box-dateeditor-header-nextyear",t.header),btnPrevMonth:$(".l-box-dateeditor-header-prevmonth",t.header),btnNextMonth:$(".l-box-dateeditor-header-nextmonth",t.header),btnYear:$(".l-box-dateeditor-header-year",t.header),btnMonth:$(".l-box-dateeditor-header-month",t.header),btnToday:$(".l-button-today",t.toolbar),btnClose:$(".l-button-close",t.toolbar)};var l=new Date;t.now={year:l.getFullYear(),month:l.getMonth()+1,day:l.getDay(),date:l.getDate(),hour:l.getHours(),minute:l.getMinutes()},t.currentDate={year:l.getFullYear(),month:l.getMonth()+1,day:l.getDay(),date:l.getDate(),hour:l.getHours(),minute:l.getMinutes()},t.selectedDate=null,t.usedDate=null,$("td",t.body.thead).each(function(t,i){$(i).html(e.dayMessage[t])}),$("li",t.body.monthselector).each(function(t,i){$(i).html(e.monthMessage[t])}),t.buttons.btnToday.html(e.todayMessage),t.buttons.btnClose.html(e.closeMessage),e.showTime&&(t.toolbar.time.show(),t.toolbar.time.append(t.toolbar.time.hour).append(":").append(t.toolbar.time.minute),$("li",t.body.hourselector).each(function(t,e){var i=t;t<10&&(i="0"+t.toString()),$(this).html(i)}),$("li",t.body.minuteselector).each(function(t,e){var i=t;t<10&&(i="0"+t.toString()),$(this).html(i)})),t.bulidContent(),e.initValue&&t.inputText.val(e.initValue),""!=t.inputText.val()&&t.onTextChange(),t.dateeditor.hover(null,function(e){t.dateeditor.is(":visible")&&!t.editorToggling&&t.toggleDateEditor(!0)}),t.link.hover(function(){e.disabled||(this.className="l-trigger-hover")},function(){e.disabled||(this.className="l-trigger")}).mousedown(function(){e.disabled||(this.className="l-trigger-pressed")}).mouseup(function(){e.disabled||(this.className="l-trigger-hover")}).click(function(){e.disabled||(t.bulidContent(),t.toggleDateEditor(t.dateeditor.is(":visible")))}),e.disabled&&(t.inputText.attr("readonly","readonly"),t.text.addClass("l-text-disabled")),t.buttons.btnClose.click(function(){t.toggleDateEditor(!0)}),$("td",t.body.tbody).hover(function(){$(this).hasClass("l-box-dateeditor-today")||$(this).addClass("l-box-dateeditor-over")},function(){$(this).removeClass("l-box-dateeditor-over")}).click(function(){$(".l-box-dateeditor-selected",t.body.tbody).removeClass("l-box-dateeditor-selected"),$(this).hasClass("l-box-dateeditor-today")||$(this).addClass("l-box-dateeditor-selected"),t.currentDate.date=parseInt($(this).html()),t.currentDate.day=new Date(t.currentDate.year,t.currentDate.month-1,1).getDay(),$(this).hasClass("l-box-dateeditor-out")&&(0==$("tr",t.body.tbody).index($(this).parent())?0==--t.currentDate.month&&(t.currentDate.month=12,t.currentDate.year--):13==++t.currentDate.month&&(t.currentDate.month=1,t.currentDate.year++)),t.selectedDate={year:t.currentDate.year,month:t.currentDate.month,date:t.currentDate.date},t.showDate(),t.editorToggling=!0,t.dateeditor.slideToggle("fast",function(){t.editorToggling=!1})}),$(".l-box-dateeditor-header-btn",t.header).hover(function(){$(this).addClass("l-box-dateeditor-header-btn-over")},function(){$(this).removeClass("l-box-dateeditor-header-btn-over")}),t.buttons.btnYear.click(function(){t.body.yearselector.is(":visible")||$("li",t.body.yearselector).each(function(e,i){var l=t.currentDate.year+(e-4);l==t.currentDate.year?$(this).addClass("l-selected"):$(this).removeClass("l-selected"),$(this).html(l)}),t.body.yearselector.slideToggle()}),t.body.yearselector.hover(function(){},function(){$(this).slideUp()}),$("li",t.body.yearselector).click(function(){t.currentDate.year=parseInt($(this).html()),t.body.yearselector.slideToggle(),t.bulidContent()}),t.buttons.btnMonth.click(function(){$("li",t.body.monthselector).each(function(e,i){t.currentDate.month==e+1?$(this).addClass("l-selected"):$(this).removeClass("l-selected")}),t.body.monthselector.slideToggle()}),t.body.monthselector.hover(function(){},function(){$(this).slideUp("fast")}),$("li",t.body.monthselector).click(function(){var e=$("li",t.body.monthselector).index(this);t.currentDate.month=e+1,t.body.monthselector.slideToggle(),t.bulidContent()}),t.toolbar.time.hour.click(function(){$("li",t.body.hourselector).each(function(e,i){t.currentDate.hour==e?$(this).addClass("l-selected"):$(this).removeClass("l-selected")}),t.body.hourselector.slideToggle()}),t.body.hourselector.hover(function(){},function(){$(this).slideUp("fast")}),$("li",t.body.hourselector).click(function(){var e=$("li",t.body.hourselector).index(this);t.currentDate.hour=e,t.body.hourselector.slideToggle(),t.bulidContent(),t.showDate()}),t.toolbar.time.minute.click(function(){$("li",t.body.minuteselector).each(function(e,i){t.currentDate.minute==e?$(this).addClass("l-selected"):$(this).removeClass("l-selected")}),t.body.minuteselector.slideToggle("fast",function(){if($("li",this).index($("li.l-selected",this))>29){var t=$("li.l-selected",this).offset().top-$(this).offset().top;$(this).animate({scrollTop:t})}})}),t.body.minuteselector.hover(function(){},function(){$(this).slideUp("fast")}),$("li",t.body.minuteselector).click(function(){var e=$("li",t.body.minuteselector).index(this);t.currentDate.minute=e,t.body.minuteselector.slideToggle("fast"),t.bulidContent(),t.showDate()}),t.buttons.btnPrevMonth.click(function(){0==--t.currentDate.month&&(t.currentDate.month=12,t.currentDate.year--),t.bulidContent()}),t.buttons.btnNextMonth.click(function(){13==++t.currentDate.month&&(t.currentDate.month=1,t.currentDate.year++),t.bulidContent()}),t.buttons.btnPrevYear.click(function(){t.currentDate.year--,t.bulidContent()}),t.buttons.btnNextYear.click(function(){t.currentDate.year++,t.bulidContent()}),t.buttons.btnToday.click(function(){t.currentDate={year:t.now.year,month:t.now.month,day:t.now.day,date:t.now.date},t.selectedDate={year:t.now.year,month:t.now.month,day:t.now.day,date:t.now.date},t.showDate(),t.dateeditor.slideToggle("fast")}),t.inputText.change(function(){t.onTextChange()}).blur(function(){t.text.removeClass("l-text-focus")}).focus(function(){t.text.addClass("l-text-focus")}),t.text.hover(function(){t.text.addClass("l-text-over")},function(){t.text.removeClass("l-text-over")}),e.label&&(t.labelwrapper=t.textwrapper.wrap('<div class="l-labeltext"></div>').parent(),t.labelwrapper.prepend('<div class="l-text-label" style="float:left;display:inline;">'+e.label+":&nbsp</div>"),t.textwrapper.css("float","left"),e.labelWidth?$(".l-text-label",t.labelwrapper).outerWidth(e.labelWidth):e.labelWidth=$(".l-text-label",t.labelwrapper).outerWidth(),$(".l-text-label",t.labelwrapper).width(e.labelWidth),$(".l-text-label",t.labelwrapper).height(t.text.height()),t.labelwrapper.append('<br style="clear:both;" />'),e.labelAlign&&$(".l-text-label",t.labelwrapper).css("text-align",e.labelAlign),t.textwrapper.css({display:"inline"}),t.labelwrapper.width(t.text.outerWidth()+e.labelWidth+2)),t.set(e),$(document).bind("click.dateeditor",function(e){t.dateeditor.is(":visible")&&0==$(e.target||e.srcElement).closest(".l-box-dateeditor, .l-text-date").length&&t.toggleDateEditor(!0)})}},destroy:function(){this.textwrapper&&this.textwrapper.remove(),this.dateeditor&&this.dateeditor.remove(),this.options=null,$.ligerui.remove(this)},bulidContent:function(){var t=this,e=this.options,i=new Date(t.currentDate.year,t.currentDate.month-1,1).getDay(),l=t.currentDate.month,a=t.currentDate.year;13==++l&&(l=1,a++);var o=new Date(a,l-1,0).getDate(),r=new Date(t.currentDate.year,t.currentDate.month-1,0).getDate();t.buttons.btnMonth.html(e.monthMessage[t.currentDate.month-1]),t.buttons.btnYear.html(t.currentDate.year),t.toolbar.time.hour.html(t.currentDate.hour),t.toolbar.time.minute.html(t.currentDate.minute),1==t.toolbar.time.hour.html().length&&t.toolbar.time.hour.html("0"+t.toolbar.time.hour.html()),1==t.toolbar.time.minute.html().length&&t.toolbar.time.minute.html("0"+t.toolbar.time.minute.html()),$("td",this.body.tbody).each(function(){this.className=""}),$("tr",this.body.tbody).each(function(e,l){$("td",l).each(function(l,a){var n=7*e+(l-i),d=n+1;t.selectedDate&&t.currentDate.year==t.selectedDate.year&&t.currentDate.month==t.selectedDate.month&&n+1==t.selectedDate.date?(0!=l&&6!=l||$(a).addClass("l-box-dateeditor-holiday"),$(a).addClass("l-box-dateeditor-selected"),$(a).siblings().removeClass("l-box-dateeditor-selected")):t.currentDate.year==t.now.year&&t.currentDate.month==t.now.month&&n+1==t.now.date?(0!=l&&6!=l||$(a).addClass("l-box-dateeditor-holiday"),$(a).addClass("l-box-dateeditor-today")):n<0?(d=r+d,$(a).addClass("l-box-dateeditor-out").removeClass("l-box-dateeditor-selected")):n>o-1?(d-=o,$(a).addClass("l-box-dateeditor-out").removeClass("l-box-dateeditor-selected")):0==l||6==l?$(a).addClass("l-box-dateeditor-holiday").removeClass("l-box-dateeditor-selected"):a.className="",$(a).html(d)})})},updateSelectBoxPosition:function(){var t=this;if(this.options.absolute){var e=$(document).height();Number(t.text.offset().top+1+t.text.outerHeight()+t.dateeditor.height())>e&&e>Number(t.dateeditor.height()+1)?t.dateeditor.css({left:t.text.offset().left,top:t.text.offset().top-1-t.dateeditor.height()}):t.dateeditor.css({left:t.text.offset().left,top:t.text.offset().top+1+t.text.outerHeight()})}else t.text.offset().top+4>t.dateeditor.height()&&t.text.offset().top+t.dateeditor.height()+textHeight+4-$(window).scrollTop()>$(window).height()?(t.dateeditor.css("marginTop",-1*(t.dateeditor.height()+textHeight+5)),t.showOnTop=!0):t.showOnTop=!1},toggleDateEditor:function(t){for(var e=this,i=(this.options,$.ligerui.find($.ligerui.controls.ComboBox)),l=0,a=i.length;l<a;l++){var o=i[l];o.id!=e.id&&null!=o.selectBox.is(":visible")&&o.selectBox.is(":visible")&&o.selectBox.hide()}i=$.ligerui.find($.ligerui.controls.DateEditor);for(var l=0,a=i.length;l<a;l++){var o=i[l];o.id!=e.id&&null!=o.dateeditor.is(":visible")&&o.dateeditor.is(":visible")&&o.dateeditor.hide()}e.text.height();e.editorToggling=!0,t?e.dateeditor.hide("fast",function(){e.editorToggling=!1}):(e.updateSelectBoxPosition(),e.dateeditor.slideDown("fast",function(){e.editorToggling=!1}))},showDate:function(){var t=this;this.options;if(this.currentDate){this.currentDate.hour=parseInt(t.toolbar.time.hour.html(),10),this.currentDate.minute=parseInt(t.toolbar.time.minute.html(),10);var e=this.currentDate.year+"/"+this.currentDate.month+"/"+this.currentDate.date+" "+this.currentDate.hour+":"+this.currentDate.minute,i=new Date(e);e=t.getFormatDate(i),this.inputText.val(e),this.onTextChange()}},isDateTime:function(t){var e=(this.options,t.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/));if(null==e)return!1;var i=new Date(e[1],e[3]-1,e[4]);return"NaN"!=i&&(i.getFullYear()==e[1]&&i.getMonth()+1==e[3]&&i.getDate()==e[4])},isLongDateTime:function(t){var e=(this.options,/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2})$/),i=t.match(e);if(null==i)return!1;var l=new Date(i[1],i[3]-1,i[4],i[5],i[6]);return"NaN"!=l&&(l.getFullYear()==i[1]&&l.getMonth()+1==i[3]&&l.getDate()==i[4]&&l.getHours()==i[5]&&l.getMinutes()==i[6])},getFormatDate:function(t){if(null===t||"NaN"==t)return null;var e=this.options,i=e.format,l={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(y+)/.test(i)&&(i=i.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in l)new RegExp("("+a+")").test(i)&&(i=i.replace(RegExp.$1,1==RegExp.$1.length?l[a]:("00"+l[a]).substr((""+l[a]).length)));return i},clear:function(){this.set("value",""),this.usedDate=null},_setCancelable:function(t){var e=this,i=this.options;!t&&e.unselect&&(e.unselect.remove(),e.unselect=null),(t||e.unselect)&&(e.unselect=$('<div class="l-trigger l-trigger-cancel"><div class="l-trigger-icon"></div></div>').hide(),e.text.hover(function(){e.unselect.show()},function(){e.unselect.hide()}),!i.disabled&&i.cancelable&&e.text.append(e.unselect),e.unselect.hover(function(){this.className="l-trigger-hover l-trigger-cancel"},function(){this.className="l-trigger l-trigger-cancel"}).click(function(){i.readonly||e.clear()}))},_rever:function(){var t=this;this.options;t.usedDate?t.inputText.val(t.getFormatDate(t.usedDate)):t.inputText.val("")},_getMatch:function(t){for(var e=[-1,-1,-1,-1,-1,-1],i=0,l="^",a=t||this.options.format;;){var o=a.match(/^yyyy|MM|dd|mm|hh|HH|ss|-|\/|:|\s/);if(!o)return null;var r=o[0].charAt(0),n=o[0].length,d="yMdhms".indexOf(r);if(-1!=d)e[d]=i+1,l+="(\\d{1,"+n+"})";else{l+="("+(" "==r?"\\s":r)+")"}if(i++,n==a.length){l+="$";break}a=a.substring(n)}return{reg:new RegExp(l),position:e}},_bulidDate:function(t){var e=this.options,i=this._getMatch();if(!i)return null;var l=t.match(i.reg);if(!l)return null;var a={y:-1==i.position[0]?1900:l[i.position[0]],M:-1==i.position[1]?0:parseInt(l[i.position[1]],10)-1,d:-1==i.position[2]?1:parseInt(l[i.position[2]],10),h:-1==i.position[3]?0:parseInt(l[i.position[3]],10),m:-1==i.position[4]?0:parseInt(l[i.position[4]],10),s:-1==i.position[5]?0:parseInt(l[i.position[5]],10)};if(a.M<0||a.M>11||a.d<0||a.d>31)return null;var o=new Date(a.y,a.M,a.d);if(e.showTime){if(a.m<0||a.m>59||a.h<0||a.h>23||a.s<0||a.s>59)return null;o.setHours(a.h),o.setMinutes(a.m),o.setSeconds(a.s)}return o},updateStyle:function(){this.onTextChange()},onTextChange:function(){var t=this,e=(this.options,t.inputText.val());if(!e)return t.selectedDate=null,!0;var i=t._bulidDate(e);if(!i)return void t._rever();t.usedDate=i,t.selectedDate={year:t.usedDate.getFullYear(),month:t.usedDate.getMonth()+1,day:t.usedDate.getDay(),date:t.usedDate.getDate(),hour:t.usedDate.getHours(),minute:t.usedDate.getMinutes()},t.currentDate={year:t.usedDate.getFullYear(),month:t.usedDate.getMonth()+1,day:t.usedDate.getDay(),date:t.usedDate.getDate(),hour:t.usedDate.getHours(),minute:t.usedDate.getMinutes()};var l=t.getFormatDate(i);t.inputText.val(l),t.trigger("changeDate",[l]),$(t.dateeditor).is(":visible")&&t.bulidContent()},_setHeight:function(t){var e=this;t>4&&(e.text.css({height:t}),e.inputText.css({height:t}),e.textwrapper.css({height:t}))},_setWidth:function(t){var e=this;t>20&&(e.text.css({width:t}),e.inputText.css({width:t-20}),e.textwrapper.css({width:t}))},_setValue:function(value){var g=this;value||g.inputText.val(""),"string"==typeof value&&(/^\/Date/.test(value)&&(value=value.replace(/^\//,"new ").replace(/\/$/,""),eval("value = "+value)),g.inputText.val(value),g.usedDate=value),"object"==typeof value&&value instanceof Date&&(g.inputText.val(g.getFormatDate(value)),g.onTextChange())},_getValue:function(){return this.usedDate},setEnabled:function(){var t=this.options;this.inputText.removeAttr("readonly"),this.text.removeClass("l-text-disabled"),t.disabled=!1},setDisabled:function(){var t=this.options;this.inputText.attr("readonly","readonly"),this.text.addClass("l-text-disabled"),t.disabled=!0}})}(jQuery);