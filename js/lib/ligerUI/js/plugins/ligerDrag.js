!function(r){var e=r.ligerui;r.fn.ligerDrag=function(r){return e.run.call(this,"ligerDrag",arguments,{idAttrName:"ligeruidragid",hasElement:!1,propertyToElemnt:"target"})},r.fn.ligerGetDragManager=function(){return e.run.call(this,"ligerGetDragManager",arguments,{idAttrName:"ligeruidragid",hasElement:!1,propertyToElemnt:"target"})},r.ligerDefaults.Drag={onStartDrag:!1,onDrag:!1,onStopDrag:!1,handler:null,clickDelay:100,proxy:!0,revert:!1,animate:!0,onRevert:null,onEndRevert:null,receive:null,onDragEnter:null,onDragOver:null,onDragLeave:null,onDrop:null,disabled:!1,proxyX:null,proxyY:null},e.controls.Drag=function(r){e.controls.Drag.base.constructor.call(this,null,r)},e.controls.Drag.ligerExtend(e.core.UIComponent,{__getType:function(){return"Drag"},__idPrev:function(){return"Drag"},_render:function(){var e=this,t=this.options;this.set(t),e.cursor="move",e.handler.css("cursor",e.cursor),e.mouseDowned=!1,e.handler.bind("mousedown.drag",function(n){t.disabled||2!=n.button&&(e.mouseDowned=!0,r(document).bind("selectstart.drag",function(){return!1}),setTimeout(function(){e.mouseDowned&&e._start.call(e,n)},t.clickDelay||100))}).bind("mousemove.drag",function(){t.disabled||e.handler.css("cursor",e.cursor)}).bind("mouseup.drag",function(){r(document).unbind("selectstart.drag")}),r(document).bind("mouseup",function(){e.mouseDowned=!1})},_rendered:function(){this.options.target.ligeruidragid=this.id},_start:function(t){var n=this,o=this.options;if(!n.reverting&&!o.disabled){if(n.current={target:n.target,left:n.target.offset().left,top:n.target.offset().top,startX:t.pageX||t.screenX,startY:t.pageY||t.clientY},0==n.trigger("startDrag",[n.current,t]))return!1;if(n.cursor="move",n._createProxy(o.proxy,t),o.proxy&&!n.proxy)return!1;(n.proxy||n.handler).css("cursor",n.cursor),r(document).bind("mousemove.drag",function(){n._drag.apply(n,arguments)}),e.draggable.dragging=!0,r(document).bind("mouseup.drag",function(){e.draggable.dragging=!1,n._stop.apply(n,arguments)})}},_drag:function(e){var t=this;this.options;if(t.current){var n=e.pageX||e.screenX,o=e.pageY||e.screenY;t.current.diffX=n-t.current.startX,t.current.diffY=o-t.current.startY,(t.proxy||t.handler).css("cursor",t.cursor),t.receive&&t.receive.each(function(i,a){var u=r(a),s=u.offset();n>s.left&&n<s.left+u.width()&&o>s.top&&o<s.top+u.height()?t.receiveEntered[i]?t.trigger("dragOver",[a,t.proxy||t.target,e]):(t.receiveEntered[i]=!0,t.trigger("dragEnter",[a,t.proxy||t.target,e])):t.receiveEntered[i]&&(t.receiveEntered[i]=!1,t.trigger("dragLeave",[a,t.proxy||t.target,e]))}),t.hasBind("drag")?0!=t.trigger("drag",[t.current,e])?t._applyDrag():t.proxy?t._removeProxy():t._stop():t._applyDrag()}},_stop:function(e){var t=this,n=this.options;r(document).unbind("mousemove.drag"),r(document).unbind("mouseup.drag"),r(document).unbind("selectstart.drag"),t.receive&&t.receive.each(function(r,n){t.receiveEntered[r]&&t.trigger("drop",[n,t.proxy||t.target,e])}),t.proxy&&(n.revert?t.hasBind("revert")?0!=t.trigger("revert",[t.current,e])?t._revert(e):t._removeProxy():t._revert(e):(t._applyDrag(t.target),t._removeProxy())),t.cursor="move",t.trigger("stopDrag",[t.current,e]),t.current=null,t.handler.css("cursor",t.cursor)},_revert:function(r){var e=this;e.reverting=!0,e.proxy.animate({left:e.current.left,top:e.current.top},function(){e.reverting=!1,e._removeProxy(),e.trigger("endRevert",[e.current,r]),e.current=null})},_applyDrag:function(r){var e=this,t=this.options;r=r||e.proxy||e.target;var n={},o=r==e.target;e.current.diffX&&(o||null==t.proxyX?n.left=e.current.left+e.current.diffX:n.left=e.current.startX+t.proxyX+e.current.diffX),e.current.diffY&&(o||null==t.proxyY?n.top=e.current.top+e.current.diffY:n.top=e.current.startY+t.proxyY+e.current.diffY),r==e.target&&e.proxy&&t.animate?(e.reverting=!0,r.animate(n,function(){e.reverting=!1})):r.css(n)},_setReceive:function(e){this.receiveEntered={},e&&(this.receive="string"==typeof e?r(e):e)},_setHandler:function(e){var t=this,n=this.options;t.handler=e?"string"==typeof e?r(e,n.target):e:r(n.target)},_setTarget:function(e){this.target=r(e)},_setCursor:function(r){this.cursor=r,(this.proxy||this.handler).css("cursor",r)},_createProxy:function(e,t){if(e){var n=this,o=this.options;"function"==typeof e?n.proxy=e.call(this.options.target,n,t):"clone"==e?(n.proxy=n.target.clone().css("position","absolute"),n.proxy.appendTo("body")):(n.proxy=r("<div class='l-draggable'></div>"),n.proxy.width(n.target.width()).height(n.target.height()),n.proxy.attr("dragid",n.id).appendTo("body")),n.proxy.css({left:null==o.proxyX?n.current.left:n.current.startX+o.proxyX,top:null==o.proxyY?n.current.top:n.current.startY+o.proxyY}).show()}},_removeProxy:function(){var r=this;r.proxy&&(r.proxy.remove(),r.proxy=null)}})}(jQuery);