!function(e){function t(e){return e?e.replace(/(^\s*)|(\s*$)/g,""):e}e.fn.ligerTree=function(t){return e.ligerui.run.call(this,"ligerTree",arguments)},e.fn.ligerGetTreeManager=function(){return e.ligerui.run.call(this,"ligerGetTreeManager",arguments)},e.ligerDefaults.Tree={url:null,urlParms:null,data:null,checkbox:!0,autoCheckboxEven:!0,enabledCompleteCheckbox:!0,parentIcon:"folder",childIcon:"leaf",textFieldName:"text",attribute:["id","url"],treeLine:!0,nodeWidth:90,statusName:"__status",isLeaf:null,single:!1,needCancel:!0,onBeforeExpand:function(){},onContextmenu:function(){},onExpand:function(){},onBeforeCollapse:function(){},onCollapse:function(){},onBeforeSelect:function(){},onSelect:function(){},onBeforeCancelSelect:function(){},onCancelselect:function(){},onCheck:function(){},onSuccess:function(){},onError:function(){},onClick:function(){},idFieldName:"id",parentIDFieldName:null,topParentIDValue:0,onBeforeAppend:function(){},onAppend:function(){},onAfterAppend:function(){},slide:!0,iconFieldName:"icon",nodeDraggable:!1,nodeDraggingRender:null,btnClickToToggleOnly:!0,ajaxType:"post",ajaxContentType:null,render:null,selectable:null,isExpand:null,delay:null,idField:null,parentIDField:null,iconClsFieldName:null},e.ligerui.controls.Tree=function(t,a){e.ligerui.controls.Tree.base.constructor.call(this,t,a)},e.ligerui.controls.Tree.ligerExtend(e.ligerui.core.UIComponent,{_init:function(){e.ligerui.controls.Tree.base._init.call(this);var t=this.options;t.single&&(t.autoCheckboxEven=!1)},_render:function(){var t=this,a=this.options;t.set(a,!0),t.tree=e(t.element),t.tree.addClass("l-tree"),t.toggleNodeCallbacks=[],t.sysAttribute=["isexpand","ischecked","href","style","delay"],t.loading=e("<div class='l-tree-loading'></div>"),t.tree.after(t.loading),t.data=[],t.maxOutlineLevel=1,t.treedataindex=0,t._applyTree(),t._setTreeEven(),t.set(a,!1)},_setTreeLine:function(e){e?this.tree.removeClass("l-tree-noline"):this.tree.addClass("l-tree-noline")},_setParms:function(){var t=this.options;e.isFunction(t.parms)&&(t.parms=t.parms())},reload:function(e){var t=this,a=this.options;t.clear(),t.loadData(null,a.url,null,{success:e})},reloadNode:function(e,t,a){var n=this,r=this.options;if(n.clear(e),"string"==typeof t)n.loadData(e,t,null,{success:a});else{if(!t)return;r.idField&&r.parentIDField&&(t=n.arrayToTree(t,r.idField,r.parentIDField)),n.append(e,t)}},_setUrl:function(e){var t=this;this.options;e&&(t.clear(),t.loadData(null,e))},_setData:function(e){e&&(this.clear(),this.append(null,e))},setData:function(e){this.set("data",e)},getData:function(){return this.data},hasChildren:function(e){return this.options.isLeaf?!this.options.isLeaf(e):!!e.children},getParent:function(t,a){var n=this;t=n.getNodeDom(t);var r=n.getParentTreeItem(t,a);if(!r)return null;var l=e(r).attr("treedataindex");return n._getDataNodeByTreeDataIndex(n.data,l)},getParentTreeItem:function(t,a){t=this.getNodeDom(t);var n=e(t);if(n.parent().hasClass("l-tree"))return null;if(void 0==a)return 0==n.parent().parent("li").length?null:n.parent().parent("li")[0];for(var r=parseInt(n.attr("outlinelevel")),l=n,o=r-1;o>=a;o--)l=l.parent().parent("li");return l[0]},getChecked:function(){var t=this;this.options;if(!this.options.checkbox)return null;var a=[];return e(".l-checkbox-checked",t.tree).parent().parent("li").each(function(){var n=parseInt(e(this).attr("treedataindex"));a.push({target:this,data:t._getDataNodeByTreeDataIndex(t.data,n)})}),a},getCheckedData:function(){var t=this;this.options;if(!this.options.checkbox)return null;var a=[];return e(".l-checkbox-checked",t.tree).parent().parent("li").each(function(){var n=parseInt(e(this).attr("treedataindex"));a.push(t._getDataNodeByTreeDataIndex(t.data,n))}),a},refreshTree:function(){var t=this;this.options;e.each(this.getChecked(),function(a,n){t._setParentCheckboxStatus(e(n.target))})},getSelected:function(){var t=this,a=(this.options,{});if(a.target=e(".l-selected",t.tree).parent("li")[0],a.target){var n=parseInt(e(a.target).attr("treedataindex"));return a.data=t._getDataNodeByTreeDataIndex(t.data,n),a}return null},upgrade:function(t){var a=this;this.options;e(".l-note",t).each(function(){e(this).removeClass("l-note").addClass("l-expandable-open")}),e(".l-note-last",t).each(function(){e(this).removeClass("l-note-last").addClass("l-expandable-open")}),e("."+a._getChildNodeClassName(),t).each(function(){e(this).removeClass(a._getChildNodeClassName()).addClass(a._getParentNodeClassName(!0))})},demotion:function(t){var a=this;this.options;if(t||"li"==t[0].tagName.toLowerCase()){var n=e(t).hasClass("l-last");e(".l-expandable-open",t).each(function(){e(this).removeClass("l-expandable-open").addClass(n?"l-note-last":"l-note")}),e(".l-expandable-close",t).each(function(){e(this).removeClass("l-expandable-close").addClass(n?"l-note-last":"l-note")}),e("."+a._getParentNodeClassName(!0),t).each(function(){e(this).removeClass(a._getParentNodeClassName(!0)).addClass(a._getChildNodeClassName())})}},collapseAll:function(){var t=this;this.options;e(".l-expandable-open",t.tree).click()},expandAll:function(){var t=this;this.options;e(".l-expandable-close",t.tree).click()},arrayToTree:function(e,t,a){function n(e){return"string"==typeof e&&(e=e.replace(/[.]/g,"").toLowerCase()),e}this.options;if(!e||!e.length)return[];for(var r=[],l={},o=e.length,i=0;i<o;i++){var s=e[i],d=n(s[t]);l[d]=s}for(var i=0;i<o;i++){var c=e[i],d=n(c[a]),h=l[d];h?(h.children=h.children||[],h.children.push(c)):r.push(c)}return r},loadData:function(t,a,n,r){var l=this,o=this.options;r=e.extend({showLoading:function(){l.loading.show()},success:function(){},error:function(){},hideLoading:function(){l.loading.hide()}},r||{});var i=o.ajaxType;n=e.extend(e.isFunction(o.parms)?o.parms():o.parms,n),"application/json"==o.ajaxContentType&&"string"!=typeof n&&(n=liger.toJSON(n));var s=e.isFunction(o.urlParms)?o.urlParms.call(l):o.urlParms;if(s)for(name in s)a+=-1==a.indexOf("?")?"?":"&",a+=name+"="+s[name];var d={type:i,url:a,data:n,dataType:"json",beforeSend:function(){r.showLoading()},success:function(e){e&&(o.idField&&o.parentIDField&&(e=l.arrayToTree(e,o.idField,o.parentIDField)),r.hideLoading(),l.append(t,e),l.trigger("success",[e]),r.success(e))},error:function(e,t,a){try{r.hideLoading(),l.trigger("error",[e,t,a]),r.error(e,t,a)}catch(e){}}};o.ajaxContentType&&(d.contentType=o.ajaxContentType),e.ajax(d)},clear:function(t){var a=this;this.options;if(t){var n=a.getNodeDom(t),r=a._getDataNodeByTreeDataIndex(a.data,e(n).attr("treedataindex"));e(n).find("ul.l-children").remove(),r&&(r.children=[])}else a.toggleNodeCallbacks=[],a.data=null,a.data=[],a.nodes=null,a.tree.html("")},getNodeDom:function(t){var a=this;this.options;return null==t?t:"string"==typeof t||"number"==typeof t?e("li[treedataindex="+t+"]",a.tree).get(0):"object"==typeof t&&"treedataindex"in t?a.getNodeDom(t.treedataindex):t.target&&t.data?t.target:t},hide:function(t){var a=this;this.options;(t=a.getNodeDom(t))&&e(t).hide()},show:function(t){var a=this;this.options;(t=a.getNodeDom(t))&&e(t).show()},remove:function(t){var a=this,n=this.options;t=a.getNodeDom(t);var r=parseInt(e(t).attr("treedataindex")),l=a._getDataNodeByTreeDataIndex(a.data,r);l&&a._setTreeDataStatus([l],"delete");var o=a.getParentTreeItem(t);n.checkbox&&a._setParentCheckboxStatus(e(t)),e(t).remove(),a._updateStyle(o?e("ul:first",o):a.tree)},_updateStyle:function(t){var a=this,n=(this.options,e(" > li",t)),r=n.length;r&&n.each(function(t,n){0!=t||e(this).hasClass("l-first")||e(this).addClass("l-first"),t!=r-1||e(this).hasClass("l-last")||e(this).addClass("l-last"),0==t&&t==r-1&&e(this).addClass("l-onlychild"),e("> div .l-note,> div .l-note-last",this).removeClass("l-note l-note-last").addClass(t==r-1?"l-note-last":"l-note"),a._setTreeItem(this,{isLast:t==r-1})})},update:function(t,a){var n=this,r=this.options;t=n.getNodeDom(t);var l=parseInt(e(t).attr("treedataindex"));nodedata=n._getDataNodeByTreeDataIndex(n.data,l);for(var o in a)nodedata[o]=a[o],o==r.textFieldName&&e("> .l-body > span",t).text(a[o])},append:function(t,a,n,r){var l=this,o=this.options;if(t=l.getNodeDom(t),0==l.trigger("beforeAppend",[t,a]))return!1;if(!a||!a.length)return!1;if(o.idFieldName&&o.parentIDFieldName&&(a=l.arrayToTree(a,o.idFieldName,o.parentIDFieldName)),l._addTreeDataIndexToData(a),l._setTreeDataStatus(a,"add"),null!=n&&(n=l.getNodeDom(n)),l.trigger("append",[t,a]),l._appendData(t,a),null==t){var i=l._getTreeHTMLByData(a,1,[],!0);return i[i.length-1]=i[0]="",null!=n?(e(n)[r?"after":"before"](i.join("")),l._updateStyle(t?e("ul:first",t):l.tree)):(e("> li:last",l.tree).length>0&&l._setTreeItem(e("> li:last",l.tree)[0],{isLast:!1}),l.tree.append(i.join(""))),e(".l-body",l.tree).hover(function(){e(this).addClass("l-over")},function(){e(this).removeClass("l-over")}),l._upadteTreeWidth(),void l.trigger("afterAppend",[t,a])}var s=e(t),d=parseInt(s.attr("outlinelevel"));e("> ul",s).length>0||(s.append("<ul class='l-children'></ul>"),l.upgrade(t));for(var c=[],h=1;h<=d-1;h++){var u=e(l.getParentTreeItem(t,h));c.push(u.hasClass("l-last"))}c.push(s.hasClass("l-last"));var i=l._getTreeHTMLByData(a,d+1,c,!0);i[i.length-1]=i[0]="",null!=n?(e(n)[r?"after":"before"](i.join("")),l._updateStyle(t?e("ul:first",t):l.tree)):(e("> .l-children > li:last",s).length>0&&l._setTreeItem(e("> .l-children > li:last",s)[0],{isLast:!1}),e(">.l-children",t).append(i.join(""))),l._upadteTreeWidth(),e(">.l-children .l-body",t).hover(function(){e(this).addClass("l-over")},function(){e(this).removeClass("l-over")}),l.trigger("afterAppend",[t,a])},cancelSelect:function(t,a){var n=this,r=this.options,l=n.getNodeDom(t),o=e(l),i=parseInt(o.attr("treedataindex")),s=n._getDataNodeByTreeDataIndex(n.data,i),d=e(">div:first",o);r.checkbox?e(".l-checkbox",d).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked"):d.removeClass("l-selected"),0!=a&&n.trigger("cancelSelect",[{data:s,target:o[0]}])},selectNode:function(a,n){var r=this,l=this.options,o=null;if("function"==typeof a)o=a;else{if("object"==typeof a){var i=e(a),s=parseInt(i.attr("treedataindex")),d=r._getDataNodeByTreeDataIndex(r.data,s),c=e(">div:first",i);return c.length||(c=e("li[treedataindex="+s+"] >div:first",r.tree)),l.checkbox?e(".l-checkbox",c).removeClass("l-checkbox-unchecked").addClass("l-checkbox-checked"):(e("div.l-selected",r.tree).removeClass("l-selected"),c.addClass("l-selected")),void(0!=n&&r.trigger("select",[{data:d,target:c.parent().get(0)}]))}o=function(e){return!(!e[l.idFieldName]&&0!=e[l.idFieldName])&&t(e[l.idFieldName].toString())==t(a.toString())}}e("li",r.tree).each(function(){var t=e(this),a=parseInt(t.attr("treedataindex")),l=r._getDataNodeByTreeDataIndex(r.data,a);o(l,a)?r.selectNode(this,n):r.options.checkbox||r.cancelSelect(this,n)})},getTextByID:function(e){var t=this,a=this.options,n=t.getDataByID(e);return n?n[a.textFieldName]:null},getDataByID:function(t){function a(e){for(var n=0;n<e.length;n++){var l=e[n];if(l[r.idFieldName]==t)return l;if(l.children&&l.children.length){var o=a(l.children);if(o)return o}}return null}var n=this,r=this.options,l=null;return n.data&&n.data.length?a(n.data):(e("li",n.tree).each(function(){if(!l){var a=e(this),o=parseInt(a.attr("treedataindex")),i=n._getDataNodeByTreeDataIndex(n.data,o);i[r.idFieldName].toString()==t.toString()&&(l=i)}}),l)},arrayToTree:function(e,t,a){if(!e||!e.length)return[];for(var n=[],r={},l=e.length,o=0;o<l;o++){var i=e[o];r[i[t]]=i}for(var o=0;o<l;o++){var s=e[o],d=r[s[a]];d?(d.children=d.children||[],d.children.push(s)):n.push(s)}return n},_getDataNodeByTreeDataIndex:function(e,t){for(var a=this,n=(this.options,0);n<e.length;n++){if(e[n].treedataindex==t)return e[n];if(e[n].children){var r=a._getDataNodeByTreeDataIndex(e[n].children,t);if(r)return r}}return null},_setTreeDataStatus:function(t,a){var n=this,r=this.options;e(t).each(function(){this[r.statusName]=a,this.children&&n._setTreeDataStatus(this.children,a)})},_addTreeDataIndexToData:function(t){var a=this;this.options;e(t).each(function(){void 0==this.treedataindex&&(this.treedataindex=a.treedataindex++,this.children&&a._addTreeDataIndexToData(this.children))})},_addToNodes:function(t){var a=this;this.options;a.nodes=a.nodes||[],a.nodes.push(t),t.children&&e(t.children).each(function(e,t){a._addToNodes(t)})},_appendData:function(t,a){var n=this,r=(this.options,parseInt(e(t).attr("treedataindex"))),l=n._getDataNodeByTreeDataIndex(n.data,r);void 0==n.treedataindex&&(n.treedataindex=0),l&&void 0==l.children&&(l.children=[]),e(a).each(function(e,t){l?l.children[l.children.length]=t:n.data[n.data.length]=t,n._addToNodes(t)})},_setTreeItem:function(t,a){var n=this;this.options;if(a){t=n.getNodeDom(t);var r=e(t),l=parseInt(r.attr("outlinelevel"));void 0!=a.isLast&&(1==a.isLast?(r.removeClass("l-last").addClass("l-last"),e("> div .l-note",r).removeClass("l-note").addClass("l-note-last"),e(".l-children li",r).find(".l-box:eq("+(l-1)+")").removeClass("l-line")):0==a.isLast&&(r.removeClass("l-last"),e("> div .l-note-last",r).removeClass("l-note-last").addClass("l-note"),e(".l-children li",r).find(".l-box:eq("+(l-1)+")").removeClass("l-line").addClass("l-line")))}},_upadteTreeWidth:function(){var e=this,t=this.options,a=22*e.maxOutlineLevel;t.checkbox&&(a+=22),(t.parentIcon||t.childIcon)&&(a+=22),a+=t.nodeWidth,e.tree.width(a)},_getChildNodeClassName:function(){return"l-tree-icon-"+this.options.childIcon},_getParentNodeClassName:function(e){var t=this.options,a="l-tree-icon-"+t.parentIcon;return e&&(a+="-open"),a},_isExpand:function(e,t){var a=this.options,n=null!=e.isExpand?e.isExpand:null!=e.isexpand?e.isexpand:a.isExpand;return null==n||("function"==typeof n&&(n=a.isExpand({data:e,level:t})),"boolean"==typeof n?n:"string"==typeof n?"true"==n:"number"!=typeof n||n>t)},_getDelay:function(t,a){var n=this.options,r=null!=t.delay?t.delay:n.delay;return null!=r&&("function"==typeof r&&(r=r({data:t,level:a})),"boolean"==typeof r?r:"string"==typeof r?{url:r}:("number"==typeof r&&(r=[r]),e.isArray(r)?-1!=e.inArray(a,r):!("object"!=typeof r||!r.url)&&r))},_getTreeHTMLByData:function(t,a,n,r){var l=this,o=this.options;l.maxOutlineLevel<a&&(l.maxOutlineLevel=a),n=n||[],a=a||1;var i=[];r?i.push("<ul class='l-children'>"):i.push('<ul class="l-children" style="display:none">');for(var s=0;s<t.length;s++){var d=t[s],c=0==s,h=s==t.length-1,u=l._getDelay(d,a),p=!u&&l._isExpand(d,a);i.push("<li "),void 0!=d.treedataindex&&i.push('treedataindex="'+d.treedataindex+'" '),p&&i.push("isexpand="+d.isexpand+" "),i.push("outlinelevel="+a+" ");for(var g=0;g<l.sysAttribute.length;g++)e(this).attr(l.sysAttribute[g])&&(t[dataindex][l.sysAttribute[g]]=e(this).attr(l.sysAttribute[g]));for(var g=0;g<o.attribute.length;g++)d[o.attribute[g]]&&i.push(o.attribute[g]+'="'+d[o.attribute[g]]+'" ');i.push('class="'),c&&i.push("l-first "),h&&i.push("l-last "),c&&h&&i.push("l-onlychild "),i.push('"'),i.push(">"),i.push('<div class="l-body'),o.selectable&&0==o.selectable(d)&&i.push(" l-unselectable"),i.push('">');for(var f=0;f<=a-2;f++)n[f]?i.push('<div class="l-box"></div>'):i.push('<div class="l-box l-line"></div>');if(l.hasChildren(d)?(p?i.push('<div class="l-box l-expandable-open"></div>'):i.push('<div class="l-box l-expandable-close"></div>'),o.checkbox&&(d.ischecked?i.push('<div class="l-box l-checkbox l-checkbox-checked"></div>'):i.push('<div class="l-box l-checkbox l-checkbox-unchecked"></div>')),o.parentIcon&&(i.push('<div class="l-box l-tree-icon '),i.push(l._getParentNodeClassName(!!p)+" "),o.iconFieldName&&d[o.iconFieldName]?i.push("l-tree-icon-none"):o.iconClsFieldName&&d[o.iconClsFieldName]&&i.push("l-tree-icon-"+d[o.iconClsFieldName]+" "),i.push('">'),o.iconFieldName&&d[o.iconFieldName]&&i.push('<img src="'+d[o.iconFieldName]+'" />'),i.push("</div>"))):(h?i.push('<div class="l-box l-note-last"></div>'):i.push('<div class="l-box l-note"></div>'),o.checkbox&&(d.ischecked?i.push('<div class="l-box l-checkbox l-checkbox-checked"></div>'):i.push('<div class="l-box l-checkbox l-checkbox-unchecked"></div>')),o.childIcon&&(i.push('<div class="l-box l-tree-icon '),i.push(l._getChildNodeClassName()+" "),o.iconFieldName&&d[o.iconFieldName]?i.push("l-tree-icon-none"):o.iconClsFieldName&&d[o.iconClsFieldName]&&i.push("l-tree-icon-"+d[o.iconClsFieldName]+" "),i.push('">'),o.iconFieldName&&d[o.iconFieldName]&&i.push('<img src="'+d[o.iconFieldName]+'" />'),i.push("</div>"))),o.render?i.push("<span>"+o.render(d,d[o.textFieldName])+"</span>"):i.push("<span>"+d[o.textFieldName]+"</span>"),i.push("</div>"),l.hasChildren(d)){for(var v=[],f=0;f<n.length;f++)v.push(n[f]);v.push(h),u?1==u?l.toggleNodeCallbacks.push({data:d,callback:function(t,n){var r=l._getTreeHTMLByData(n.children,a+1,v,p).join("");e(t).append(r),e(">.l-children .l-body",t).hover(function(){e(this).addClass("l-over")},function(){e(this).removeClass("l-over")}),l._removeToggleNodeCallback(n)}}):u.url&&function(t,a,n){l.toggleNodeCallbacks.push({data:t,callback:function(t,r){l.loadData(t,a,n,{showLoading:function(){e("div.l-expandable-close:first",t).addClass("l-box-loading")},hideLoading:function(){e("div.l-box-loading:first",t).removeClass("l-box-loading")}}),l._removeToggleNodeCallback(r)}})}(d,u.url,u.parms):i.push(l._getTreeHTMLByData(d.children,a+1,v,p).join(""))}i.push("</li>")}return i.push("</ul>"),i},_removeToggleNodeCallback:function(e){for(var t=this,a=(this.options,0);a<=t.toggleNodeCallbacks.length;a++)if(t.toggleNodeCallbacks[a]&&t.toggleNodeCallbacks[a].data==e){t.toggleNodeCallbacks.splice(a,1);break}},_getDataByTreeHTML:function(t){var a=this,n=this.options,r=[];return e("> li",t).each(function(t,l){var o=r.length;r[o]={treedataindex:a.treedataindex++},r[o][n.textFieldName]=e("> span,> a",this).html();for(var i=0;i<a.sysAttribute.length;i++)e(this).attr(a.sysAttribute[i])&&(r[o][a.sysAttribute[i]]=e(this).attr(a.sysAttribute[i]));for(var i=0;i<n.attribute.length;i++)e(this).attr(n.attribute[i])&&(r[o][n.attribute[i]]=e(this).attr(n.attribute[i]));e("> ul",this).length>0&&(r[o].children=a._getDataByTreeHTML(e("> ul",this)))}),r},_applyTree:function(){var t=this;this.options;t.data=t._getDataByTreeHTML(t.tree);var a=t._getTreeHTMLByData(t.data,1,[],!0);a[a.length-1]=a[0]="",t.tree.html(a.join("")),t._upadteTreeWidth(),e(".l-body",t.tree).hover(function(){e(this).addClass("l-over")},function(){e(this).removeClass("l-over")})},_getSrcElementByEvent:function(t){var a=this,n=t.target||t.srcElement,r=n.tagName.toLowerCase(),l=e(n).parents().add(n),o=function(t){for(var a=l.length-1;a>=0;a--)if(e(l[a]).hasClass(t))return l[a];return null};if(-1==l.index(this.element))return{out:!0};var i={tree:o("l-tree"),node:o("l-body"),checkbox:o("l-checkbox"),icon:o("l-tree-icon"),text:"span"==r};if(i.node){var s=parseInt(e(i.node).parent().attr("treedataindex"));i.data=a._getDataNodeByTreeDataIndex(a.data,s)}return i},_setTreeEven:function(){var t=this,a=this.options;t.hasBind("contextmenu")&&t.tree.bind("contextmenu",function(a){var n=a.target||a.srcElement,r=null;if("a"==n.tagName.toLowerCase()||"span"==n.tagName.toLowerCase()||e(n).hasClass("l-box")?r=e(n).parent().parent():e(n).hasClass("l-body")?r=e(n).parent():"li"==n.tagName.toLowerCase()&&(r=e(n)),r){var l=parseInt(r.attr("treedataindex")),o=t._getDataNodeByTreeDataIndex(t.data,l);return t.trigger("contextmenu",[{data:o,target:r[0]},a])}}),t.tree.click(function(n){var r=n.target||n.srcElement,l=null;if(l="a"==r.tagName.toLowerCase()||"span"==r.tagName.toLowerCase()||e(r).hasClass("l-box")?e(r).parent().parent():e(r).hasClass("l-body")?e(r).parent():e(r)){var o=parseInt(l.attr("treedataindex")),i=t._getDataNodeByTreeDataIndex(t.data,o),s=e("div.l-body:first",l).find("div.l-expandable-open:first,div.l-expandable-close:first"),d=e(r).hasClass("l-expandable-open")||e(r).hasClass("l-expandable-close");if(!e(r).hasClass("l-checkbox")&&!d&&!l.hasClass("l-unselectable"))if(e(">div:first",l).hasClass("l-selected")&&a.needCancel){if(0==t.trigger("beforeCancelSelect",[{data:i,target:l[0]}]))return!1;e(">div:first",l).removeClass("l-selected"),t.trigger("cancelSelect",[{data:i,target:l[0]}])}else{if(0==t.trigger("beforeSelect",[{data:i,target:l[0]}]))return!1;e(".l-body",t.tree).removeClass("l-selected"),e(">div:first",l).addClass("l-selected"),t.trigger("select",[{data:i,target:l[0]}])}if(e(r).hasClass("l-checkbox"))a.autoCheckboxEven?(e(r).hasClass("l-checkbox-unchecked")?(e(r).removeClass("l-checkbox-unchecked").addClass("l-checkbox-checked"),e(".l-children .l-checkbox",l).removeClass("l-checkbox-incomplete l-checkbox-unchecked").addClass("l-checkbox-checked"),t.trigger("check",[{data:i,target:l[0]},!0])):e(r).hasClass("l-checkbox-checked")?(e(r).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked"),e(".l-children .l-checkbox",l).removeClass("l-checkbox-incomplete l-checkbox-checked").addClass("l-checkbox-unchecked"),t.trigger("check",[{data:i,target:l[0]},!1])):e(r).hasClass("l-checkbox-incomplete")&&(e(r).removeClass("l-checkbox-incomplete").addClass("l-checkbox-checked"),e(".l-children .l-checkbox",l).removeClass("l-checkbox-incomplete l-checkbox-unchecked").addClass("l-checkbox-checked"),t.trigger("check",[{data:i,target:l[0]},!0])),t._setParentCheckboxStatus(l)):e(r).hasClass("l-checkbox-unchecked")?(e(r).removeClass("l-checkbox-unchecked").addClass("l-checkbox-checked"),a.single&&e(".l-checkbox",t.tree).not(r).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked"),t.trigger("check",[{data:i,target:l[0]},!0])):e(r).hasClass("l-checkbox-checked")&&(e(r).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked"),t.trigger("check",[{data:i,target:l[0]},!1]));else if(!s.hasClass("l-expandable-open")||a.btnClickToToggleOnly&&!d){if(s.hasClass("l-expandable-close")&&(!a.btnClickToToggleOnly||d)){if(0==t.trigger("beforeExpand",[{data:i,target:l[0]}]))return!1;e(t.toggleNodeCallbacks).each(function(){this.data==i&&this.callback(l[0],i)}),s.removeClass("l-expandable-close").addClass("l-expandable-open");var c=function(){t.trigger("expand",[{data:i,target:l[0]}])};a.slide?e("> .l-children",l).slideToggle("fast",c):(e("> .l-children",l).show(),c()),e("> div ."+t._getParentNodeClassName(),l).removeClass(t._getParentNodeClassName()).addClass(t._getParentNodeClassName(!0))}}else{if(0==t.trigger("beforeCollapse",[{data:i,target:l[0]}]))return!1;s.removeClass("l-expandable-open").addClass("l-expandable-close"),a.slide?e("> .l-children",l).slideToggle("fast"):e("> .l-children",l).hide(),e("> div ."+t._getParentNodeClassName(!0),l).removeClass(t._getParentNodeClassName(!0)).addClass(t._getParentNodeClassName()),t.trigger("collapse",[{data:i,target:l[0]}])}t.trigger("click",[{data:i,target:l[0]}])}}),e.fn.ligerDrag&&a.nodeDraggable&&(t.nodeDroptip=e("<div class='l-drag-nodedroptip' style='display:none'></div>").appendTo("body"),t.tree.ligerDrag({revert:!0,animate:!1,proxyX:20,proxyY:20,proxy:function(n,r){if(t._getSrcElementByEvent(r).node){var l="dragging";if(a.nodeDraggingRender)l=a.nodeDraggingRender(n.draggingNodes,n,t);else{l="";var o=!1;for(var i in n.draggingNodes){var s=n.draggingNodes[i];o&&(l+=","),l+=s.text,o=!0}}return e("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div>"+l+"</div>").appendTo("body")}},onRevert:function(){return!1},onRendered:function(){this.set("cursor","default"),t.children[this.id]=this},onStartDrag:function(e,n){if(2==n.button)return!1;this.set("cursor","default");var r=t._getSrcElementByEvent(n);if(r.checkbox)return!1;if(a.checkbox){var l=t.getChecked();this.draggingNodes=[];for(var o in l)this.draggingNodes.push(l[o].data);if(!this.draggingNodes||!this.draggingNodes.length)return!1}else this.draggingNodes=[r.data];this.draggingNode=r.data,this.set("cursor","move"),t.nodedragging=!0,this.validRange={top:t.tree.offset().top,bottom:t.tree.offset().top+t.tree.height(),left:t.tree.offset().left,right:t.tree.offset().left+t.tree.width()}},onDrag:function(a,n){var r=this.draggingNode;if(!r)return!1;var l=this.draggingNodes?this.draggingNodes:[r];null==t.nodeDropIn&&(t.nodeDropIn=-1);var o=n.pageX,i=n.pageY,s=!1,d=this.validRange;if(o<d.left||o>d.right||i>d.bottom||i<d.top)return t.nodeDropIn=-1,t.nodeDroptip.hide(),void this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes l-drop-add").addClass("l-drop-no");for(var c=0,h=t.nodes.length;c<h;c++){var u=t.nodes[c],p=u.treedataindex;if(r.treedataindex==p&&(s=!0),-1==e.inArray(u,l)){var g=!!s;if(-1==t.nodeDropIn||t.nodeDropIn==p){var f=e("li[treedataindex="+p+"] div:first",t.tree),v=f.offset(),x={top:v.top,bottom:v.top+f.height(),left:t.tree.offset().left,right:t.tree.offset().left+t.tree.width()};if(o>x.left&&o<x.right&&i>x.top&&i<x.bottom){var b=v.top;g&&(b+=f.height()),t.nodeDroptip.css({left:x.left,top:b,width:x.right-x.left}).show(),t.nodeDropIn=p,t.nodeDropDir=g?"bottom":"top",i>x.top+7&&i<x.bottom-7?(this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-yes").addClass("l-drop-add"),t.nodeDroptip.hide(),t.nodeDropInParent=!0):(this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-add").addClass("l-drop-yes"),t.nodeDroptip.show(),t.nodeDropInParent=!1);break}-1!=t.nodeDropIn&&(t.nodeDropIn=-1,t.nodeDropInParent=!1,t.nodeDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes  l-drop-add").addClass("l-drop-no"))}}}},onStopDrag:function(a,n){var r=this.draggingNodes;if(t.nodedragging=!1,-1!=t.nodeDropIn){for(var l=0;l<r.length;l++){var o=r[l].children;o&&(r=e.grep(r,function(t,a){return-1==e.inArray(t,o)}))}for(var l in r){var i=r[l];t.nodeDropInParent?(t.remove(i),t.append(t.nodeDropIn,[i])):(t.remove(i),t.append(t.getParent(t.nodeDropIn),[i],t.nodeDropIn,"bottom"==t.nodeDropDir))}t.nodeDropIn=-1}t.nodeDroptip.hide(),this.set("cursor","default")}}))},_setParentCheckboxStatus:function(t){var a=this,n=this.options,r=0==e(".l-checkbox-unchecked",t.parent()).length;0==e(".l-checkbox-checked",t.parent()).length?t.parent().prev().find("> .l-checkbox").removeClass("l-checkbox-checked l-checkbox-incomplete").addClass("l-checkbox-unchecked"):r||!n.enabledCompleteCheckbox?t.parent().prev().find(".l-checkbox").removeClass("l-checkbox-unchecked l-checkbox-incomplete").addClass("l-checkbox-checked"):t.parent().prev().find("> .l-checkbox").removeClass("l-checkbox-unchecked l-checkbox-checked").addClass("l-checkbox-incomplete"),t.parent().parent("li").length>0&&a._setParentCheckboxStatus(t.parent().parent("li"))}})}(jQuery);