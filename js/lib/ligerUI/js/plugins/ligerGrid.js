!function($){function removeArrItem(e,t){for(var r=e.length-1;r>=0;r--)t(e[r])&&e.splice(r,1)}var l=$.ligerui;$.fn.ligerGrid=function(e){return $.ligerui.run.call(this,"ligerGrid",arguments)},$.fn.ligerGetGridManager=function(){return $.ligerui.run.call(this,"ligerGetGridManager",arguments)},$.ligerDefaults.Grid={title:null,width:"auto",height:"auto",columnWidth:null,resizable:!0,url:!1,urlParms:null,data:null,usePager:!0,hideLoadButton:!1,pagerRender:null,page:1,pageSize:10,pageSizeOptions:[10,20,30,40,50],parms:[],columns:[],minColToggle:1,dataType:"server",dataAction:"server",showTableToggleBtn:!1,switchPageSizeApplyComboBox:!1,allowAdjustColWidth:!0,checkbox:!1,isSingleCheck:!1,allowHideColumn:!0,enabledEdit:!1,isScroll:!0,dateFormat:"yyyy-MM-dd",inWindow:!0,statusName:"__status",method:"post",async:!0,fixedCellHeight:!0,heightDiff:0,cssClass:null,root:"Rows",record:"Total",pageParmName:"page",pagesizeParmName:"pagesize",sortnameParmName:"sortname",sortorderParmName:"sortorder",allowUnSelectRow:!1,alternatingRow:!0,mouseoverRowCssClass:"l-grid-row-over",enabledSort:!0,rowClsRender:null,rowAttrRender:null,groupColumnName:null,groupColumnDisplay:"分组",groupRender:null,totalRender:null,delayLoad:!1,where:null,selectRowButtonOnly:!1,selectable:!0,whenRClickToSelect:!1,contentType:null,checkboxColWidth:27,detailColWidth:29,clickToEdit:!0,detailToEdit:!1,onEndEdit:null,minColumnWidth:80,tree:null,isChecked:null,isSelected:null,frozen:!0,frozenDetail:!1,frozenCheckbox:!0,detail:null,detailHeight:260,isShowDetailToggle:null,rownumbers:!1,frozenRownumbers:!0,rownumbersColWidth:26,colDraggable:!1,rowDraggable:!1,rowDraggingRender:null,autoCheckChildren:!0,onRowDragDrop:null,rowHeight:28,headerRowHeight:28,toolbar:null,toolbarShowInLeft:!0,headerImg:null,editorTopDiff:3,editorLeftDiff:1,editorHeightDiff:-1,unSetValidateAttr:!0,autoFilter:!1,rowSelectable:!0,scrollToPage:!1,scrollToAppend:!0,onDragCol:null,onToggleCol:null,onChangeSort:null,onSuccess:null,onDblClickRow:null,onSelectRow:null,onBeforeSelectRow:null,onUnSelectRow:null,onBeforeCheckRow:null,onCheckRow:null,onBeforeCheckAllRow:null,onCheckAllRow:null,onBeforeShowData:null,onAfterShowData:null,onError:null,onSubmit:null,onReload:null,onToFirst:null,onToPrev:null,onToNext:null,onToLast:null,onAfterAddRow:null,onBeforeEdit:null,onBeforeSubmitEdit:null,onAfterEdit:null,onLoading:null,onLoaded:null,onContextmenu:null,onBeforeCancelEdit:null,onAfterSubmitEdit:null,onRowDragDrop:null,onGroupExtend:null,onGroupCollapse:null,onTreeExpand:null,onTreeCollapse:null,onTreeExpanded:null,onTreeCollapsed:null,onLoadData:null,onHeaderCellBulid:null},$.ligerDefaults.GridString={errorMessage:"发生错误",pageStatMessage:"显示从{from}到{to}，总 {total} 条 。每页显示：{pagesize}",pageTextMessage:"Page",loadingMessage:"加载中...",findTextMessage:"查找",noRecordMessage:"没有符合条件的记录存在",isContinueByDataChanged:"数据已经改变,如果继续将丢失数据,是否继续?",cancelMessage:"取消",saveMessage:"保存",applyMessage:"应用",draggingMessage:"{count}行"},$.ligerDefaults.Grid_columns={id:null,name:null,totalSummary:null,display:null,headerRender:null,isAllowHide:!0,isSort:!1,type:null,columns:null,width:120,minWidth:80,format:null,align:"left",hide:!1,editor:null,render:null,textField:null},$.ligerDefaults.Grid_editor={type:null,ext:null,onChange:null,onChanged:null},$.ligerMethos.Grid=$.ligerMethos.Grid||{},$.ligerDefaults.Grid.sorters=$.ligerDefaults.Grid.sorters||{},$.ligerDefaults.Grid.formatters=$.ligerDefaults.Grid.formatters||{},$.ligerDefaults.Grid.editors=$.ligerDefaults.Grid.editors||{},$.ligerDefaults.Grid.sorters.date=function(e,t){return e<t?-1:e>t?1:0},$.ligerDefaults.Grid.sorters.int=function(e,t){return parseInt(e)<parseInt(t)?-1:parseInt(e)>parseInt(t)?1:0},$.ligerDefaults.Grid.sorters.float=function(e,t){return parseFloat(e)<parseFloat(t)?-1:parseFloat(e)>parseFloat(t)?1:0},$.ligerDefaults.Grid.sorters.string=function(e,t){return!!e&&e.localeCompare(t)},$.ligerDefaults.Grid.formatters.date=function(value,column){function getFormatDate(e,t){this.options;if(isNaN(e))return null;var r=t,i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(r)&&(r=r.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in i)new RegExp("("+o+")").test(r)&&(r=r.replace(RegExp.$1,1==RegExp.$1.length?i[o]:("00"+i[o]).substr((""+i[o]).length)));return r}if(!value)return"";if("string"==typeof value&&/^\/Date/.test(value)&&(value=value.replace(/^\//,"new ").replace(/\/$/,""),eval("value = "+value)),value instanceof Date){var format=column.format||this.options.dateFormat||"yyyy-MM-dd";return getFormatDate(value,format)}return value.toString()},$.ligerDefaults.Grid.formatters.ref=function(e){return $.isArray(e)?e.length>1?e[1]:e[0]:e},$.ligerui.controls.Grid=function(e,t){$.ligerui.controls.Grid.base.constructor.call(this,e,t)},$.ligerui.controls.Grid.ligerExtend($.ligerui.core.UIComponent,{__getType:function(){return"$.ligerui.controls.Grid"},__idPrev:function(){return"grid"},_extendMethods:function(){return $.ligerMethos.Grid},_init:function(){$.ligerui.controls.Grid.base._init.call(this);var e=this,t=this.options;t.dataType=t.url?"server":"local","local"==t.dataType&&(t.data=t.data||[],t.dataAction="local"),0==t.isScroll&&(t.height="auto"),t.frozen||(t.frozenCheckbox=!1,t.frozenDetail=!1,t.frozenRownumbers=!1),t.detailToEdit&&(t.enabledEdit=!0,t.clickToEdit=!1,t.detail={height:"auto",onShowDetail:function(r,i,o){function l(){$(i).parent().parent().remove(),e.collapseDetail(r)}$(i).addClass("l-grid-detailpanel-edit"),e.beginEdit(r,function(e,r){var o=$("<div class='l-editbox'></div>");return o.width(120).height(t.rowHeight+1),o.appendTo(i),o}),$("<div class='l-clear'></div>").appendTo(i),$("<div class='l-button'>"+t.saveMessage+"</div>").appendTo(i).click(function(){e.endEdit(r),l()}),$("<div class='l-button'>"+t.applyMessage+"</div>").appendTo(i).click(function(){e.submitEdit(r)}),$("<div class='l-button'>"+t.cancelMessage+"</div>").appendTo(i).click(function(){e.cancelEdit(r),l()})}}),t.tree&&(t.tree.childrenName=t.tree.childrenName||"children",t.tree.isParent=t.tree.isParent||function(e){return t.tree.childrenName in e},t.tree.isExtend=t.tree.isExtend||function(e){return!("isextend"in e&&0==e.isextend)});for(var r in liger.editors){var i=liger.editors[r];!i||r in t.editors||(t.editors[r]=liger.getEditor($.extend({type:r,master:e},i)))}},_render:function(){var e=this,t=this.options;e.grid=$(e.element),e.grid.addClass("l-panel");var r=[];if(r.push("        <div class='l-panel-header'><span class='l-panel-header-text'></span></div>"),r.push("                    <div class='l-grid-loading'></div>"),r.push("        <div class='l-panel-topbar' style='display:none'><div class='l-panel-topbarinner'></div></div><div class='l-clear'></div>"),r.push("        <div class='l-panel-bwarp'>"),r.push("            <div class='l-panel-body'>"),r.push("                <div class='l-grid'>"),r.push("                    <div class='l-grid-dragging-line'></div>"),r.push("                    <div class='l-grid-popup'><table cellpadding='0' cellspacing='0'><tbody></tbody></table></div>"),r.push("                  <div class='l-grid1'>"),r.push("                      <div class='l-grid-header l-grid-header1'>"),r.push("                          <div class='l-grid-header-inner'><table class='l-grid-header-table' cellpadding='0' cellspacing='0'><tbody></tbody></table></div>"),r.push("                      </div>"),r.push("                      <div class='l-grid-body l-grid-body1'>"),r.push("                      </div>"),r.push("                  </div>"),r.push("                  <div class='l-grid2'>"),r.push("                      <div class='l-grid-header l-grid-header2'>"),r.push("                          <div class='l-grid-header-inner'><table class='l-grid-header-table' cellpadding='0' cellspacing='0'><tbody></tbody></table></div>"),r.push("                      </div>"),r.push("                      <div class='l-grid-body l-grid-body2 l-scroll'>"),r.push("                      </div>"),r.push("                  </div>"),r.push("                 </div>"),r.push("              </div>"),r.push("         </div>"),r.push("         <div class='l-panel-bar'>"),r.push("            <div class='l-panel-bbar-inner'>"),r.push("                <div class='l-bar-group  l-bar-message'><span class='l-bar-text'></span></div>"),r.push("            <div class='l-bar-group l-bar-selectpagesize'></div>"),r.push("                <div class='l-bar-separator'></div>"),r.push("                <div class='l-bar-group'>"),r.push("                    <div class='l-bar-button l-bar-btnfirst'><span></span></div>"),r.push("                    <div class='l-bar-button l-bar-btnprev'><span></span></div>"),r.push("                </div>"),r.push("                <div class='l-bar-separator'></div>"),r.push("                <div class='l-bar-group'><span class='pcontrol'> <input type='text' size='4' value='1' style='width:20px' maxlength='3' /> / <span></span></span></div>"),r.push("                <div class='l-bar-separator'></div>"),r.push("                <div class='l-bar-group'>"),r.push("                     <div class='l-bar-button l-bar-btnnext'><span></span></div>"),r.push("                    <div class='l-bar-button l-bar-btnlast'><span></span></div>"),r.push("                </div>"),r.push("                <div class='l-bar-separator'></div>"),r.push("                <div class='l-bar-group'>"),r.push("                     <div class='l-bar-button l-bar-btnload'><span></span></div>"),r.push("                </div>"),r.push("                <div class='l-bar-separator'></div>"),r.push("                <div class='l-clear'></div>"),r.push("            </div>"),r.push("         </div>"),e.grid.html(r.join("")),e.header=$(".l-panel-header:first",e.grid),e.body=$(".l-panel-body:first",e.grid),e.toolbar=$(".l-panel-bar:first",e.grid),e.popup=$(".l-grid-popup:first",e.grid),e.gridloading=$(".l-grid-loading:first",e.grid),e.draggingline=$(".l-grid-dragging-line",e.grid),e.topbar=$(".l-panel-topbarinner:first",e.grid),e.gridview=$(".l-grid:first",e.grid),e.gridview.attr("id",e.id+"grid"),e.gridview1=$(".l-grid1:first",e.gridview),e.gridview2=$(".l-grid2:first",e.gridview),e.gridheader=$(".l-grid-header:first",e.gridview2),e.gridbody=$(".l-grid-body:first",e.gridview2),t.autoFilter){var i={text:"高级查询",gridid:e.id,click:function(){e.showFilter()},icon:"search2"};t.toolbar&&t.toolbar.items?t.toolbar.items.push(i):t.toolbar={items:[i]}}e.f={},e.f.gridheader=$(".l-grid-header:first",e.gridview1),e.f.gridbody=$(".l-grid-body:first",e.gridview1),e.currentData=null,e.changedCells={},e.editors={},e.editor={editing:!1},e.cacheData={},"auto"==t.height&&e.bind("SysGridHeightChanged",function(){e.enabledFrozen()&&e.gridview.height(Math.max(e.gridview1.height(),e.gridview2.height()))});var o=$.extend({},t);this._bulid(),this._setColumns(t.columns),delete o.columns,delete o.data,delete o.url,e.set(o),t.delayLoad||(t.url?e.set({url:t.url}):t.data&&e.set({data:t.data}))},_setFrozen:function(e){e?this.grid.addClass("l-frozen"):this.grid.removeClass("l-frozen")},_setCssClass:function(e){this.grid.addClass(e)},_setLoadingMessage:function(e){this.gridloading.html(e)},_setToolbar:function(e){var t=this,r=this.options;if(e&&$.fn.ligerToolBar){if(t.topbar.parent().show(),t.toolbarManager=t.topbar.ligerToolBar(e),e.title){var i=$("<div class='l-panel-topbartitle'><span>"+e.title+"</span></div>");e.icon&&(i.append("<img class='l-panel-topbaricon' src='"+e.icon+"'></img>"),i.addClass("l-panel-topbartitle-hasicon")),t.topbar.parent().append(i)}r.toolbarShowInLeft&&t.topbar.addClass("l-panel-topbarinner-left")}else t.topbar.parent().remove()},isHorizontalScrollShowed:function(){var e=this,t=e.gridbody.find(".l-grid-body-inner:first");return!!t.length&&e.gridbody.width()-20<t.width()},_setHeight:function(e){var t=this,r=this.options;if(t.unbind("SysGridHeightChanged"),"auto"==e)return void t.bind("SysGridHeightChanged",function(){t.enabledFrozen()&&t.gridview.height(Math.max(t.gridview1.height(),t.gridview2.height()))});if((e=t._calculateGridBodyHeight(e))>0){if(t.gridbody.height(e),r.frozen){var i=t.gridbody.width(),o=$(":first-child",t.gridbody).width();o&&o+18>i?e>18&&t.f.gridbody.height(e-18):t.f.gridbody.height(e)}var l=r.headerRowHeight*(t._columnMaxLevel-1)+r.headerRowHeight-1;t.gridview.height(e+l)}t._updateHorizontalScrollStatus.ligerDefer(t,10)},_calculateGridBodyHeight:function(e){var t=this,r=this.options;return"string"==typeof e&&e.indexOf("%")>0&&(e=r.inWindow?$(window).height()*parseInt(e)*.01:t.grid.parent().height()*parseInt(e)*.01),r.title&&(e-=24),(r.usePager&&r.pagerRender||!r.scrollToPage)&&(e-=t.toolbar.outerHeight()),r.totalRender&&(e-=25),r.toolbar&&(e-=t.topbar.outerHeight()),e-=r.headerRowHeight*(t._columnMaxLevel-1)+r.headerRowHeight-1||0},_updateHorizontalScrollStatus:function(){var e=this;this.options;e.isHorizontalScrollShowed()?e.gridview.addClass("l-grid-hashorizontal"):e.gridview.removeClass("l-grid-hashorizontal")},_updateFrozenWidth:function(){var e=this;this.options;if(e.enabledFrozen()){e.gridview1.width(e.f.gridtablewidth);var t=e.gridview.width()-e.f.gridtablewidth;e.gridview2.css({left:e.f.gridtablewidth}),t>0&&e.gridview2.css({width:t})}},_setWidth:function(e){var t=this;this.options;t.enabledFrozen()&&t._onResize()},_setUrl:function(e){this.options.url=e,e?(this.options.dataType="server",this.loadData(!0)):this.options.dataType="local"},removeParm:function(e){var t=this,r=t.get("parms");r||(r={}),r instanceof Array?removeArrItem(r,function(t){return t.name==e}):delete r[e],t.set("parms",r)},setParm:function(e,t){var r=this,i=r.get("parms");i||(i={}),i instanceof Array?(removeArrItem(i,function(t){return t.name==e}),i.push({name:e,value:t})):i[e]=t,r.set("parms",i)},_setData:function(e){this.loadData(this.options.data),this.trigger("afterSetData")},loadData:function(e,t){var r=this,i=this.options;r.loading=!0,r.trigger("loadData");var o=null,l=!0;"function"==typeof e?(o=e,r.lastData?r.data=r.lastData:(r.data=r.currentData,r.data||(r.data={}),r.data[i.root]||(r.data[i.root]=[]),r.lastData=r.data),l=!1):"boolean"==typeof e?l=e:"object"==typeof e&&e?(l=!1,i.dataType="local",i.data=e):"number"==typeof e&&(i.newPage=e),i.newPage||(i.newPage=1),"server"==i.dataAction&&(i.sortOrder||(i.sortOrder="asc"));var a=[];if(i.parms){var n=$.isFunction(i.parms)?i.parms():i.parms;if(n.length){$(n).each(function(){a.push({name:this.name,value:this.value})});for(var d=n.length-1;d>=0;d--)n[d].temp&&n.splice(d,1)}else if("object"==typeof n)for(var s in n)a.push({name:s,value:n[s]})}"server"==i.dataAction&&(i.usePager&&(a.push({name:i.pageParmName,value:i.newPage}),a.push({name:i.pagesizeParmName,value:i.pageSize})),i.sortName&&(a.push({name:i.sortnameParmName,value:i.sortName}),a.push({name:i.sortorderParmName,value:i.sortOrder}))),$(".l-bar-btnload span",r.toolbar).addClass("l-disabled"),"local"==i.dataType?(r.filteredData=$.extend(!0,{},i.data||r.currentData),o&&(r.filteredData[i.root]=r._searchData(r.filteredData[i.root],o)),i.usePager?r.currentData=r._getCurrentPageData(r.filteredData):r.currentData=r.filteredData,r._convertTreeData(),r._showData()):"local"!=i.dataAction||l?r.loadServerData(a,o,t):r.data&&r.data[i.root]&&(r.filteredData=r.data,o&&(r.filteredData[i.root]=r._searchData(r.filteredData[i.root],o)),r.currentData=r._getCurrentPageData(r.filteredData),r._convertTreeData(),r._showData()),r.loading=!1},_convertTreeData:function(){var e=this,t=this.options;t.tree&&t.tree.idField&&t.tree.parentIDField&&(e.currentData[t.root]=e.arrayToTree(e.currentData[t.root],t.tree.idField,t.tree.parentIDField),e.currentData[t.record]=e.currentData[t.root].length)},loadServerData:function(e,t,r){var i=this,o=this.options,l=o.url;$.isFunction(l)&&(l=l.call(i));var a=$.isFunction(o.urlParms)?o.urlParms.call(i):o.urlParms;if(a)for(name in a)l+=-1==l.indexOf("?")?"?":"&",l+=name+"="+a[name];var n={type:o.method,url:l,data:e,async:o.async,dataType:"json",beforeSend:function(){i.hasBind("loading")?i.trigger("loading"):i.toggleLoading(!0)},success:function(e){if(i.trigger("success",[e,i]),!e||!e[o.root]||!e[o.root].length)return i.currentData=i.data={},i.currentData[o.root]=i.data[o.root]=[],e&&e[o.record]?i.currentData[o.record]=i.data[o.record]=e[o.record]:i.currentData[o.record]=i.data[o.record]=0,i._convertTreeData(),void i._showData(r);i.data=e,null!=i.data[o.record]&&(i.cacheData.records=i.data[o.record]),"server"==o.dataAction?(i.currentData=i.data,null==i.currentData[o.record]&&i.cacheData.records&&(i.currentData[o.record]=i.cacheData.records)):(i.filteredData=i.data,t&&(i.filteredData[o.root]=i._searchData(i.filteredData[o.root],t)),o.usePager?i.currentData=i._getCurrentPageData(i.filteredData):i.currentData=i.filteredData),i._convertTreeData(),i._showData.ligerDefer(i,10,[r])},complete:function(){i.trigger("complete",[i]),i.hasBind("loaded")?i.trigger("loaded",[i]):i.toggleLoading.ligerDefer(i,10,[!1])},error:function(e,t,r){i.currentData=i.data={},i.currentData[o.root]=i.data[o.root]=[],i.currentData[o.record]=i.data[o.record]=0,i.toggleLoading.ligerDefer(i,10,[!1]),$(".l-bar-btnload span",i.toolbar).removeClass("l-disabled"),i.trigger("error",[e,t,r])}};o.contentType&&(n.contentType=o.contentType),"application/json"==o.contentType&&"string"!=typeof parms&&(n.data=function(e){if(!e)return"null";var t=e,r={};if($.isArray(t))for(var i=0;i<t.length;i++)r[t[i].name]=t[i].value;else r=t;return liger.toJSON(r)}(e)),$.ajax(n)},toggleLoading:function(e){this.gridloading[e?"show":"hide"]()},_createEditor:function(e,t,r,i,o){var l=e.create.call(this,t,r);return e.setValue&&e.setValue.call(this,l,r.value,r),r.column.editor&&r.column.editor.initSelect&&(l.element&&$(l.element).is(":text")&&$(l.element).select(),l instanceof jQuery&&(l.is(":text")?l.select():l.find(":text").select())),e.setText&&r.column.textField&&e.setText.call(this,l,r.text,r),e.resize&&e.resize.call(this,l,i,o,r),l},beginEdit:function(e,t){var r=this,i=this.options;if(i.enabledEdit){var o=r.getRow(e);if(!o._editing&&0!=r.trigger("beginEdit",{record:o,rowindex:o.__index})){r.editors[o.__id]={},o._editing=!0,r.reRender({rowdata:o}),t=t||function(e,t){var i=r.getCellObj(e,t),o=$(i).html("");return r.setCellEditing(e,t,!0),o};for(var l=0,a=r.columns.length;l<a;l++){var n=r.columns[l];if(n.name&&n.editor&&n.editor.type&&i.editors[n.editor.type]){var d=i.editors[n.editor.type],s={record:o,value:r._getValueByName(o,n.name),column:n,rowindex:o.__index,grid:r},g=t(o,n),u=g.width(),c=g.height(),h=r._createEditor(d,g,s,u,c);r.editors[o.__id][n.__id]={editor:d,input:h,editParm:s,container:g}}}r.trigger("afterBeginEdit",{record:o,rowindex:o.__index})}}},cancelEdit:function(e){var t=this;if(void 0==e)for(var r in t.editors)t.cancelEdit(r);else{var i=t.getRow(e);if(!t.editors[i.__id])return;if(0==t.trigger("beforeCancelEdit",{record:i,rowindex:i.__index}))return;for(var o in t.editors[i.__id]){var l=t.editors[i.__id][o];l.editor.destroy&&l.editor.destroy(l.input,l.editParm)}delete t.editors[i.__id],delete i._editing,t.reRender({rowdata:i})}},addEditRow:function(e,t){this.submitEdit(),e=this.add(e),this.beginEdit(e,t)},submitEdit:function(e){var t=this;this.options;if(void 0==e)for(var r in t.editors)t.submitEdit(r);else{var i=t.getRow(e),o={};if(!i||!t.editors[i.__id])return;for(var l in t.editors[i.__id]){var a=t.editors[i.__id][l],n=a.editParm.column;n.name&&(o[n.name]=a.editor.getValue(a.input,a.editParm)),n.textField&&a.editor.getText&&(o[n.textField]=a.editor.getText(a.input,a.editParm))}if(0==t.trigger("beforeSubmitEdit",{record:i,rowindex:i.__index,newdata:o}))return!1;t.updateRow(i,o),t.trigger("afterSubmitEdit",{record:i,rowindex:i.__index,newdata:o})}},_enabledEditByCell:function(e){var t=this,r=(this.options,t.getColumn(e));return!!r&&(r.editor&&r.editor.type)},endEditToNext:function(){function e(){return o.parent("tr").next(".l-grid-row").find("td:first")}var t=this,r=(this.options,t.editor),i=null,o=null;if(r){var l=r.editParm,a=l.column,n=($.inArray(a,t.columns),t.getCellObj(l.record,l.column));if(o=$(n),i=o.next(),i.length||(i=e()),i.length)for(;!t._enabledEditByCell(i.get(0));)o=i,i=i.next(),i.length||(i=e())}t.endEdit(),i&&i.length&&t._applyEditor(i.get(0))},endEdit:function(e){var t=this;this.options;if(t.editor.editing){var r=t.editor;t.trigger("sysEndEdit",[t.editor.editParm]),t.trigger("endEdit",[t.editor.editParm]),r.editor.destroy&&r.editor.destroy(r.input,r.editParm),t.editor.container.remove(),t.reRender({rowdata:t.editor.editParm.record,column:t.editor.editParm.column}),t.trigger("afterEdit",[t.editor.editParm]),t.editor={editing:!1}}else if(void 0!=e){var i=t.getRow(e);if(!t.editors[i.__id])return;if(0==t.submitEdit(e))return!1;for(var o in t.editors[i.__id]){var r=t.editors[i.__id][o];r.editor.destroy&&r.editor.destroy(r.input,r.editParm)}delete t.editors[i.__id],delete i._editing,t.trigger("afterEdit",{record:i,rowindex:i.__index})}else for(var l in t.editors)t.endEdit(l);t._fixHeight.ligerDefer(t,10)},setWidth:function(e){return this._setWidth(e)},setHeight:function(e){return this._setHeight(e)},enabledCheckbox:function(){return!!this.options.checkbox},enabledFrozen:function(){var e=this,t=this.options;if(!t.frozen)return!1;var r=e.columns||[];if(e.enabledDetail()&&t.frozenDetail||e.enabledCheckbox()&&t.frozenCheckbox||t.frozenRownumbers&&t.rownumbers)return!0;for(var i=0,o=r.length;i<o;i++)if(r[i].frozen)return!0;return this._setFrozen(!1),!1},enabledDetailEdit:function(){return!!this.enabledDetail()&&!!this.options.detailToEdit},enabledDetail:function(){return!(!this.options.detail||!this.options.detail.onShowDetail)},enabledGroup:function(){return!!this.options.groupColumnName},deleteSelectedRow:function(){if(this.selected){for(var e in this.selected){var t=this.selected[e];t.__id in this.records&&this._deleteData.ligerDefer(this,10,[t])}this.reRender.ligerDefer(this,20)}},removeRange:function(e){var t=this;this.options;$.each(e,function(){t._removeData(this)}),t.reRender()},remove:function(e){var t=this;this.options,t.getRow(e);t._removeData(e),t.reRender()},deleteRange:function(e){var t=this;this.options;$.each(e,function(){t._deleteData(this)}),t.reRender()},deleteRow:function(e){var t=this,r=(this.options,t.getRow(e));r&&(t._deleteData(r),t.reRender(),t.isDataChanged=!0)},_deleteData:function(e){var t=this,r=this.options,i=t.getRow(e);if(i[r.statusName]="delete",r.tree){var o=t.getChildren(i,!0);if(o)for(var l=0,a=o.length;l<a;l++)o[l][r.statusName]="delete"}t.deletedRows=t.deletedRows||[],t.deletedRows.push(i),t._removeSelected(i)},updateCell:function(e,t,r){var i,o,l,a=this,n=this.options;if("string"!=typeof e){if("number"==typeof e)i=a.columns[e],l=a.getRow(r),o=a.getCellObj(l,i);else if("object"==typeof e&&e.__id)i=e,l=a.getRow(r),o=a.getCellObj(l,i);else{o=e;var d=o.id.split("|"),s=d[d.length-1];i=a._columns[s];var g=$(o).parent();l=l||a.getRow(g[0])}null!=t&&i.name&&(a._setValueByName(l,i.name,t),"add"!=l[n.statusName]&&(l[n.statusName]="update"),a.isDataChanged=!0),a.reRender({rowdata:l,column:i})}else for(var u=0,c=a.columns.length;u<c;u++)a.columns[u].name==e&&a.updateCell(u,t,r)},addRows:function(e,t,r,i){var o=this;this.options;$(e).each(function(){o.addRow(this,t,r,i)})},_createRowid:function(){return"r"+(1e3+this.recordNumber)},_isRowId:function(e){return e in this.records},_addNewRecord:function(e,t,r){var i=this,o=this.options;if(i.recordNumber++,e.__id=i._createRowid(),e.__previd=t,t&&-1!=t){var l=i.records[t];if(l.__nextid&&-1!=l.__nextid){var a=i.records[l.__nextid];a&&(a.__previd=e.__id)}l.__nextid=e.__id,e.__index=l.__index+1}else e.__index=0;if(o.tree){if(r&&-1!=r){var n=i.records[r];e.__pid=r,e.__level=n.__level+1}else e.__pid=-1,e.__level=1;e.__hasChildren=!!e[o.tree.childrenName]}return e[o.statusName]=e[o.statusName]||"nochanged",i.rows[e.__index]=e,i.records[e.__id]=e,e},_getRows:function(e){function t(e){if(e&&e.length)for(var o=0,l=e.length;o<l;o++){var a=e[o];i.push(a),a[r.tree.childrenName]&&t(a[r.tree.childrenName])}}var r=this.options,i=[];return t(e),i},_updateGridData:function(){function e(o,l){if(o&&o.length)for(var a=0,n=o.length;a<n;a++){var d=o[a];t.formatRecord(d),"delete"!=d[r.statusName]&&(t._addNewRecord(d,i,l),i=d.__id,d.__hasChildren&&e(d[r.tree.childrenName],d.__id))}}var t=this,r=this.options;t.recordNumber=0,t.rows=[],t.records={};var i=-1;return e(t.currentData[r.root],-1),t.rows},_moveData:function(e,t,r){var i,o,l=this,a=(this.options,l.getRow(e)),n=l.getRow(t),d=l._getParentChildren(a);i=$.inArray(a,d),d.splice(i,1),d=l._getParentChildren(n),o=$.inArray(n,d),d.splice(o+(r?1:0),0,a)},move:function(e,t,r){this._moveData(e,t,r),this.reRender()},moveRange:function(e,t,r){for(var i in e)this._moveData(e[i],t,r);this.reRender()},up:function(e){var t=this,r=(this.options,t.getRow(e)),i=t._getParentChildren(r),o=$.inArray(r,i);if(-1!=o&&0!=o){var l=t.getSelected();t.move(r,i[o-1],!1),t.select(l)}},down:function(e){var t=this,r=(this.options,t.getRow(e)),i=t._getParentChildren(r),o=$.inArray(r,i);if(-1!=o&&o!=i.length-1){var l=t.getSelected();t.move(r,i[o+1],!0),t.select(l)}},addRow:function(e,t,r,i){var o=this,l=this.options;if(e=e||{},o._addData(e,i,t,r),o.reRender(),e[l.statusName]="add",l.tree){var a=o.getChildren(e,!0);if(a)for(var n=0,d=a.length;n<d;n++)a[n][l.statusName]="add"}return o.isDataChanged=!0,l.total=l.total?l.total+1:1,l.pageCount=Math.ceil(l.total/l.pageSize),o._buildPager(),o.trigger("SysGridHeightChanged"),o.trigger("afterAddRow",[e]),e},updateRow:function(e,t){var r=this,i=this.options,o=r.getRow(e);return r.isDataChanged=!0,$.extend(o,t||{}),"add"!=o[i.statusName]&&(o[i.statusName]="update"),r.reRender.ligerDefer(r,10,[{rowdata:o}]),o},setCellEditing:function(e,t,r){var i=this,o=(this.options,i.getCellObj(e,t)),l=r?"addClass":"removeClass";if($(o)[l]("l-grid-row-cell-editing"),0!=e.__id){var a=$(i.getRowObj(e.__id)).prev();if(!a.length||a.length<=0||null==a[0].id||""==a[0].id)return;var n=i.getRow(a[0]),d=i.getCellObj(n,t);if(!d)return;$(d)[l]("l-grid-row-cell-editing-topcell")}if(-1!=t.__previd&&null!=t.__previd){var d=$(i.getCellObj(e,t)).prev();$(d)[l]("l-grid-row-cell-editing-leftcell")}},reRender:function(e){function t(e){if(e.totalSummary)for(var t=0;t<r.totalNumber;t++){var o=document.getElementById(r.id+"|total"+t+"|"+e.__id);$("div:first",o).html(r._getTotalCellContent(e,r.groups&&r.groups[t]?r.groups[t]:r.currentData[i.root]))}}var r=this,i=this.options;e=e||{};var o=e.rowdata,l=e.column,a=e.totalOnly;if(!(l&&(l.isdetail||l.ischeckbox)||o&&"delete"==o[i.statusName]))if(a)$(r.columns).each(function(){t(this)});else if(o&&l){var n=r.getCellObj(o,l);$(n).html(r._getCellHtml(o,l)),l.issystem||r.setCellEditing(o,l,!1)}else if(o)$(r.columns).each(function(){r.reRender({rowdata:o,column:this})});else if(l){for(var d in r.records)r.reRender({rowdata:r.records[d],column:l});t(l)}else r._showData()},getData:function(e,t){var r=this,i=this.options,o=[];void 0==t&&(t=!0);for(var l in r.records){var a=$.extend(!0,{},r.records[l]);a[i.statusName]!=e&&void 0!=e||o.push(r.formatRecord(a,t))}return o},formatRecord:function(e,t){return delete e.__id,delete e.__previd,delete e.__nextid,delete e.__index,this.options.tree&&(delete e.__pid,delete e.__level,delete e.__hasChildren),t&&delete e[this.options.statusName],e},getUpdated:function(){return this.getData("update",!0)},getDeleted:function(){return this.deletedRows},getAdded:function(){return this.getData("add",!0)},getChanges:function(){var e=this,t=(this.options,[]);return this.deletedRows&&$(this.deletedRows).each(function(){var r=$.extend(!0,{},this);t.push(e.formatRecord(r,!1))}),$.merge(t,e.getData("update",!1)),$.merge(t,e.getData("add",!1)),t},getColumn:function(e){var t=this;this.options;if("string"==typeof e)return t._isColumnId(e)?t._columns[e]:t.columns[parseInt(e)];if("number"==typeof e)return t.columns[e];if("object"==typeof e&&1==e.nodeType){var r=e.id.split("|"),i=r[r.length-1];return t._columns[i]}return e},getColumnByName:function(e){var t=this;this.options;for(i=0;i<t.columns.length;i++)if(t.columns[i].name==e)return t.columns[i];return null},getColumnType:function(e){var t=this;this.options;for(i=0;i<t.columns.length;i++)if(t.columns[i].name==e)return t.columns[i].type?t.columns[i].type:"string";return null},isTotalSummary:function(){for(var e=this,t=(this.options,0);t<e.columns.length;t++)if(e.columns[t].totalSummary)return!0;return!1},getColumns:function(e){var t=this,r=(this.options,[]);for(var i in t._columns){var o=t._columns[i];void 0!=e?o.__level==e&&r.push(o):o.__leaf&&r.push(o)}return r},changeSort:function(e,t){var r=this,i=this.options;if(r.loading)return!0;if("local"==i.dataAction){var o=r.getColumnType(e);if(r.sortedData||(r.sortedData=r.filteredData),!r.sortedData||!r.sortedData[i.root])return;i.sortName==e?r.sortedData[i.root].reverse():r.sortedData[i.root].sort(function(t,i){return r._compareData(t,i,e,o)}),i.usePager?r.currentData=r._getCurrentPageData(r.sortedData):r.currentData=r.sortedData,r._showData()}i.sortName=e,i.sortOrder=t,"server"==i.dataAction&&r.loadData(i.where)},changePage:function(e){var t=this,r=this.options;if(t.loading)return!0;if("local"!=r.dataAction&&t.isDataChanged&&!confirm(r.isContinueByDataChanged))return!1;switch(r.pageCount=parseInt($(".pcontrol span",t.toolbar).html()),e){case"first":if(1==r.page)return;r.newPage=1;break;case"prev":if(1==r.page)return;r.page>1&&(r.newPage=parseInt(r.page)-1);break;case"next":if(r.page>=r.pageCount)return;r.newPage=parseInt(r.page)+1;break;case"last":if(r.page>=r.pageCount)return;r.newPage=r.pageCount;break;case"input":var i=parseInt($(".pcontrol input",t.toolbar).val());isNaN(i)&&(i=1),i<1?i=1:i>r.pageCount&&(i=r.pageCount),$(".pcontrol input",t.toolbar).val(i),r.newPage=i}if(r.newPage==r.page)return!1;if(1==r.newPage?($(".l-bar-btnfirst span",t.toolbar).addClass("l-disabled"),$(".l-bar-btnprev span",t.toolbar).addClass("l-disabled")):($(".l-bar-btnfirst span",t.toolbar).removeClass("l-disabled"),$(".l-bar-btnprev span",t.toolbar).removeClass("l-disabled")),r.newPage==r.pageCount?($(".l-bar-btnlast span",t.toolbar).addClass("l-disabled"),$(".l-bar-btnnext span",t.toolbar).addClass("l-disabled")):($(".l-bar-btnlast span",t.toolbar).removeClass("l-disabled"),$(".l-bar-btnnext span",t.toolbar).removeClass("l-disabled")),t.trigger("changePage",[r.newPage]),"server"==r.dataAction)r.parms||(r.parms=[]),$.isArray(r.parms)?r.parms.push({name:"changepage",value:"1",temp:!0}):r.parms.changepage="1",t.loadData(r.where);else{if(t.currentData=t._getCurrentPageData(t.filteredData),r.tree){var o=r.tree.childrenName;$(t.filteredData[r.root]).each(function(e,t){t[o]&&(t[o]=[])}),t._convertTreeData()}t._showData()}},getSelectedRow:function(){for(var e in this.selected){var t=this.selected[e];if(t.__id in this.records)return t}return null},getSelectedRows:function(){var e=[];for(var t in this.selected){var r=this.selected[t];r.__id in this.records&&e.push(r)}return e},getSelectedRowObj:function(){for(var e in this.selected){var t=this.selected[e];if(t.__id in this.records)return this.getRowObj(t)}return null},getSelectedRowObjs:function(){var e=[];for(var t in this.selected){var r=this.selected[t];r.__id in this.records&&e.push(this.getRowObj(r))}return e},getCellObj:function(e,t){var r=this.getRow(e);return t=this.getColumn(t),document.getElementById(this._getCellDomId(r,t))},getRowObj:function(e,t){var r=this;this.options;return null==e?null:"string"==typeof e?r._isRowId(e)?document.getElementById(r.id+(t?"|1|":"|2|")+e):document.getElementById(r.id+(t?"|1|":"|2|")+r.rows[parseInt(e)].__id):"number"==typeof e?document.getElementById(r.id+(t?"|1|":"|2|")+r.rows[e].__id):"object"==typeof e&&e.__id?r.getRowObj(e.__id,t):e},getRow:function(e){var t=this;this.options
;return null==e?null:"string"==typeof e?t._isRowId(e)?t.records[e]:t.rows[parseInt(e)]:"number"==typeof e?t.rows[parseInt(e)]:"object"!=typeof e||1!=e.nodeType||e.__id?e:t._getRowByDomId(e.id)},_setColumnVisible:function(e,t){var r=this;this.options;if(t){if(e._hide=!0,document.getElementById(e.__domid).style.display="none",-1!=e.__pid){for(var i=!0,o=this._columns[e.__pid],l=0;o&&l<o.columns.length;l++)if(!o.columns[l]._hide){i=!1;break}i&&(o._hide=!0,document.getElementById(o.__domid).style.display="none",this._setColumnVisible(o,t))}}else if(e._hide=!1,document.getElementById(e.__domid).style.display="",-1!=e.__pid){var o=r._columns[e.__pid];o._hide&&(document.getElementById(o.__domid).style.display="",this._setColumnVisible(o,t))}},toggleCol:function(e,t,r){var i,o=this;this.options;if("number"==typeof e)i=o.columns[e];else if("object"==typeof e&&e.__id)i=e;else if("string"==typeof e){if(!o._isColumnId(e))return void $(o.columns).each(function(){this.name==e&&o.toggleCol(this,t,r)});i=o._columns[e]}if(i){var l=i.__leafindex,a=document.getElementById(i.__domid);if(a){a=$(a);var n=[];for(var d in o.rows){var s=o.getCellObj(o.rows[d],i);s&&n.push(s)}for(var d=0;d<o.totalNumber;d++){var g=document.getElementById(o.id+"|total"+d+"|"+i.__id);g&&n.push(g)}var u=i._width;t&&i._hide?(i.frozen?o.f.gridtablewidth+=parseInt(u)+1:o.gridtablewidth+=parseInt(u)+1,o._setColumnVisible(i,!1),$(n).show()):t||i._hide||(i.frozen?o.f.gridtablewidth-=parseInt(u)+1:o.gridtablewidth-=parseInt(u)+1,o._setColumnVisible(i,!0),$(n).hide()),i.frozen?($("div:first",o.f.gridheader).width(o.f.gridtablewidth),$("div:first",o.f.gridbody).width(o.f.gridtablewidth)):($("div:first",o.gridheader).width(o.gridtablewidth+40),o.gridtablewidth?$("div:first",o.gridbody).width(o.gridtablewidth):$("div:first",o.gridbody).css("width","auto")),o._updateFrozenWidth(),r||$(":checkbox[columnindex="+l+"]",o.popup).each(function(){if(this.checked=t,$.fn.ligerCheckBox){var e=$(this).ligerGetCheckBoxManager();e&&e.updateStyle()}})}}},setColumnWidth:function(e,t){var r=this,i=this.options;if(t){t=parseInt(t,10);var o;if("number"==typeof e)o=r.columns[e];else if("object"==typeof e&&e.__id)o=e;else if("string"==typeof e){if(!r._isColumnId(e))return void $(r.columns).each(function(){this.name==e&&r.setColumnWidth(this,t)});o=r._columns[e]}if(o){var l=i.minColumnWidth;o.minWidth&&(l=o.minWidth),t=t<l?l:t;var a=t-o._width;if(0!=r.trigger("beforeChangeColumnWidth",[o,t])){o._width=t,o.frozen?(r.f.gridtablewidth+=a,$("div:first",r.f.gridheader).width(r.f.gridtablewidth),$("div:first",r.f.gridbody).width(r.f.gridtablewidth)):(r.gridtablewidth+=a,$("div:first",r.gridheader).width(r.gridtablewidth+40),$("div:first",r.gridbody).width(r.gridtablewidth)),$(document.getElementById(o.__domid)).css("width",t);var n=[];for(var d in r.records){var s=r.getCellObj(r.records[d],o);if(s&&n.push(s),!r.enabledDetailEdit()&&r.editors[d]&&r.editors[d][o.__id]){var g=r.editors[d][o.__id];g.editor.resize&&g.editor.resize(g.input,t,g.container.height(),g.editParm)}}for(var u=0;u<r.totalNumber;u++){var c=document.getElementById(r.id+"|total"+u+"|"+o.__id);c&&n.push(c)}$(n).css("width",t).find("> div.l-grid-row-cell-inner:first").css("width",t-8),r._updateFrozenWidth(),r._updateHorizontalScrollStatus.ligerDefer(r,10),r.trigger("afterChangeColumnWidth",[o,t])}}}},changeHeaderText:function(e,t){var r,i=this,o=this.options;if("number"==typeof e)r=i.columns[e];else if("object"==typeof e&&e.__id)r=e;else if("string"==typeof e){if(!i._isColumnId(e))return void $(i.columns).each(function(){this.name==e&&i.changeHeaderText(this,t)});r=i._columns[e]}if(r){var l=r.__leafindex,a=document.getElementById(r.__domid);$(".l-grid-hd-cell-text",a).html(t),o.allowHideColumn&&$(":checkbox[columnindex="+l+"]",i.popup).parent().next().html(t)}},changeCol:function(e,t,r){var i=this,o=this.options;if(e&&t){var l=i.getColumn(e),a=i.getColumn(t);l.frozen=a.frozen;var n,d,s=-1==l.__pid?o.columns:i._columns[l.__pid].columns,g=-1==a.__pid?o.columns:i._columns[a.__pid].columns;n=$.inArray(l,s),d=$.inArray(a,g);var u=s==g;l.__level,a.__level;g.splice(d+(r?1:0),0,l),u?r?s.splice(n,1):s.splice(n+1,1):s.splice(n,1),i._setColumns(o.columns),i.reRender()}},collapseDetail:function(e){var t=this,r=(this.options,t.getRow(e));if(r)for(var i=0,o=t.columns.length;i<o;i++)if(t.columns[i].isdetail){var l=t.getRowObj(r),a=t.getCellObj(r,t.columns[i]);return $(l).next("tr.l-grid-detailpanel").hide(),$(".l-grid-row-cell-detailbtn:first",a).removeClass("l-open"),void t.trigger("SysGridHeightChanged")}},extendDetail:function(e){var t=this,r=(this.options,t.getRow(e));if(r)for(var i=0,o=t.columns.length;i<o;i++)if(t.columns[i].isdetail){var l=t.getRowObj(r),a=t.getCellObj(r,t.columns[i]);return $(l).next("tr.l-grid-detailpanel").show(),$(".l-grid-row-cell-detailbtn:first",a).addClass("l-open"),void t.trigger("SysGridHeightChanged")}},getParent:function(e){var t=this;if(!this.options.tree)return null;var r=t.getRow(e);return r&&r.__pid in t.records?t.records[r.__pid]:null},getChildren:function(e,t){function r(e){if(e[o.tree.childrenName])for(var i=0,l=e[o.tree.childrenName].length;i<l;i++){var n=e[o.tree.childrenName][i];"delete"!=n[o.statusName]&&(a.push(n),t&&r(n))}}var i=this,o=this.options;if(!o.tree)return null;var l=i.getRow(e);if(!l)return null;var a=[];return r(l),a},isLeaf:function(e){var t=this,r=(this.options,t.getRow(e));if(r)return!r.__hasChildren},hasChildren:function(e){var t=this.options,r=this.getRow(e);if(r)return!(!r[t.tree.childrenName]||!r[t.tree.childrenName].length)},existRecord:function(e){for(var t in this.records)if(this.records[t]==e)return!0;return!1},_removeSelected:function(e){var t=this;if(this.options.tree){var r=t.getChildren(e,!0);if(r)for(var i=0,o=r.length;i<o;i++){var l=$.inArray(r[i],t.selected);-1!=l&&t.selected.splice(l,1)}}var a=$.inArray(e,t.selected);-1!=a&&t.selected.splice(a,1)},_getParentChildren:function(e){var t=this,r=this.options,i=t.getRow(e);return r.tree&&t.existRecord(i)&&i.__pid in t.records?t.records[i.__pid][r.tree.childrenName]:t.currentData[r.root]},_removeData:function(e){var t=this,r=(this.options,t._getParentChildren(e)),i=$.inArray(e,r);-1!=i&&r.splice(i,1),t._removeSelected(e)},_addData:function(e,t,r,i){var o=this,l=this.options;o.currentData||(o.currentData={}),o.currentData[l.root]||(o.currentData[l.root]=[]);var a=o.currentData[l.root];if(r){l.tree&&(t?a=t[l.tree.childrenName]:r.__pid in o.records&&(a=o.records[r.__pid][l.tree.childrenName]));var n=$.inArray(r,a);a.splice(-1==n?-1:n+(i?0:1),0,e)}else l.tree&&t&&(a=t[l.tree.childrenName]),a.push(e)},_appendData:function(e,t,r,i){var o=this;e[this.options.statusName]="update",o._removeData(e),o._addData(e,t,r,i)},appendRange:function(e,t,r,i){var o=this,l=(this.options,!1);$.each(e,function(e,a){a.__id&&o.existRecord(a)?(o.isLeaf(t)&&o.upgrade(t),o._appendData(a,t,r,i),l=!0):o.appendRow(a,t,r,i)}),l&&o.reRender()},appendRow:function(e,t,r,i){var o=this;this.options;return $.isArray(e)?void o.appendRange(e,t,r,i):e.__id&&o.existRecord(e)?(o._appendData(e,t,r,i),void o.reRender()):(t&&o.isLeaf(t)&&o.upgrade(t),void o.addRow(e,r,!!i,t))},upgrade:function(e){var t=this,r=this.options,i=t.getRow(e);if(i&&r.tree){i[r.tree.childrenName]=i[r.tree.childrenName]||[],i.__hasChildren=!0;var o=[t.getRowObj(i)];t.enabledFrozen()&&o.push(t.getRowObj(i,!0)),$("> td > div > .l-grid-tree-space:last",o).addClass("l-grid-tree-link l-grid-tree-link-open")}},demotion:function(e){var t=this,r=this.options,i=t.getRow(e);if(i&&r.tree){var o=[t.getRowObj(i)];if(t.enabledFrozen()&&o.push(t.getRowObj(i,!0)),$("> td > div > .l-grid-tree-space:last",o).removeClass("l-grid-tree-link l-grid-tree-link-open l-grid-tree-link-close"),t.hasChildren(i))for(var l=t.getChildren(i),a=0,n=l.length;a<n;a++)t.deleteRow(l[a]);i.__hasChildren=!1}},collapseAll:function(){var e=this;this.options;$(e.rows).each(function(t,r){var i=e.getRowObj(r);$(".l-grid-tree-link",i).hasClass("l-grid-tree-link-close")||e.toggle(r)})},expandAll:function(){var e=this;this.options;$(e.rows).each(function(t,r){var i=e.getRowObj(r);$(".l-grid-tree-link",i).hasClass("l-grid-tree-link-open")||e.toggle(r)})},collapse:function(e){var t=this,r=(this.options,t.getRowObj(e));$(".l-grid-tree-link",r).hasClass("l-grid-tree-link-close")||t.toggle(e)},expand:function(e){var t=this,r=(this.options,t.getRowObj(e));$(".l-grid-tree-link",r).hasClass("l-grid-tree-link-open")||t.toggle(e)},toggle:function(e){function t(e){for(var r=0,i=e.length;r<i;r++){var o=e[r],a=l.getChildren(o,!1),n=!(!a||!a.length),d=$([l.getRowObj(o.__id)]);l.enabledFrozen()&&(d=d.add(l.getRowObj(o.__id,!0))),n?$(".l-grid-tree-link",d).hasClass("l-grid-tree-link-close")?d.show():(d.show(),t(a)):($(".l-grid-tree-link",d).removeClass("l-grid-tree-link-close").addClass("l-grid-tree-link-open"),d.show())}}function r(){var e=[];if(!g)return e=l.getChildren(a,!0),$(e).each(function(){$(l.getRowObj(this)).hide(),l.enabledFrozen()&&$(l.getRowObj(this,!0)).hide()}),void l.trigger("treeCollapsed",[a]);e=l.getChildren(a,!1),t(e),l.trigger("treeExpanded",[a])}function i(){s.removeClass("l-grid-tree-link-close").addClass("l-grid-tree-link-open"),-1!=(d=$.inArray(a,l.collapsedRows))&&l.collapsedRows.splice(d,1)}function o(){s.addClass("l-grid-tree-link-close").removeClass("l-grid-tree-link-open"),-1==(d=$.inArray(a,l.collapsedRows))&&l.collapsedRows.push(a)}if(e){var l=this,a=(this.options,l.getRow(e)),n=[l.getRowObj(a)];l.enabledFrozen()&&n.push(l.getRowObj(a,!0));var d,s=(a.__level,$(".l-grid-tree-link:first",n)),g=!0;l.collapsedRows=l.collapsedRows||[];if(s.hasClass("l-grid-tree-link-close")){var u={update:function(){i(),r()}};if(l.hasBind("treeExpand")&&0==l.trigger("treeExpand",[a,u]))return!1;i()}else{var u={update:function(){o(),r()}};if(l.hasBind("treeCollapse")&&0==l.trigger("treeCollapse",[a,u]))return!1;g=!1,o()}r()}},_bulid:function(){var e=this;e._clearGrid(),e._initBuildHeader(),e._initHeight(),e._initFootbar(),e._buildPager(),e._setEvent()},_setColumns:function(e){var t=this;t._initColumns(),t._initBuildGridHeader(),t._initBuildPopup()},_initBuildHeader:function(){var e=this,t=this.options;t.title?($(".l-panel-header-text",e.header).html(t.title),t.headerImg&&e.header.append("<img src='"+t.headerImg+"' />").addClass("l-panel-header-hasicon")):e.header.hide(),t.toolbar?$.fn.ligerToolBar&&(e.toolbarManager=e.topbar.ligerToolBar(t.toolbar),0==e.topbar.height()?e.topbar.parent().height(25):e.topbar.parent().height(e.topbar.height())):e.topbar.parent().remove()},_createColumnId:function(e){return null!=e.id&&""!=e.id?e.id.toString():"c"+(100+this._columnCount)},_isColumnId:function(e){return e in this._columns},_initColumns:function(){function e(e,t){for(var r in t)t[r]in e&&delete e[t[r]]}function t(i,o,l,a){if(i.editorType&&(i.editor=i.editor||{},i.editor.type=i.editorType),e(i,["__id","__pid","__previd","__nextid","__domid","__leaf","__leafindex","__level","__colSpan","__rowSpan"]),o>r._columnMaxLevel&&(r._columnMaxLevel=o),r._columnCount++,i.__id=r._createColumnId(i),i.__domid=r.id+"|hcell|"+i.__id,r._columns[i.__id]=i,i.columns&&i.columns.length||(i.__leafindex=r._columnLeafCount++),i.__level=o,i.__pid=l,i.__previd=a,!i.columns||!i.columns.length)return i.__leaf=!0,1;for(var n=0,d=-1,s=0,g=i.columns.length;s<g;s++){var u=i.columns[s];n+=t(u,o+1,i.__id,d),d=u.__id}return i.__leafcount=n,n}var r=this,i=this.options;if(r._columns={},r._columnCount=0,r._columnLeafCount=0,r._columnMaxLevel=1,i.columns){var o=-1;if(i.rownumbers){var l=!r.enabledGroup()&&(i.frozen&&i.frozenRownumbers),a={isrownumber:!0,issystem:!0,width:i.rownumbersColWidth,frozen:l};t(a,1,-1,o),o=a.__id}if(r.enabledDetail()){var n=!r.enabledGroup()&&(i.frozen&&i.frozenDetail),a={isdetail:!0,issystem:!0,width:i.detailColWidth,frozen:n};t(a,1,-1,o),o=a.__id}if(r.enabledCheckbox()){var d=!r.enabledGroup()&&(i.frozen&&i.frozenCheckbox),a={ischeckbox:!0,issystem:!0,width:i.detailColWidth,frozen:d};t(a,1,-1,o),o=a.__id}for(var s=0,g=i.columns.length;s<g;s++){var a=i.columns[s];a&&(t(a,1,-1,o),o=a.__id)}for(var u in r._columns){var a=r._columns[u];a.__leafcount>1&&(a.__colSpan=a.__leafcount),a.__leaf&&a.__level!=r._columnMaxLevel&&(a.__rowSpan=r._columnMaxLevel-a.__level+1)}r.columns=r.getColumns(),$(r.columns).each(function(e,t){t.columnname=t.name,t.columnindex=e,t.type=t.type||"string",t.islast=e==r.columns.length-1,t.isSort=0!=t.isSort,t.frozen=!!t.frozen,t._width=r._getColumnWidth(t),t._hide=!!t.hide})}},_getColumnWidth:function(e){var t=this,r=this.options;if(e._width)return e._width;var i=e.width||r.columnWidth;if(!i||"auto"==i){var o=0,l=0;$(t.columns).each(function(e,i){var a=i.width||r.columnWidth;a&&"auto"!=a?l+=parseInt(t._getColumnWidth(i))+1:o++}),i=parseInt((t.grid.width()-l)/o)-1}if("string"==typeof i&&i.indexOf("%")>0){var a=0;t.enabledDetail()&&(a+=r.detailColWidth),t.enabledCheckbox()&&(a+=r.checkboxColWidth),t.options.rownumbers&&(a+=t.options.rownumbersColWidth),e._width=i=parseInt(.01*parseInt(i)*(t.grid.width()-a-t.columns.length/2-1))}return e.minWidth&&i<e.minWidth&&(i=e.minWidth),e.maxWidth&&i>e.maxWidth&&(i=e.maxWidth),i},_createHeaderCell:function(e){var t=this,r=this.options,i=$("<td class='l-grid-hd-cell'><div class='l-grid-hd-cell-inner'><span class='l-grid-hd-cell-text'></span></div></td>");if(i.attr("id",e.__domid),e.__leaf||i.addClass("l-grid-hd-cell-mul"),e.columnindex==t.columns.length-1&&i.addClass("l-grid-hd-cell-last"),e.isrownumber&&(i.addClass("l-grid-hd-cell-rownumbers"),i.html("<div class='l-grid-hd-cell-inner'></div>")),e.ischeckbox&&(i.addClass("l-grid-hd-cell-checkbox"),i.html("<div class='l-grid-hd-cell-inner'><div class='l-grid-hd-cell-text l-grid-hd-cell-btn-checkbox'></div></div>")),e.isdetail&&(i.addClass("l-grid-hd-cell-detail"),i.html("<div class='l-grid-hd-cell-inner'><div class='l-grid-hd-cell-text l-grid-hd-cell-btn-detail'></div></div>")),e.heightAlign&&$(".l-grid-hd-cell-inner:first",i).css("textAlign",e.heightAlign),e.__colSpan&&i.attr("colSpan",e.__colSpan),e.__rowSpan){i.attr("rowSpan",e.__rowSpan),i.height(r.headerRowHeight*e.__rowSpan);var o=(r.headerRowHeight*e.__rowSpan-r.headerRowHeight)/2-5;$(".l-grid-hd-cell-inner:first",i).css("paddingTop",o)}else i.height(r.headerRowHeight);e.__leaf&&(i.width(e._width),i.attr("columnindex",e.__leafindex));var l=i.height();!e.__rowSpan&&l>10&&$(">div:first",i).height(l),e._hide&&i.hide(),e.name&&i.attr({columnname:e.name});var a="";return a=e.display&&""!=e.display?e.display:e.headerRender?e.headerRender(e):"&nbsp;",$(".l-grid-hd-cell-text:first",i).html(a),!e.issystem&&e.__leaf&&!1!==e.resizable&&$.fn.ligerResizable&&r.allowAdjustColWidth&&(t.colResizable[e.__id]=i.ligerResizable({handles:"e",onStartResize:function(e,r){this.proxy.hide(),t.draggingline.css({height:t.body.height(),top:0,left:r.pageX-t.grid.offset().left+parseInt(t.body[0].scrollLeft)}).show()},onResize:function(e,r){t.colresizing=!0,t.draggingline.css({left:r.pageX-t.grid.offset().left+parseInt(t.body[0].scrollLeft)}),$("body").add(i).css("cursor","e-resize")},onStopResize:function(r){return t.colresizing=!1,$("body").add(i).css("cursor","default"),t.draggingline.hide(),t.setColumnWidth(e,parseInt(e._width)+r.diffX),!1}})),t.trigger("headerCellBulid",[i,e]),i},_initBuildGridHeader:function(){var e=this,t=this.options;if(e.gridtablewidth=0,e.f.gridtablewidth=0,e.colResizable){for(var r in e.colResizable)e.colResizable[r].destroy();e.colResizable=null}e.colResizable={},$("tbody:first",e.gridheader).html(""),$("tbody:first",e.f.gridheader).html("");for(var i=1;i<=e._columnMaxLevel;i++){var o=e.getColumns(i),l=i==e._columnMaxLevel,a=$("<tr class='l-grid-hd-row'></tr>"),n=$("<tr class='l-grid-hd-row'></tr>");l||a.add(n).addClass("l-grid-hd-mul"),$("tbody:first",e.gridheader).append(a),$("tbody:first",e.f.gridheader).append(n),$(o).each(function(t,r){if((r.frozen?n:a).append(e._createHeaderCell(r)),r.__leaf){var i=r._width;r.frozen?e.f.gridtablewidth+=(parseInt(i)?parseInt(i):0)+1:e.gridtablewidth+=(parseInt(i)?parseInt(i):0)+1}})}if(e._columnMaxLevel>0){var d=t.headerRowHeight*e._columnMaxLevel;e.gridheader.add(e.f.gridheader).height(d),t.rownumbers&&t.frozenRownumbers&&e.f.gridheader.find("td:first").height(d)}e._updateFrozenWidth(),$("div:first",e.gridheader).width(e.gridtablewidth+40)},_initBuildPopup:function(){var e=this,t=this.options;if($(":checkbox",e.popup).unbind(),$("tbody tr",e.popup).remove(),$(e.columns).each(function(t,r){if(!r.issystem&&0!=r.isAllowHide){var i='checked="checked"';r._hide&&(i="");var o=r.display;$("tbody",e.popup).append('<tr><td class="l-column-left"><input type="checkbox" '+i+' class="l-checkbox" columnindex="'+t+'"/></td><td class="l-column-right">'+o+"</td></tr>")}}),$.fn.ligerCheckBox&&$("input:checkbox",e.popup).ligerCheckBox({onBeforeClick:function(r){return!r.checked||!($("input:checked",e.popup).length<=t.minColToggle)}}),t.allowHideColumn){$("tr",e.popup).hover(function(){$(this).addClass("l-popup-row-over")},function(){$(this).removeClass("l-popup-row-over")});var r=function(){if($("input:checked",e.popup).length+1<=t.minColToggle)return!1;e.toggleCol(parseInt($(this).attr("columnindex")),this.checked,!0)};$.fn.ligerCheckBox?$(":checkbox",e.popup).bind("change",r):$(":checkbox",e.popup).bind("click",r)}},_initHeight:function(){var e=this,t=this.options;"auto"==t.height&&(e.gridbody.height("auto"),e.f.gridbody.height("auto")),t.width&&e.grid.width(t.width),e._onResize.call(e)},_initFootbar:function(){var e=this,t=this.options;if(t.usePager){if(t.pagerRender)return void e.toolbar.html(t.pagerRender.call(e));if(t.scrollToPage)return void e.toolbar.hide();var r="",i=-1;$(t.pageSizeOptions).each(function(e,o){t.pageSize==o&&(i=e),r+="<option value='"+o+"'  >"+o+"</option>"}),$(".l-bar-selectpagesize",e.toolbar).append("<select name='rp'>"+r+"</select>"),-1!=i&&($(".l-bar-selectpagesize select",e.toolbar)[0].selectedIndex=i),t.switchPageSizeApplyComboBox&&$.fn.ligerComboBox&&$(".l-bar-selectpagesize select",e.toolbar).ligerComboBox({onBeforeSelect:function(){return!(t.url&&e.isDataChanged&&!confirm(t.isContinueByDataChanged))},width:45})}else e.toolbar.hide()},_searchData:function(e,t){for(var r=(this.options,new Array),i=0;i<e.length;i++)t(e[i],i)&&(r[r.length]=e[i]);return r},_clearGrid:function(){var e=this;this.options;e._fixRows();for(var t in e.rows){var r=$(e.getRowObj(e.rows[t]));e.enabledFrozen()&&(r=r.add(e.getRowObj(e.rows[t],!0))),r.unbind()}e.gridbody.html(""),e.f.gridbody.html(""),e.recordNumber=0,e.records={},e.rows=[],e._fixRows(),e.selected=[],e.totalNumber=0,e.editorcounter=0},_fixRows:function(){var e=this;this.options;if(e.rows)for(var t in e.rows)$.isFunction(e.rows[t])&&delete e.rows[t]},_fillGridBody:function(e,t,r){var i=this,o=this.options,l="scrollappend"==r?[]:['<div class="l-grid-body-inner"><table class="l-grid-body-table" cellpadding=0 cellspacing=0><tbody>'];if(i.enabledGroup()){var a=[],n=[];i.groups=n;for(var d in e){var s=e[d],g=s[o.groupColumnName],u=$.inArray(g,a);-1==u&&(a.push(g),u=a.length-1,n.push([])),n[u].push(s)}$(n).each(function(e,r){1==n.length&&l.push('<tr class="l-grid-grouprow l-grid-grouprow-last l-grid-grouprow-first"'),e==n.length-1?l.push('<tr class="l-grid-grouprow l-grid-grouprow-last"'):0==e?l.push('<tr class="l-grid-grouprow l-grid-grouprow-first"'):l.push('<tr class="l-grid-grouprow"'),l.push(' groupindex"='+e+'" >'),l.push('<td colSpan="'+i.columns.length+'" class="l-grid-grouprow-cell">'),l.push('<span class="l-grid-group-togglebtn">&nbsp;&nbsp;&nbsp;&nbsp;</span>'),o.groupRender?l.push(o.groupRender(a[e],r,o.groupColumnDisplay)):l.push(o.groupColumnDisplay+":"+a[e]),l.push("</td>"),l.push("</tr>"),l.push(i._getHtmlFromData(r,t)),i.isTotalSummary()&&l.push(i._getTotalSummaryHtml(r,"l-grid-totalsummary-group",t))})}else l.push(i._getHtmlFromData(e,t));if("scrollappend"==!r&&l.push("</tbody></table></div>"),"scrollappend"==r?(t?i.f.gridbody:i.gridbody).find("tbody:first").append(l.join("")):(t?i.f.gridbody:i.gridbody).html(l.join("")),t&&(i.f.gridbody.find(">l-jplace").remove(),i.f.gridbody.append('<div class="l-jplace"></div>')),o.usePager&&o.scrollToPage&&!o.scrollToAppend){var c=t?i.f.gridbody.find("> .l-grid-body-inner"):i.gridbody.find("> .l-grid-body-inner"),h=c.find("> .l-scrollreplacetop");h=h.length?h:$('<div class="l-scrollreplacetop"></div>').prependTo(c),h.css("width","80%").height(i.lastScrollTop),h=c.find("> .l-scrollreplacebottom"),h=h.length?h:$('<div class="l-scrollreplacebottom"></div>').appendTo(c),h.css("width","80%").height((o.pageCount-o.newPage)*i._getOnePageHeight())}i.enabledGroup()||i._bulidTotalSummary(t),$("> div:first",i.gridbody).width(i.gridtablewidth),i._onResize()},_showData:function(e){var t=this,r=this.options;t.changedCells={};var i=t.currentData[r.root];if(r.usePager&&("server"==r.dataAction&&t.data&&t.data[r.record]?r.total=t.data[r.record]:t.filteredData&&t.filteredData[r.root]?r.total=t.filteredData[r.root].length:t.data&&t.data[r.root]?r.total=t.data[r.root].length:i&&(r.total=i.length),r.page=r.newPage,r.total||(r.total=0),r.page||(r.page=1),r.pageCount=Math.ceil(r.total/r.pageSize),r.pageCount||(r.pageCount=1),r.scrollToPage||t._buildPager()),$(".l-bar-btnloading:first",t.toolbar).removeClass("l-bar-btnloading"),0!=t.trigger("beforeShowData",[t.currentData])){if("scrollappend"!=e&&t._clearGrid(),t.isDataChanged=!1,!i||!i.length)return t.gridview.addClass("l-grid-empty"),$(t.element).addClass("l-empty"),$("<div></div>").addClass("l-grid-body-inner").appendTo(t.gridbody).css({width:t.gridheader.find(">div:first").width(),height:t.gridbody.height()}),r.pagerRender?void t.toolbar.html(r.pagerRender.call(t)):void t._onResize.ligerDefer(t,50);if(t.gridview.removeClass("l-grid-empty"),$(t.element).removeClass("l-empty"),$(".l-bar-btnload:first span",t.toolbar).removeClass("l-disabled"),t._updateGridData(),t.enabledFrozen()&&t._fillGridBody(t.rows,!0,e),t._fillGridBody(t.rows,!1,e),t.trigger("SysGridHeightChanged"),"scroll"==e&&t.trigger("sysScrollLoaded"),r.totalRender&&($(".l-panel-bar-total",t.element).remove(),$(".l-panel-bar",t.element).before('<div class="l-panel-bar-total">'+r.totalRender(t.data,t.filteredData)+"</div>")),r.mouseoverRowCssClass)for(var o in t.rows){var l=$(t.getRowObj(t.rows[o]));t.enabledFrozen()&&(l=l.add(t.getRowObj(t.rows[o],!0))),l.bind("mouseover.gridrow",function(){t._onRowOver(this,!0)}).bind("mouseout.gridrow",function(){t._onRowOver(this,!1)})}if(t._fixHeight(),r.pagerRender)return void t.toolbar.html(r.pagerRender.call(t));t.gridbody.trigger("scroll.grid"),t.trigger("afterShowData",[t.currentData])}},_fixHeight:function(){var e=this,t=this.options;if(!t.fixedCellHeight&&t.frozen){var r,i;for(var o in e.columns){var l=e.columns[o];if(r&&i)break;!l.frozen||r?l.frozen||i||(i=l):r=l}if(r&&i)for(var a in e.records){var n=e.getCellObj(a,r),d=e.getCellObj(a,i),s=Math.max($(n).height(),$(d).height());$(n).add(d).height(s)}}},_getRowDomId:function(e,t){return this.id+"|"+(t?"1":"2")+"|"+e.__id},_getCellDomId:function(e,t){return this._getRowDomId(e,t.frozen)+"|"+t.__id},_getHtmlFromData:function(e,t){if(!e)return"";for(var r=this,i=this.options,o=[],l=0,a=e.length;l<a;l++){var n=e[l],d=n.__id;if(n){if(o.push("<tr"),o.push(' id="'+r._getRowDomId(n,t)+'"'),o.push(' class="l-grid-row'),!t&&r.enabledCheckbox()&&i.isChecked&&i.isChecked(n)?(r.select(n),o.push(" l-selected")):r.isSelected(n)?o.push(" l-selected"):i.isSelected&&i.isSelected(n)&&(r.select(n),o.push(" l-selected")),n.__index%2==1&&i.alternatingRow&&o.push(" l-grid-row-alt"),i.rowClsRender){var s=i.rowClsRender(n,d);s&&o.push(" "+s)}if(o.push('" '),i.rowAttrRender&&o.push(i.rowAttrRender(n,d)),i.tree&&r.collapsedRows&&r.collapsedRows.length){var g=function(){for(var e=r.getParent(n);e;){if(-1!=$.inArray(e,r.collapsedRows))return!0;e=r.getParent(e)}return!1};g()&&o.push(' style="display:none;" ')}else if(i.tree&&i.tree.isExtend){var g=function(){for(var e=r.getParent(n);e;){if(0==i.tree.isExtend(e))return!0;e=r.getParent(e)}return!1};g()&&o.push(' style="display:none;" ')}o.push(">"),$(r.columns).each(function(e,l){if(t==l.frozen){if(o.push("<td"),o.push(' id="'+r._getCellDomId(n,this)+'"'),this.isrownumber)return o.push(' class="l-grid-row-cell l-grid-row-cell-rownumbers" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"'),i.fixedCellHeight?o.push(' style = "height:'+i.rowHeight+'px;" '):o.push(' style = "min-height:'+i.rowHeight+'px;" '),void o.push(">"+(parseInt(n.__index)+1)+"</div></td>");if(this.ischeckbox)return o.push(' class="l-grid-row-cell l-grid-row-cell-checkbox" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"'),i.fixedCellHeight?o.push(' style = "height:'+i.rowHeight+'px;" '):o.push(' style = "min-height:'+i.rowHeight+'px;" '),o.push(">"),o.push('<span class="l-grid-row-cell-btn-checkbox"></span>'),void o.push("</div></td>");if(this.isdetail)return o.push(' class="l-grid-row-cell l-grid-row-cell-detail" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"'),i.fixedCellHeight?o.push(' style = "height:'+i.rowHeight+'px;" '):o.push(' style = "min-height:'+i.rowHeight+'px;" '),o.push(">"),i.isShowDetailToggle&&!i.isShowDetailToggle(n)||o.push('<span class="l-grid-row-cell-detailbtn"></span>'),void o.push("</div></td>");var a=this._width;o.push(' class="l-grid-row-cell '),r.changedCells[d+"_"+this.__id]&&o.push("l-grid-row-cell-edited "),this.islast&&o.push("l-grid-row-cell-last "),o.push('"'),o.push(' style = "'),o.push("width:"+a+"px; "),l._hide&&o.push("display:none;"),o.push(' ">'),o.push(r._getCellHtml(n,l)),o.push("</td>")}}),o.push("</tr>")}}return o.join("")},_getCellHtml:function(e,t){var r=this,i=this.options;if(t.isrownumber)return'<div class="l-grid-row-cell-inner">'+(parseInt(e.__index)+1)+"</div>";var o=[];o.push('<div class="l-grid-row-cell-inner"'),o.push(' style = "width:'+parseInt(t._width-8)+"px;"),i.fixedCellHeight&&o.push("height:"+i.rowHeight+"px;"),o.push("min-height:"+i.rowHeight+"px; "),t.align&&o.push("text-align:"+t.align+";");var l=r._getCellContent(e,t);return o.push('">'+l+"</div>"),o.join("")},_setValueByName:function(e,t,r){if(!e||!t)return null;if(-1==t.indexOf("."))e[t]=r;else try{new Function("data,value","data."+t+"=value;")(e,r)}catch(e){}},_getValueByName:function(e,t){if(!e||!t)return null;if(-1==t.indexOf("."))return e[t];try{return new Function("data","return data."+t+";")(e)}catch(e){return null}},_getCellContent:function(e,t){var r=this,i=this.options;if(!e||!t)return"";if(t.isrownumber)return parseInt(e.__index)+1;var o=(e.__id,e.__index),l=r._getValueByName(e,t.name),a=r._getValueByName(e,t.textField),n="";return t.render?n=t.render.call(r,e,o,l,t):i.formatters[t.type]?n=i.formatters[t.type].call(r,l,t):null!=a?n=a.toString():null!=l&&(n=l.toString()),i.tree&&(null!=i.tree.columnName&&i.tree.columnName==t.name||null!=i.tree.columnId&&i.tree.columnId==t.id)&&(n=r._getTreeCellHtml(n,e)),n||""},_getTreeCellHtml:function(e,t){var r=t.__level,i=this,o=this.options,l=null==i.collapsedRows?o.tree.isExtend(t):-1==$.inArray(t,i.collapsedRows||[]),a=o.tree.isParent(t),n="";r=parseInt(r)||1;for(var d=1;d<r;d++)n+="<div class='l-grid-tree-space'></div>";return n+=l&&a?"<div class='l-grid-tree-space l-grid-tree-link l-grid-tree-link-open'></div>":a?"<div class='l-grid-tree-space l-grid-tree-link l-grid-tree-link-close'></div>":"<div class='l-grid-tree-space'></div>",n+="<span class='l-grid-tree-content'>"+e+"</span>"},_applyEditor:function(e){var t=this,r=this.options,i=e,o=i.id.split("|"),l=o[o.length-1],a=t._columns[l],n=$(i).parent(),d=t.getRow(n[0]),s=d.__id,g=d.__index;if(a&&a.editor){var u=a.name;a.columnindex;if(a.editor.type&&r.editors[a.editor.type]){var c=t._getValueByName(d,u),h={record:d,value:c,column:a,rowindex:g};if(a.textField&&(h.text=t._getValueByName(d,a.textField)),0==t.trigger("beforeEdit",[h]))return!1;t.lastEditRow=d,liger.lastEditGrid=t;var p=r.editors[a.editor.type],f=$(i),v=($(i).offset(),$(i).width()),m=$(i).height(),b=$("<div class='l-grid-editor'></div>").appendTo(t.grid),w=0,_=0,y=f.position(),C=t.gridbody.position(),D=t.gridview2.position(),x=(r.toolbar?t.topbar.parent().outerHeight():0)+(r.title?t.header.outerHeight():0),w=y.left+C.left+D.left,_=y.top+C.top+D.top+x;f.html(""),t.setCellEditing(d,a,!0);var R=!!(window.ActiveXObject||"ActiveXObject"in window),S=0==$.browser.version.indexOf("8");R?(m-=S?1:2,_-=1,w-=1):$.browser.mozilla?(m-=1,_-=1,w-=1):$.browser.safari?_-=1:m-=1,w+=r.editorLeftDiff||0,_+=r.editorTopDiff||0,m+=r.editorHeightDiff||0,b.css({left:w,top:_}).show(),a.textField&&(h.text=t._getValueByName(d,a.textField));var k=t._createEditor(p,b,h,v,m-1);t.editor={editing:!0,editor:p,input:k,editParm:h,container:b},t.unbind("sysEndEdit"),t.bind("sysEndEdit",function(){var e=p.getValue(k,h);a.textField&&p.getText&&(h.text=p.getText(k,h)),p.getSelected&&(h.selected=p.getSelected(k,h)),e!=c&&($(i).addClass("l-grid-row-cell-edited"),t.changedCells[s+"_"+a.__id]=!0,h.value=e),a.editor.onChange&&a.editor.onChange.call(k,h),t._checkEditAndUpdateCell(h)&&a.editor.onChanged&&a.editor.onChanged.call(k,h)})}}},_checkEditAndUpdateCell:function(e){var t=this;this.options;if(0==t.trigger("beforeSubmitEdit",[e]))return!1;var r=e.column;return e.text&&r.textField&&t._setValueByName(e.record,r.textField,e.text),t.updateCell(r,e.value,e.record),(r.render||t.enabledTotal())&&t.reRender({column:r}),t.reRender({rowdata:e.record}),!0},_getCurrentPageData:function(e){var t=this.options,r={};if(r[t.root]=[],!e||!e[t.root]||!e[t.root].length)return r[t.record]=0,r;for(r[t.record]=e[t.root].length,t.newPage||(t.newPage=1),i=(t.newPage-1)*t.pageSize;i<e[t.root].length&&i<t.newPage*t.pageSize;i++)r[t.root].push(e[t.root][i]);return r},_compareData:function(e,t,r,i){var o=this,l=this.options,a=e[r],n=t[r];return null==a&&null!=n?1:null==a&&null==n?0:null!=a&&null==n?-1:l.sorters[i]?l.sorters[i].call(o,a,n):a<n?-1:a>n?1:0},_getTotalInfo:function(e,t){var r=this.options;try{if(!e.totalSummary)return null;var i=0,o=0,l=0,a=0,n=0;if(t&&t.length){n=parseFloat(t[0][e.name]),a=parseFloat(t[0][e.name]);for(var d=0;d<t.length;d++)if("delete"!=t[d][r.statusName]){o+=1;var s=t[d][e.name];"string"==typeof s&&(s=s.replace(/\$|\,/g,"")),s=parseFloat(s),s&&(i+=s,s>n&&(n=s),s<a&&(a=s))}l=1*i/t.length}return{sum:i,count:o,avg:l,min:a,max:n}}catch(e){return{}}},_getTotalCellContent:function(e,t){var r=this,i=(this.options,[]);if(e.totalSummary){var o=function(e){for(var t=0;t<n.length;t++)if(n[t].toLowerCase()==e.toLowerCase())return!0;return!1},l=r._getTotalInfo(e,t);if(e.totalSummary.render){var a=e.totalSummary.render(l,e,r.data);i.push(a)}else if(e.totalSummary.type&&l){var n=e.totalSummary.type.split(",");o("sum")&&i.push("<div>Sum="+l.sum.toFixed(2)+"</div>"),o("tsum")&&i.push("<div>"+sum.toFixed(0)+"</div>"),o("count")&&i.push("<div>Count="+l.count+"</div>"),o("max")&&i.push("<div>Max="+l.max.toFixed(2)+"</div>"),o("min")&&i.push("<div>Min="+l.min.toFixed(2)+"</div>"),o("avg")&&i.push("<div>Avg="+l.avg.toFixed(2)+"</div>")}}return i.join("")},_getTotalSummaryHtml:function(e,t,r){var i=this,o=(this.options,[]);return t?o.push('<tr class="l-grid-totalsummary '+t+'">'):o.push('<tr class="l-grid-totalsummary">'),$(i.columns).each(function(t,l){if(this.frozen==r){if(this.isrownumber)return void o.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-rownumbers" style="width:'+this.width+'px"><div>&nbsp;</div></td>');if(this.ischeckbox)return void o.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-checkbox" style="width:'+this.width+'px"><div>&nbsp;</div></td>');if(this.isdetail)return void o.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-detail" style="width:'+this.width+'px"><div>&nbsp;</div></td>');o.push('<td class="l-grid-totalsummary-cell'),this.islast&&o.push(" l-grid-totalsummary-cell-last"),o.push('" '),o.push('id="'+i.id+"|total"+i.totalNumber+"|"+l.__id+'" '),o.push('width="'+this._width+'" '),columnname=this.columnname,
columnname&&o.push('columnname="'+columnname+'" '),o.push('columnindex="'+t+'" '),o.push('><div class="l-grid-totalsummary-cell-inner"'),l.align&&o.push(' style="text-Align:'+l.align+';"'),o.push(">"),o.push(i._getTotalCellContent(l,e)),o.push("</div></td>")}}),o.push("</tr>"),r||i.totalNumber++,o.join("")},_bulidTotalSummary:function(e){var t=this,r=this.options;if(!t.isTotalSummary())return!1;if(!t.currentData||0==t.currentData[r.root].length)return!1;var i=$(t._getTotalSummaryHtml(t.currentData[r.root],null,e));$("tbody:first",e?t.f.gridbody:t.gridbody).append(i),e?t.totalRow1=i:t.totalRow2=i},updateTotalSummary:function(){var e=this;this.options;e.reRender({totalOnly:!0})},_buildPager:function(){var e=this,t=this.options;if(!t.pagerRender){$(".pcontrol input",e.toolbar).val(t.page),t.pageCount||(t.pageCount=1),$(".pcontrol span",e.toolbar).html(t.pageCount);var r=parseInt((t.page-1)*t.pageSize)+1,i=parseInt(r)+parseInt(t.pageSize)-1;t.total||(t.total=0),t.total<i&&(i=t.total),t.total||(r=i=0),r<0&&(r=0),i<0&&(i=0);var o=t.pageStatMessage;o=o.replace(/{from}/,r),o=o.replace(/{to}/,i),o=o.replace(/{total}/,t.total),o=o.replace(/{pagesize}/,t.pageSize),$(".l-bar-text",e.toolbar).html(o),t.total||$(".l-bar-btnfirst span,.l-bar-btnprev span,.l-bar-btnnext span,.l-bar-btnlast span",e.toolbar).addClass("l-disabled"),t.hideLoadButton&&($(".l-bar-btnload:first",e.toolbar).parent().hide(),$(".l-bar-btnload:first",e.toolbar).parent().next().hide()),1==t.page?($(".l-bar-btnfirst span",e.toolbar).addClass("l-disabled"),$(".l-bar-btnprev span",e.toolbar).addClass("l-disabled")):t.page>t.pageCount&&t.pageCount>0&&($(".l-bar-btnfirst span",e.toolbar).removeClass("l-disabled"),$(".l-bar-btnprev span",e.toolbar).removeClass("l-disabled")),t.page==t.pageCount?($(".l-bar-btnlast span",e.toolbar).addClass("l-disabled"),$(".l-bar-btnnext span",e.toolbar).addClass("l-disabled")):t.page<t.pageCount&&t.pageCount>0&&($(".l-bar-btnlast span",e.toolbar).removeClass("l-disabled"),$(".l-bar-btnnext span",e.toolbar).removeClass("l-disabled"))}},_getRowIdByDomId:function(e){return e.split("|")[2]},_getRowByDomId:function(e){return this.records[this._getRowIdByDomId(e)]},_isEditing:function(e){var t=this;if(e.hasClass("l-box-dateeditor")||e.hasClass("l-box-select"))return!0;if(e.hasClass("l-dialog")){var r=[];if(e.find(".l-dialog").each(function(){var e=$(this).attr("ligeruiid");e&&r.push(e)}),t._editorIncludeCotrols(r))return!0}return!1},_getSrcElementByEvent:function(e){var t=this,r=e.target||e.srcElement,i=$(r).parents().add(r),o=function(e){for(var t=0,r=i.length;t<r;t++)if("string"==typeof e){if($(i[t]).hasClass(e))return i[t]}else if("object"==typeof e&&i[t]==e)return i[t];return null};if(o("l-grid-editor"))return{editing:!0,editor:o("l-grid-editor")};if(-1==i.index(this.element))return t._isEditing(i)?{editing:!0}:{out:!0};var l=!1;if(i.hasClass("l-grid-detailpanel")&&t.detailrows)for(var a=0,n=t.detailrows.length;a<n;a++)if(-1!=i.index(t.detailrows[a])){l=!0;break}var d={grid:o("l-panel"),indetail:l,frozen:!!o(t.gridview1[0]),header:o("l-panel-header"),gridheader:o("l-grid-header"),gridbody:o("l-grid-body"),total:o("l-panel-bar-total"),popup:o("l-grid-popup"),toolbar:o("l-panel-bar")};if(d.gridheader&&(d.hrow=o("l-grid-hd-row"),d.hcell=o("l-grid-hd-cell"),d.hcelltext=o("l-grid-hd-cell-text"),d.checkboxall=o("l-grid-hd-cell-checkbox"),d.hcell)){var s=d.hcell.id.split("|")[2];d.column=t._columns[s]}return d.gridbody&&(d.row=o("l-grid-row"),d.cell=o("l-grid-row-cell"),d.checkbox=o("l-grid-row-cell-btn-checkbox"),d.groupbtn=o("l-grid-group-togglebtn"),d.grouprow=o("l-grid-grouprow"),d.detailbtn=o("l-grid-row-cell-detailbtn"),d.detailrow=o("l-grid-detailpanel"),d.totalrow=o("l-grid-totalsummary"),d.totalcell=o("l-grid-totalsummary-cell"),d.rownumberscell=$(d.cell).hasClass("l-grid-row-cell-rownumbers")?d.cell:null,d.detailcell=$(d.cell).hasClass("l-grid-row-cell-detail")?d.cell:null,d.checkboxcell=$(d.cell).hasClass("l-grid-row-cell-checkbox")?d.cell:null,d.treelink=o("l-grid-tree-link"),d.editor=o("l-grid-editor"),d.row&&(d.data=this._getRowByDomId(d.row.id)),d.cell&&(d.editing=$(d.cell).hasClass("l-grid-row-cell-editing")),d.editor&&(d.editing=!0),d.editing&&(d.out=!1)),d.toolbar&&(d.first=o("l-bar-btnfirst"),d.last=o("l-bar-btnlast"),d.next=o("l-bar-btnnext"),d.prev=o("l-bar-btnprev"),d.load=o("l-bar-btnload"),d.button=o("l-bar-button")),d},_editorIncludeCotrols:function(e){var t=this;this.options;if(!e||!e.length)return!1;if(t.editor&&t.editor.input){if(t._controlIncludeCotrols(t.editor.input,e))return!0}else if(t.editors)for(var r in t.editors)if(t.editors[r])for(var i in t.editors[r]){var o=t.editors[r][i];if(o&&o.input&&t._controlIncludeCotrols(o.input,e))return!0}return!1},_controlIncludeCotrols:function(e,t){this.options;if(!e||!e.includeControls||!e.includeControls.length)return!1;for(var r=0;r<e.includeControls.length;r++){var i=e.includeControls[r];if(-1!=$.inArray(i.id,t))return!0}return!1},_getOnePageHeight:function(){var e=this.options;return(parseFloat(e.rowHeight||24)+1)*parseInt(e.pageSize)},_setEvent:function(){var e=this,t=this.options;e.grid.bind("mousedown.grid",function(t){e._onMouseDown.call(e,t)}),e.grid.bind("dblclick.grid",function(t){e._onDblClick.call(e,t)}),e.grid.bind("contextmenu.grid",function(t){return e._onContextmenu.call(e,t)}),$(document).bind("mouseup.grid",function(t){e._onMouseUp.call(e,t)}),$(document).bind("click.grid",function(t){e._onClick.call(e,t)}),$(window).bind("resize.grid",function(t){e._onResize.call(e)}),$(document).bind("keydown.grid",function(t){t.ctrlKey&&(e.ctrlKey=!0)}),$(document).bind("keyup.grid",function(t){delete e.ctrlKey}),e.gridbody.bind("scroll.grid",function(){var r=e.gridbody.scrollLeft(),i=e.gridbody.scrollTop();if(null!=r&&(e.gridheader[0].scrollLeft=r),null!=i&&(e.f.gridbody[0].scrollTop=i),t.scrollToPage&&t.usePager&&!e.loading){var o=e.gridbody.find(".l-grid-body-inner:first").height(),l=i+e.gridbody.height();if(t.scrollToAppend)t.newPage!=t.pageCount&&l>=o&&e.reload(t.newPage+1,"scrollappend");else{var a=l>=o?t.pageCount:Math.ceil(l/e._getOnePageHeight());e.scrollLoading||(e.scrollLoading=!0,e.lastScrollTop=i,e.unbind("sysScrollLoaded"),e.bind("sysScrollLoaded",function(){e.gridbody.scrollTop(i),setTimeout(function(){e.scrollLoading=!1},500)}),e.scrollLoading=!0,e.reload(a,"scroll"))}}e.trigger("SysGridHeightChanged")}),$("select",e.toolbar).change(function(){if(e.isDataChanged&&"local"!=t.dataAction&&!confirm(t.isContinueByDataChanged))return!1;t.newPage=1,t.pageSize=this.value,e.loadData("local"!=t.dataAction&&t.where)}),$("span.pcontrol :text",e.toolbar).blur(function(t){e.changePage("input")}),$("div.l-bar-button",e.toolbar).hover(function(){$(this).addClass("l-bar-button-over")},function(){$(this).removeClass("l-bar-button-over")}),$.fn.ligerDrag&&t.colDraggable&&(e.colDroptip=$("<div class='l-drag-coldroptip' style='display:none'><div class='l-drop-move-up'></div><div class='l-drop-move-down'></div></div>").appendTo("body"),e.gridheader.add(e.f.gridheader).ligerDrag({revert:!0,animate:!1,proxyX:0,proxyY:0,proxy:function(t,r){var i=e._getSrcElementByEvent(r);if(i.hcell&&i.column){var o=$(".l-grid-hd-cell-text:first",i.hcell).html(),l=$("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div></div>").appendTo("body");return l.append(o),l}},onRevert:function(){return!1},onRendered:function(){this.set("cursor","default"),e.children[this.id]=this},onStartDrag:function(t,r){if(2==r.button)return!1;if(e.colresizing)return!1;this.set("cursor","default");var i=e._getSrcElementByEvent(r);if(!i.hcell||!i.column||i.column.issystem||i.hcelltext)return!1;if(-1!=$(i.hcell).css("cursor").indexOf("resize"))return!1;this.draggingColumn=i.column,e.coldragging=!0;var o=e.grid.offset();this.validRange={top:o.top,bottom:o.top+e.gridheader.height(),left:o.left-10,right:o.left+e.grid.width()+10}},onDrag:function(r,i){this.set("cursor","default");var o=this.draggingColumn;if(!o)return!1;if(e.colresizing)return!1;null==e.colDropIn&&(e.colDropIn=-1);var l=i.pageX,a=i.pageY,n=!1,d=(e.grid.offset(),this.validRange);if(l<d.left||l>d.right||a>d.bottom||a<d.top)return e.colDropIn=-1,e.colDroptip.hide(),void this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes").addClass("l-drop-no");for(var s in e._columns){var g=e._columns[s];if(o!=g){if(!g.issystem){var u=g.__level==o.__level,c=!!u&&!!n;if(o.frozen!=g.frozen&&(c=!g.frozen),-1==e.colDropIn||e.colDropIn==s){var h=document.getElementById(g.__domid),p=$(h).offset(),f={top:p.top,bottom:p.top+$(h).height(),left:p.left-10,right:p.left+10};if(c){var v=$(h).width();f.left+=v,f.right+=v}if(l>f.left&&l<f.right&&a>f.top&&a<f.bottom){var m=t.headerRowHeight;g.__rowSpan&&(m*=g.__rowSpan),e.colDroptip.css({left:f.left+5,top:f.top-9,height:m+18}).show(),e.colDropIn=s,e.colDropDir=c?"right":"left",this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no").addClass("l-drop-yes");break}-1!=e.colDropIn&&(e.colDropIn=-1,e.colDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes").addClass("l-drop-no"))}}}else n=!0}},onStopDrag:function(t,r){var i=this.draggingColumn;e.coldragging=!1,-1!=e.colDropIn&&(e.changeCol.ligerDefer(e,0,[i,e.colDropIn,"right"==e.colDropDir]),e.colDropIn=-1),e.colDroptip.hide(),this.set("cursor","default")}})),$.fn.ligerDrag&&t.rowDraggable&&(e.rowDroptip=$("<div class='l-drag-rowdroptip' style='display:none'></div>").appendTo("body"),e.gridbody.add(e.f.gridbody).ligerDrag({revert:!0,animate:!1,proxyX:0,proxyY:0,proxy:function(r,i){if(e._getSrcElementByEvent(i).row){var o=t.draggingMessage.replace(/{count}/,r.draggingRows?r.draggingRows.length:1);return t.rowDraggingRender&&(o=t.rowDraggingRender(r.draggingRows,r,e)),$("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div>"+o+"</div>").appendTo("body")}},onRevert:function(){return!1},onRendered:function(){this.set("cursor","default"),e.children[this.id]=this},onStartDrag:function(t,r){if(2==r.button)return!1;if(e.colresizing)return!1;if(!e.columns.length)return!1;this.set("cursor","default");var i=e._getSrcElementByEvent(r);if(!i.cell||!i.data||i.checkbox)return!1;var o=i.cell.id.split("|"),l=e._columns[o[o.length-1]];if(!(i.rownumberscell||i.detailcell||i.checkboxcell||l==e.columns[0]))return!1;if(e.enabledCheckbox()){if(this.draggingRows=e.getSelecteds(),!this.draggingRows||!this.draggingRows.length)return!1}else this.draggingRows=[i.data];this.draggingRow=i.data,this.set("cursor","move"),e.rowdragging=!0,this.validRange={top:e.gridbody.offset().top,bottom:e.gridbody.offset().top+e.gridbody.height(),left:e.grid.offset().left-10,right:e.grid.offset().left+e.grid.width()+10}},onDrag:function(r,i){var o=this.draggingRow;if(!o)return!1;var l=this.draggingRows?this.draggingRows:[o];if(e.colresizing)return!1;null==e.rowDropIn&&(e.rowDropIn=-1);var a=i.pageX,n=i.pageY,d=!1,s=this.validRange;if(a<s.left||a>s.right||n>s.bottom||n<s.top)return e.rowDropIn=-1,e.rowDroptip.hide(),void this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes l-drop-add").addClass("l-drop-no");for(var g in e.rows){var u=e.rows[g],c=u.__id;if(o==u&&(d=!0),-1==$.inArray(u,l)){var h=!!d;if(-1==e.rowDropIn||e.rowDropIn==c){var p=e.getRowObj(c),f=$(p).offset(),v={top:f.top-4,bottom:f.top+$(p).height()+4,left:e.grid.offset().left,right:e.grid.offset().left+e.grid.width()};if(a>v.left&&a<v.right&&n>v.top&&n<v.bottom){var m=f.top;h&&(m+=$(p).height()),e.rowDroptip.css({left:v.left,top:m,width:v.right-v.left}).show(),e.rowDropIn=c,e.rowDropDir=h?"bottom":"top",t.tree&&n>v.top+5&&n<v.bottom-5?(this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-yes").addClass("l-drop-add"),e.rowDroptip.hide(),e.rowDropInParent=!0):(this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-add").addClass("l-drop-yes"),e.rowDroptip.show(),e.rowDropInParent=!1);break}-1!=e.rowDropIn&&(e.rowDropIn=-1,e.rowDropInParent=!1,e.rowDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes  l-drop-add").addClass("l-drop-no"))}}}},onStopDrag:function(r,i){var o=this.draggingRows;e.rowdragging=!1;for(var l=0;l<o.length;l++){var a=o[l].children;a&&(o=$.grep(o,function(e,t){return-1==$.inArray(e,a)}))}if(-1!=e.rowDropIn){if(t.tree){var n,d;e.rowDropInParent?d=e.getRow(e.rowDropIn):(n=e.getRow(e.rowDropIn),d=e.getParent(n)),e.appendRange(o,d,n,"bottom"!=e.rowDropDir),e.trigger("rowDragDrop",{rows:o,parent:d,near:n,after:"bottom"==e.rowDropDir})}else e.moveRange(o,e.rowDropIn,"bottom"==e.rowDropDir),e.trigger("rowDragDrop",{rows:o,parent:d,near:e.getRow(e.rowDropIn),after:"bottom"==e.rowDropDir});e.rowDropIn=-1}e.rowDroptip.hide(),this.set("cursor","default")}}))},_onRowOver:function(e,t){if(!l.draggable.dragging){var r=this,i=this.options,o=r.getRow(e),a=t?"addClass":"removeClass";t&&r.editor.editing&&$("tr."+i.mouseoverRowCssClass,r.gridview).removeClass(i.mouseoverRowCssClass),r.enabledFrozen()&&$(r.getRowObj(o,!0))[a](i.mouseoverRowCssClass),$(r.getRowObj(o,!1))[a](i.mouseoverRowCssClass)}},_onMouseUp:function(e){var t=this;this.options;if(l.draggable.dragging){var r=t._getSrcElementByEvent(e);r.hcell&&r.column?t.trigger("dragdrop",[{type:"header",column:r.column,cell:r.hcell},e]):r.row&&t.trigger("dragdrop",[{type:"row",record:r.data,row:r.row},e])}},_onMouseDown:function(e){this.options},_onContextmenu:function(e){var t=this,r=this.options,i=t._getSrcElementByEvent(e);if(i.row){if(r.whenRClickToSelect&&t.select(i.data),t.hasBind("contextmenu"))return t.trigger("contextmenu",[{data:i.data,rowindex:i.data.__index,row:i.row},e])}else if(i.hcell){if(!r.allowHideColumn)return!0;var o=$(i.hcell).attr("columnindex");if(void 0==o)return!0;var l=e.pageX-t.body.offset().left+parseInt(t.body[0].scrollLeft);return o==t.columns.length-1&&(l-=50),t.popup.css({left:l,top:t.gridheader.height()+1}),t.popup.toggle(),!1}},_onDblClick:function(e){var t=this,r=(this.options,t._getSrcElementByEvent(e));r.row&&t.trigger("dblClickRow",[r.data,r.data.__id,r.row])},_onClick:function(e){var t=e.target||e.srcElement,r=this,i=this.options,o=r._getSrcElementByEvent(e);if(o.out)return r.editor.editing&&!$.ligerui.win.masking&&r.endEdit(),void(i.allowHideColumn&&r.popup.hide());if(!o.indetail&&!o.editing)if(r.editor.editing&&r.endEdit(),i.allowHideColumn&&(o.popup||r.popup.hide()),o.checkboxall){var l=$(o.hrow),a=l.hasClass("l-checked");if(0==r.trigger("beforeCheckAllRow",[!a,r.element]))return!1;a?l.removeClass("l-checked"):l.addClass("l-checked"),r.selected=[];for(var n in r.records)a?r.unselect(r.records[n]):r.select(r.records[n]);r.trigger("checkAllRow",[!a,r.element])}else if(o.hcelltext){var d=$(o.hcelltext).parent().parent();if(!i.enabledSort||!o.column)return;if(0==o.column.isSort)return;if(i.url&&"local"!=i.dataAction&&r.isDataChanged&&!confirm(i.isContinueByDataChanged))return;var s=$(".l-grid-hd-cell-sort:first",d),g=o.column.name;if(!g)return;s.length>0?s.hasClass("l-grid-hd-cell-sort-asc")?(s.removeClass("l-grid-hd-cell-sort-asc").addClass("l-grid-hd-cell-sort-desc"),d.removeClass("l-grid-hd-cell-asc").addClass("l-grid-hd-cell-desc"),r.trigger("ChangeSort",[g,"desc"]),r.changeSort(g,"desc")):s.hasClass("l-grid-hd-cell-sort-desc")&&(s.removeClass("l-grid-hd-cell-sort-desc").addClass("l-grid-hd-cell-sort-asc"),d.removeClass("l-grid-hd-cell-desc").addClass("l-grid-hd-cell-asc"),r.trigger("ChangeSort",[g,"asc"]),r.changeSort(g,"asc")):(d.removeClass("l-grid-hd-cell-desc").addClass("l-grid-hd-cell-asc"),$(o.hcelltext).after("<span class='l-grid-hd-cell-sort l-grid-hd-cell-sort-asc'>&nbsp;&nbsp;</span>"),r.trigger("ChangeSort",[g,"asc"]),r.changeSort(g,"asc")),$(".l-grid-hd-cell-sort",r.gridheader).add($(".l-grid-hd-cell-sort",r.f.gridheader)).not($(".l-grid-hd-cell-sort:first",d)).remove()}else if(o.detailbtn&&i.detail){var u=o.data,l=$([r.getRowObj(u,!1)]);r.enabledFrozen()&&(l=l.add(r.getRowObj(u,!0)));var n=u.__id;if($(o.detailbtn).hasClass("l-open"))i.detail.onCollapse&&i.detail.onCollapse(u,$(".l-grid-detailpanel-inner:first",c)[0]),l.next("tr.l-grid-detailpanel").hide(),$(o.detailbtn).removeClass("l-open");else{var c=l.next("tr.l-grid-detailpanel");if(c.length>0)return c.show(),i.detail.onExtend&&i.detail.onExtend(u,$(".l-grid-detailpanel-inner:first",c)[0]),$(o.detailbtn).addClass("l-open"),void r.trigger("SysGridHeightChanged");$(o.detailbtn).addClass("l-open");for(var h=0,p=0;p<r.columns.length;p++)r.columns[p].frozen&&h++;var f=$("<tr class='l-grid-detailpanel'><td><div class='l-grid-detailpanel-inner' style='display:none'></div></td></tr>"),v=$("<tr class='l-grid-detailpanel'><td><div class='l-grid-detailpanel-inner' style='display:none'></div></td></tr>");f.find("div:first").width(r.gridheader.find("div:first").width()-50),f.attr("id",r.id+"|detail|"+n),r.detailrows=r.detailrows||[],r.detailrows.push(f[0]),r.detailrows.push(v[0]);var m=$("div:first",f);m.parent().attr("colSpan",r.columns.length-h),l.eq(0).after(f),h>0&&(v.find("td:first").attr("colSpan",h),l.eq(1).after(v)),i.detail.onShowDetail?(i.detail.onShowDetail(u,m[0],function(){r.trigger("SysGridHeightChanged")}),$("div:first",v).add(m).show().height(i.detail.height||i.detailHeight)):i.detail.render&&(m.append(i.detail.render()),m.show()),r.trigger("SysGridHeightChanged")}}else if(o.groupbtn){var b=$(o.grouprow),w=!0;$(o.groupbtn).hasClass("l-grid-group-togglebtn-close")?($(o.groupbtn).removeClass("l-grid-group-togglebtn-close"),b.hasClass("l-grid-grouprow-last")&&$("td:first",b).width("auto")):(w=!1,$(o.groupbtn).addClass("l-grid-group-togglebtn-close"),b.hasClass("l-grid-grouprow-last")&&$("td:first",b).width(r.gridtablewidth));for(var _=b.next(".l-grid-row,.l-grid-totalsummary-group,.l-grid-detailpanel");;){if(0==_.length)break;w?(_.show(),_.hasClass("l-grid-detailpanel")&&!_.prev().find("td.l-grid-row-cell-detail:first span.l-grid-row-cell-detailbtn:first").hasClass("l-open")&&_.hide()):_.hide(),_=_.next(".l-grid-row,.l-grid-totalsummary-group,.l-grid-detailpanel")}r.trigger(w?"groupExtend":"groupCollapse"),r.trigger("SysGridHeightChanged")}else if(o.treelink)r.toggle(o.data);else if(o.row&&r.enabledCheckbox()){var y=!!i.selectRowButtonOnly;if(i.enabledEdit&&(y=!0),"a"==t.tagName.toLowerCase())return;if((o.checkbox||!y)&&0!=i.selectable){var l=$(o.row),a=l.hasClass("l-selected");if(0==r.trigger("beforeCheckRow",[!a,o.data,o.data.__id,o.row]))return!1;var C=a?"unselect":"select";if(r[C](o.data),i.tree&&i.autoCheckChildren)for(var D=r.getChildren(o.data,!0),p=0,x=D.length;p<x;p++)r[C](D[p]);r.trigger("checkRow",[!a,o.data,o.data.__id,o.row])}!o.checkbox&&o.cell&&i.enabledEdit&&i.clickToEdit&&r._applyEditor(o.cell)}else if(o.row&&!r.enabledCheckbox()&&0!=i.selectable)if(o.cell&&i.enabledEdit&&i.clickToEdit&&r._applyEditor(o.cell),$(o.row).hasClass("l-selected")){if(!i.allowUnSelectRow)return void $(o.row).addClass("l-selected-again");r.unselect(o.data)}else r.select(o.data);else if(o.toolbar)if(o.first){if(0==r.trigger("toFirst",[r.element]))return!1;r.changePage("first")}else if(o.prev){if(0==r.trigger("toPrev",[r.element]))return!1;r.changePage("prev")}else if(o.next){if(0==r.trigger("toNext",[r.element]))return!1;r.changePage("next")}else if(o.last){if(0==r.trigger("toLast",[r.element]))return!1;r.changePage("last")}else if(o.load){if($("span",o.load).hasClass("l-disabled"))return!1;if(0==r.trigger("reload",[r.element]))return!1;if(i.url&&r.isDataChanged&&!confirm(i.isContinueByDataChanged))return!1;r.loadData(i.where)}},select:function(e){var t=this,r=this.options,i=t.getRow(e),o=i.__id,l=t.getRowObj(o);if(r.rowSelectable&&0!=t.trigger("beforeSelectRow",[i,o,l])){var a=t.getRowObj(o,!0);if(!t.enabledCheckbox()&&!t.ctrlKey||r.isSingleCheck){for(var n in t.selected){var d=t.selected[n];d.__id in t.records&&($(t.getRowObj(d)).removeClass("l-selected l-selected-again"),t.enabledFrozen()&&$(t.getRowObj(d,!0)).removeClass("l-selected l-selected-again"))}t.selected=[]}l&&$(l).addClass("l-selected"),a&&$(a).addClass("l-selected"),t.selected[t.selected.length]=i,t.trigger("selectRow",[i,o,l])}},unselect:function(e){var t=this,r=(this.options,t.getRow(e)),i=r.__id,o=t.getRowObj(i),l=t.getRowObj(i,!0);$(o).removeClass("l-selected l-selected-again"),t.enabledFrozen()&&$(l).removeClass("l-selected l-selected-again"),t._removeSelected(r),t.trigger("unSelectRow",[r,i,o])},isSelected:function(e){var t=this,r=(this.options,t.getRow(e));for(var i in t.selected)if(t.selected[i]==r)return!0;return!1},arrayToTree:function(e,t,r){function i(e){return"string"==typeof e&&(e=e.replace(/[.]/g,"").toLowerCase()),e}var o=this.options,l="children";if(o.tree&&(l=o.tree.childrenName),!e||!e.length)return[];for(var a=[],n={},d=e.length,s=0;s<d;s++){var g=e[s],u=i(g[t]);n[u]=g}for(var s=0;s<d;s++){var c=e[s],u=i(c[r]),h=n[u];h?(h[l]=h[l]||[],h[l].push(c)):a.push(c)}return a},_onResize:function(){var e=this,t=this.options;if(t.height&&"auto"!=t.height){var r=$(window).height(),i=0,o=null;if("string"==typeof t.height&&t.height.indexOf("%")>0){var l=e.grid.parent();t.inWindow?(o=r,o-=parseInt($("body").css("paddingTop")),o-=parseInt($("body").css("paddingBottom"))):o=l.height(),i=o*parseInt(t.height)*.01,(t.inWindow||"body"==l[0].tagName.toLowerCase())&&(i-=e.grid.offset().top-parseInt($("body").css("paddingTop")))}else i=parseInt(t.height);i+=t.heightDiff,e.windowHeight=r,e._setHeight(i)}else e._updateHorizontalScrollStatus.ligerDefer(e,10);if(e.enabledFrozen()){var a=e.gridview1.width(),n=e.gridview.width();n-a<=0?e.gridview2.css({width:"auto"}):e.gridview2.css({width:n-a})}e.trigger("SysGridHeightChanged")},showFilter:function(){function e(){var e=l.getData();"server"==i.options.dataType?t(e):r(e)}function t(e){e&&e.rules&&e.rules.length?i.setParm("where",JSON.stringify(e)):i.removeParm("where"),i.loadData()}function r(e){i.loadData($.ligerFilter.getFilterFunction(e))}var i=this;this.options;if(i.winfilter)return void i.winfilter.show();var o=$('<div id="'+i.id+'_filtercontainer"></div>').width(380).height(120).hide(),l=o.ligerFilter({fields:function(){var e=[];return $(i.columns).each(function(){var t={name:this.name,display:this.display},r="int"==this.type||"number"==this.type||"float"==this.type,i="date"==this.type;r&&(t.type="number"),i&&(t.type="date"),this.editor&&(t.editor=this.editor),e.push(t)}),e}()});return l.addRule($(l.element.firstChild)),i.winfilter=$.ligerDialog.open({width:420,height:208,target:o,isResize:!0,top:50,buttons:[{text:"确定",onclick:function(t,r){e(),r.hide()}},{text:"取消",onclick:function(e,t){t.hide()}}]})}}),$.ligerui.controls.Grid.prototype.enabledTotal=$.ligerui.controls.Grid.prototype.isTotalSummary,$.ligerui.controls.Grid.prototype.add=$.ligerui.controls.Grid.prototype.addRow,$.ligerui.controls.Grid.prototype.update=$.ligerui.controls.Grid.prototype.updateRow,$.ligerui.controls.Grid.prototype.append=$.ligerui.controls.Grid.prototype.appendRow,$.ligerui.controls.Grid.prototype.getSelected=$.ligerui.controls.Grid.prototype.getSelectedRow,$.ligerui.controls.Grid.prototype.getSelecteds=$.ligerui.controls.Grid.prototype.getSelectedRows,$.ligerui.controls.Grid.prototype.getCheckedRows=$.ligerui.controls.Grid.prototype.getSelectedRows,$.ligerui.controls.Grid.prototype.getCheckedRowObjs=$.ligerui.controls.Grid.prototype.getSelectedRowObjs,$.ligerui.controls.Grid.prototype.setOptions=$.ligerui.controls.Grid.prototype.set,$.ligerui.controls.Grid.prototype.reload=$.ligerui.controls.Grid.prototype.loadData,$.ligerui.controls.Grid.prototype.refreshSize=$.ligerui.controls.Grid.prototype._onResize,$.ligerui.controls.Grid.prototype.append=$.ligerui.controls.Grid.prototype.appendRange}(jQuery);