!function(t){t.fn.ligerTab=function(e){return t.ligerui.run.call(this,"ligerTab",arguments)},t.fn.ligerGetTabManager=function(){return t.ligerui.run.call(this,"ligerGetTabManager",arguments)},t.ligerDefaults.Tab={height:null,heightDiff:0,changeHeightOnResize:!1,contextmenu:!0,dblClickToClose:!1,dragToMove:!1,showSwitch:!1,showSwitchInTab:!1,data:null,onBeforeOverrideTabItem:null,onAfterOverrideTabItem:null,onBeforeRemoveTabItem:null,onAfterRemoveTabItem:null,onBeforeAddTabItem:null,onAfterAddTabItem:null,onBeforeSelectTabItem:null,onAfterSelectTabItem:null,onCloseOther:null,onCloseAll:null,onClose:null,onReload:null,onSwitchRender:null},t.ligerDefaults.TabString={closeMessage:"关闭当前页",closeOtherMessage:"关闭其他",closeAllMessage:"关闭所有",reloadMessage:"刷新"},t.ligerMethos.Tab={},t.ligerui.controls.Tab=function(e,i){t.ligerui.controls.Tab.base.constructor.call(this,e,i)},t.ligerui.controls.Tab.ligerExtend(t.ligerui.core.UIComponent,{__getType:function(){return"Tab"},__idPrev:function(){return"Tab"},_extendMethods:function(){return t.ligerMethos.Tab},_render:function(){function e(){var t=i.tab.width()-parseInt(i.tab.links.css("marginLeft"),10)-parseInt(i.tab.links.css("marginRight"),10);i.tab.links.width(t)}var i=this,a=this.options;a.height&&(i.makeFullHeight=!0),i.tab=t(this.element),i.tab.addClass("l-tab"),a.contextmenu&&t.ligerMenu&&(i.tab.menu=t.ligerMenu({width:100,items:[{text:a.closeMessage,id:"close",click:function(){i._menuItemClick.apply(i,arguments)}},{text:a.closeOtherMessage,id:"closeother",click:function(){i._menuItemClick.apply(i,arguments)}},{text:a.closeAllMessage,id:"closeall",click:function(){i._menuItemClick.apply(i,arguments)}},{text:a.reloadMessage,id:"reload",click:function(){i._menuItemClick.apply(i,arguments)}}]})),i.tab.content=t('<div class="l-tab-content"></div>'),t("> div",i.tab).appendTo(i.tab.content),i.tab.content.appendTo(i.tab),i.tab.links=t('<div class="l-tab-links"><ul style="left: 0px; "></ul><div class="l-tab-switch"></div></div>'),i.tab.links.prependTo(i.tab),i.tab.links.ul=t("ul",i.tab.links);var n=t("> div[lselected=true]",i.tab.content),l=n.length>0;i.selectedTabId=n.attr("tabid"),t("> div",i.tab.content).each(function(e,a){var n=t('<li class=""><a></a><div class="l-tab-links-item-left"></div><div class="l-tab-links-item-right"></div></li>'),s=t(this);s.attr("title")&&(t("> a",n).html(s.attr("title")),s.attr("title",""));var o=s.attr("tabid");if(void 0==o&&(o=i.getNewTabid(),s.attr("tabid",o),s.attr("lselected")&&(i.selectedTabId=o)),n.attr("tabid",o),l||0!=e||(i.selectedTabId=o),s.attr("showClose")&&n.append("<div class='l-tab-links-item-close'></div>"),t("> ul",i.tab.links).append(n),s.hasClass("l-tab-content-item")||s.addClass("l-tab-content-item"),s.find("iframe").length>0){var r=t("iframe:first",s);if("complete"!=r[0].readyState){0==s.find(".l-tab-loading:first").length&&s.prepend("<div class='l-tab-loading' style='display:block;'></div>");var d=t(".l-tab-loading:first",s);r.bind("load.tab",function(){d.hide()})}}}),i.selectTabItem(i.selectedTabId),a.height&&("string"==typeof a.height&&a.height.indexOf("%")>0?(i.onResize(),a.changeHeightOnResize&&t(window).resize(function(){i.onResize.call(i)})):i.setHeight(a.height)),i.makeFullHeight&&i.setContentHeight(),t("li",i.tab.links).each(function(){i._addTabItemEvent(t(this))}),i.tab.bind("dblclick.tab",function(e){if(a.dblClickToClose){i.dblclicking=!0;var n=e.target||e.srcElement;if("a"==n.tagName.toLowerCase()){var l=t(n).parent().attr("tabid");!!t(n).parent().find("div.l-tab-links-item-close").length&&i.removeTabItem(l)}i.dblclicking=!1}}),i.set(a),setTimeout(e,100),t(window).resize(function(){e.call(i)}),i.bind("sysWidthChange",function(){e.call(i)})},_setShowSwitch:function(e){var i=this;this.options;e?(t(".l-tab-switch",i.tab.links).length||t("<div class='l-tab-switch'></div>").appendTo(i.tab.links),t(i.tab).addClass("l-tab-switchable"),t(".l-tab-switch",i.tab).click(function(){i.toggleSwitch(this)})):(t(i.tab).removeClass("l-tab-switchable"),t("body > .l-tab-windowsswitch").remove())},_setShowSwitchInTab:function(e){var i=this;if(this.options.showSwitch&&e){t(i.tab).removeClass("l-tab-switchable"),t(".l-tab-switch",i.tab).remove();var a=t("<li class='l-tab-itemswitch'><a></a><div class='l-tab-links-item-left'></div><div class='l-tab-links-item-right'></div></li>");a.appendTo(i.tab.links.ul),a.click(function(){i.toggleSwitch(this)})}else t(".l-tab-itemswitch",i.tab.ul).remove()},toggleSwitch:function(e){var i=this;this.options;if(t("body > .l-tab-windowsswitch").length)return void t("body > .l-tab-windowsswitch").remove();if(null!=e){var a=t("<div class='l-tab-windowsswitch'></div>").appendTo("body"),n=i.tab.links.ul.find(">li"),l=i.getSelectedTabItemID();n.each(function(e,i){var n=t("<a href='javascript:void(0)'></a>");n.text(t(i).find("a").text());var s=t(i).attr("tabid");null!=s&&(s==l&&n.addClass("selected"),n.attr("tabid",s),a.append(n))}),a.css({top:t(e).offset().top+t(e).height(),left:t(e).offset().left-a.width()}),a.find("a").bind("click",function(e){var a=t(this).attr("tabid");void 0!=a&&(i.selectTabItem(a),i.moveToTabItem(a),t("body > .l-tab-windowsswitch").remove())}),i.trigger("switchRender",[a])}},_applyDrag:function(e){var i=this;this.options;return i.droptip=i.droptip||t("<div class='l-tab-drag-droptip' style='display:none'><div class='l-drop-move-up'></div><div class='l-drop-move-down'></div></div>").appendTo("body"),t(e).ligerDrag({revert:!0,animate:!1,proxy:function(){var e=t(this).find("a").html();return i.dragproxy=t("<div class='l-tab-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div></div>").appendTo("body"),i.dragproxy.append(e),i.dragproxy},onRendered:function(){this.set("cursor","pointer")},onStartDrag:function(i,a){if(!t(e).hasClass("l-selected"))return!1;if(2==a.button)return!1;var n=a.srcElement||a.target;return!t(n).hasClass("l-tab-links-item-close")&&void 0},onDrag:function(e,a){null==i.dropIn&&(i.dropIn=-1);var n=i.tab.links.ul.find(">li"),l=n.index(e.target);n.each(function(e,n){if(l!=e){var s=e>l;if(-1==i.dropIn||i.dropIn==e){var o=t(this).offset(),r={top:o.top,bottom:o.top+t(this).height(),left:o.left-10,right:o.left+10};s&&(r.left+=t(this).width(),r.right+=t(this).width());var d=a.pageX||a.screenX,b=a.pageY||a.screenY;d>r.left&&d<r.right&&b>r.top&&b<r.bottom?(i.droptip.css({left:r.left+5,top:r.top-9}).show(),i.dropIn=e,i.dragproxy.find(".l-drop-icon").removeClass("l-drop-no").addClass("l-drop-yes")):(i.dropIn=-1,i.droptip.hide(),i.dragproxy.find(".l-drop-icon").removeClass("l-drop-yes").addClass("l-drop-no"))}}})},onStopDrag:function(e,a){if(i.dropIn>-1){var n=i.tab.links.ul.find(">li:eq("+i.dropIn+")").attr("tabid"),l=t(e.target).attr("tabid");setTimeout(function(){i.moveTabItem(l,n)},0),i.dropIn=-1,i.dragproxy.remove()}i.droptip.hide(),this.set("cursor","default")}})},_setDragToMove:function(e){if(t.fn.ligerDrag){var i=this;this.options;if(e){if(i.drags)return;i.drags=i.drags||[],i.tab.links.ul.find(">li").each(function(){i.drags.push(i._applyDrag(this))})}}},moveTabItem:function(t,e){var i=this,a=i.tab.links.ul.find(">li[tabid="+t+"]"),n=i.tab.links.ul.find(">li[tabid="+e+"]");i.tab.links.ul.find(">li").index(a)<i.tab.links.ul.find(">li").index(n)?n.after(a):n.before(a)},setTabButton:function(){var e=this,i=(this.options,0);t("li",e.tab.links.ul).each(function(){i+=t(this).width()+2});var a=e.tab.width();return i>a?(t(".l-tab-links-left",e.tab).length||(e.tab.links.append('<div class="l-tab-links-left"><span></span></div><div class="l-tab-links-right"><span></span></div>'),e.setTabButtonEven()),!0):(e.tab.links.ul.animate({left:0}),t(".l-tab-links-left,.l-tab-links-right",e.tab.links).remove(),!1)},setTabButtonEven:function(){var e=this;this.options;t(".l-tab-links-left",e.tab.links).hover(function(){t(this).addClass("l-tab-links-left-over")},function(){t(this).removeClass("l-tab-links-left-over")}).click(function(){e.moveToPrevTabItem()}),t(".l-tab-links-right",e.tab.links).hover(function(){t(this).addClass("l-tab-links-right-over")},function(){t(this).removeClass("l-tab-links-right-over")}).click(function(){e.moveToNextTabItem()})},moveToPrevTabItem:function(e){var i=this,a=(this.options,t("> li",i.tab.links.ul)),n=t(".l-tab-links-right",i.tab),l=t(".l-tab-links-left",i.tab);if(!n.length||!l.length)return!1;for(var s=(n.offset(),l.offset()),o=null,r=0,d=s.left+l.outerWidth(),b=0,c=a.length;b<c;b++){var h=t(a[b]),f=h.offset(),u=f.left,g=f.left+h.outerWidth();if(null!=e){if(u<d&&h.attr("tabid")==e){o=h;break}}else if(u<d&&g>=d){o=h;break}r+=h.outerWidth()+parseInt(h.css("marginLeft"))+parseInt(h.css("marginRight"))}if(null==o)return!1;var v=r-l.outerWidth();return i.tab.links.ul.animate({left:-1*v}),!0},moveToNextTabItem:function(e){var i=this,a=(this.options,t("> li",i.tab.links.ul)),n=t(".l-tab-links-right",i.tab),l=t(".l-tab-links-left",i.tab);if(!n.length||!l.length)return!1;for(var s=n.offset(),o=l.offset(),r=null,d=0,b=0,c=a.length;b<c;b++){var h=t(a[b]);d+=h.outerWidth()+parseInt(h.css("marginLeft"))+parseInt(h.css("marginRight"));var f=h.offset(),u=f.left,g=f.left+h.outerWidth();if(null!=e){if(g>s.left&&h.attr("tabid")==e){r=h;break}}else if(u<=s.left&&g>s.left){r=h;break}}if(null==r)return!1;var v=d-(s.left-o.left)+parseInt(r.css("marginLeft"))+parseInt(r.css("marginRight"));return i.tab.links.ul.animate({left:-1*v}),!0},moveToTabItem:function(t){var e=this;this.options;e.moveToPrevTabItem(t)||e.moveToNextTabItem(t)},getTabItemCount:function(){var e=this;this.options;return t("li",e.tab.links.ul).length},getSelectedTabItemID:function(){var e=this;this.options;return t("li.l-selected",e.tab.links.ul).attr("tabid")},removeSelectedTabItem:function(){var t=this;this.options;t.removeTabItem(t.getSelectedTabItemID())},overrideSelectedTabItem:function(t){var e=this;this.options;e.overrideTabItem(e.getSelectedTabItemID(),t)},overrideTabItem:function(e,i){var a=this;this.options;if(0==a.trigger("beforeOverrideTabItem",[e]))return!1;var n=i.tabid;void 0==n&&(n=a.getNewTabid());var l=i.url,s=i.content,o=(i.target,i.text),r=i.showClose,d=i.height;if(!a.isTabItemExist(n)){var b=t("li[tabid="+e+"]",a.tab.links.ul),c=t(".l-tab-content-item[tabid="+e+"]",a.tab.content);b&&c&&(b.attr("tabid",n),c.attr("tabid",n),0==t("iframe",c).length&&l?c.html("<iframe frameborder='0'></iframe>"):s&&c.html(s),t("iframe",c).attr("name",n),void 0==r&&(r=!0),0==r?t(".l-tab-links-item-close",b).remove():0==t(".l-tab-links-item-close",b).length&&b.append("<div class='l-tab-links-item-close'></div>"),void 0==o&&(o=n),d&&c.height(d),t("a",b).text(o),t("iframe",c).attr("src",l),a.trigger("afterOverrideTabItem",[e]))}},setHeader:function(e,i){t("li[tabid="+e+"] a",this.tab.links.ul).text(i)},selectTabItem:function(e){var i=this;this.options;if(0==i.trigger("beforeSelectTabItem",[e]))return!1;i.selectedTabId=e,t("> .l-tab-content-item[tabid="+e+"]",i.tab.content).show().siblings().hide(),t("li[tabid="+e+"]",i.tab.links.ul).addClass("l-selected").siblings().removeClass("l-selected"),i.trigger("afterSelectTabItem",[e])},moveToLastTabItem:function(){var e=this,i=(this.options,0);t("li",e.tab.links.ul).each(function(){i+=t(this).width()+2});var a=e.tab.width();if(i>a){var n=t(".l-tab-links-right",e.tab.links).width();e.tab.links.ul.animate({left:-1*(i-a+n+2)})}},getTabItemTitle:function(e){var i=this;this.options;return t("li[tabid="+e+"] a",i.tab.links.ul).text()},setTabItemTitle:function(e,i){var a=this;this.options;t("li[tabid="+e+"] a",a.tab.links.ul).text(i)},getTabItemSrc:function(e){var i=this;this.options;return t(".l-tab-content-item[tabid="+e+"] iframe",i.tab.content).attr("src")},setTabItemSrc:function(e,i){var a=this,n=(this.options,t(".l-tab-content-item[tabid="+e+"]",a.tab.content)),l=t(".l-tab-loading:first",n),s=t(".l-tab-content-item[tabid="+e+"] iframe",a.tab.content);l.show(),s.attr("src",i).unbind("load.tab").bind("load.tab",function(){l.hide()})},isTabItemExist:function(e){var i=this;this.options;return t("li[tabid="+e+"] a",i.tab.links.ul).length>0},addTabItem:function(e){var i=this,a=this.options;if(0==i.trigger("beforeAddTabItem",[e]))return!1;var n=e.tabid;void 0==n&&(n=i.getNewTabid());var l=e.url,s=e.content,o=e.text,r=e.showClose,d=e.height;if(i.isTabItemExist(n))return void i.selectTabItem(n);var b=t("<li><a></a><div class='l-tab-links-item-left'></div><div class='l-tab-links-item-right'></div><div class='l-tab-links-item-close'></div></li>"),c=t("<div class='l-tab-content-item'><div class='l-tab-loading' style='display:block;'></div><iframe frameborder='0'></iframe></div>"),h=t("div:first",c),f=t("iframe:first",c);if(i.makeFullHeight){var u=i.tab.height()-i.tab.links.height();c.height(u)}b.attr("tabid",n),c.attr("tabid",n),l?(f[0].tab=i,e.data&&(f[0].openerData=e.data),f.attr("name",n).attr("id",n).attr("src",l).bind("load.tab",function(){h.hide(),e.callback&&e.callback()})):(f.remove(),h.remove()),s?(c.html(s),e.callback&&e.callback()):e.target&&(c.append(e.target),e.callback&&e.callback()),void 0==r&&(r=!0),0==r&&t(".l-tab-links-item-close",b).remove(),void 0==o&&(o=n),d&&c.height(d),t("a",b).text(o),t(".l-tab-itemswitch",i.tab.links.ul).length?b.insertBefore(t(".l-tab-itemswitch",i.tab.links.ul)):i.tab.links.ul.append(b),i.tab.content.append(c),i.selectTabItem(n),i.setTabButton()&&i.moveToTabItem(n),i._addTabItemEvent(b),a.dragToMove&&t.fn.ligerDrag&&(i.drags=i.drags||[],b.each(function(){i.drags.push(i._applyDrag(this))})),i.toggleSwitch(),i.trigger("afterAddTabItem",[e])},_addTabItemEvent:function(e){var i=this;this.options;e.click(function(){var e=t(this).attr("tabid");i.selectTabItem(e)}),i.tab.menu&&i._addTabItemContextMenuEven(e),t(".l-tab-links-item-close",e).hover(function(){t(this).addClass("l-tab-links-item-close-over")},function(){t(this).removeClass("l-tab-links-item-close-over")}).click(function(){var e=t(this).parent().attr("tabid");i.removeTabItem(e)})},removeTabItem:function(e){var i=this;this.options;if(0==i.trigger("beforeRemoveTabItem",[e]))return!1;t("li[tabid="+e+"]",i.tab.links.ul).hasClass("l-selected")&&(t(".l-tab-content-item[tabid="+e+"]",i.tab.content).prev().show(),t("li[tabid="+e+"]",i.tab.links.ul).prev().addClass("l-selected").siblings().removeClass("l-selected"));var a=t(".l-tab-content-item[tabid="+e+"]",i.tab.content),n=t("iframe",a);if(n.length){var l=n[0];l.src="about:blank";try{l.contentWindow.document.write("")}catch(t){}t.browser.msie&&CollectGarbage(),n.remove()}a.remove(),t("li[tabid="+e+"]",i.tab.links.ul).remove(),i.setTabButton(),i.trigger("afterRemoveTabItem",[e])},hideTabItem:function(e){var i=this;this.options;t("li[tabid="+e+"]",i.tab.links.ul).hasClass("l-selected")&&(t(".l-tab-content-item[tabid="+e+"]",i.tab.content).prev().show(),t("li[tabid="+e+"]",i.tab.links.ul).prev().addClass("l-selected").siblings().removeClass("l-selected")),t("li[tabid="+e+"]",i.tab.links.ul).hide(),t(".l-tab-content-item[tabid="+e+"]",i.tab.content).hide()},showTabItem:function(e){var i=this;this.options;t("li[tabid="+e+"]",i.tab.links.ul).show()},addHeight:function(t){var e=this,i=(this.options,e.tab.height()+t);e.setHeight(i)},setHeight:function(t){var e=this;this.options;e.tab.height(t),e.setContentHeight()},setContentHeight:function(){var e=this,i=(this.options,e.tab.height()-e.tab.links.height());e.tab.content.height(i),t("> .l-tab-content-item",e.tab.content).height(i)},getNewTabid:function(){var t=this;this.options;return t.getnewidcount=t.getnewidcount||0,"tabitem"+ ++t.getnewidcount},getTabidList:function(e,i){var a=this,n=(this.options,[]);return t("> li",a.tab.links.ul).each(function(){t(this).attr("tabid")&&t(this).attr("tabid")!=e&&(!i||t(".l-tab-links-item-close",this).length>0)&&n.push(t(this).attr("tabid"))}),n},removeOther:function(e,i){var a=this,n=(this.options,a.getTabidList(e,!0));t(n).each(function(){a.removeTabItem(this)})},reload:function(e){var i=(this.options,t(".l-tab-content-item[tabid="+e+"]")),a=t(".l-tab-loading:first",i),n=t("iframe:first",i),l=t(n).attr("src");a.show(),n.attr("src",l).unbind("load.tab").bind("load.tab",function(){a.hide()})},removeAll:function(e){var i=this,a=(this.options,i.getTabidList(null,!0));t(a).each(function(){i.removeTabItem(this)})},onResize:function(){var e=this,i=this.options;if(!i.height||"string"!=typeof i.height||-1==i.height.indexOf("%"))return!1;if("body"==e.tab.parent()[0].tagName.toLowerCase()){var a=t(window).height();a-=parseInt(e.tab.parent().css("paddingTop")),a-=parseInt(e.tab.parent().css("paddingBottom")),e.height=i.heightDiff+a*parseFloat(e.height)*.01}else e.height=i.heightDiff+e.tab.parent().height()*parseFloat(i.height)*.01;e.tab.height(e.height),e.setContentHeight()},_menuItemClick:function(t){var e=this;this.options;if(t.id&&e.actionTabid)switch(t.id){case"close":if(0==e.trigger("close"))return;e.removeTabItem(e.actionTabid),e.actionTabid=null;break;case"closeother":if(0==e.trigger("closeother"))return;e.removeOther(e.actionTabid);break;case"closeall":if(0==e.trigger("closeall"))return;e.removeAll(),e.actionTabid=null;break;case"reload":if(0==e.trigger("reload",[{tabid:e.actionTabid}]))return;e.selectTabItem(e.actionTabid),e.reload(e.actionTabid)}},_addTabItemContextMenuEven:function(e){var i=this;this.options;e.bind("contextmenu",function(a){if(i.tab.menu)return i.actionTabid=e.attr("tabid"),i.tab.menu.show({top:a.pageY,left:a.pageX}),0==t(".l-tab-links-item-close",this).length?i.tab.menu.setDisabled("close"):i.tab.menu.setEnabled("close"),!1})}})}(jQuery);